<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telphone=no, email=no"/>
    <link rel="stylesheet" href="./import/css/init.css" />
    <link rel="stylesheet" href="./import/css/index.css?v=" + Date.now()  />
    <link rel="stylesheet" href="./import/css/swiper.min.css" />
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_999391_560e0zodez7.css" />
    <script  type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <title>特麦会</title>
    <style type="text/css">
    .goodsName{
        display: flex;
        justify-content: space-between;
    }
    .goodsName p:first-child{
        width: 60%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .goodsName p:last-child{
        font-size: 1.4rem;
        font-weight: 500;
        display: flex;
        justify-content: flex-end;
        line-height: 30px;
    }
    .goodsName img{
        width: 30px;
        height: 30px;
        border-radius: 50%;
    }

    .rightBar{
        width: 50px;
        position: fixed;
        right: 15px;
        top:35%;
        z-index: 2;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    .barItem{
        margin-top:10px;
    }
    .itemImg{
        width: 50px;
        height: 38px;
        margin:0 auto;
    }
    .itemImg1{
        width: 35px;
        height: 35px;
    }
    .itemImg2{
        width: 25px;
        height: 25px;
    }
    .itemImg img{
        width: 100%;
        height: 100%;
    }
    .itemImg .fenxiao{
        display: block;
        margin:0 10px 0;
    }
    .itemName{
        width: 50px;
        height: 15px;
        background-color: #FFA800;
        border-radius: 16px;
        margin:0 auto;
    }
    .itemName p{
        font-size: 1rem;
        color:#fff;
        text-align: center;
        line-height: 15px;
    }
    </style>
</head>
<body>
<div id="app">
    <!-- 头部 -->
    <div class="head">
        <!-- 轮播 -->
        <div class="swiper-container">
            <div class="swiper-wrapper">
                <div class="swiper-slide" v-if="detail.banner1">
                    <img :src="detail.banner1" alt="">
                </div>
                <div class="swiper-slide" v-if="detail.banner2">
                    <img :src="detail.banner2" alt="">
                </div>
                <div class="swiper-slide" v-if="detail.banner3">
                    <img :src="detail.banner3" alt="">
                </div>
            </div>
            <!-- 如果需要分页器 -->
            <div class="swiper-pagination"></div>
        </div>

        <!-- 更多优惠 -->
        <div class="more" @click="showQrcode = 1">
            <i class="spa icon-youhuiquan"></i> 更多优惠
        </div>
    </div>

    <!-- 产品信息 -->
    <div class="goods">
        <!-- 标题 -->
        <div class="goodsName">
            <p><i class="spa icon-huo"></i> {{detail.title}}</p>
            <p>
                <img :src="user.head_img" />
                <span>由{{user.username}}分享</span>
            </p>
        </div>

        <!-- 超值优选 -->
        <div class="marker">
            <p>
                超值优选<span>特惠拼团盛宴</span>
            </p>
            <p @click="showRule = 1">
                <i class="spa icon-zhuyi"></i> 详细规则
            </p>
        </div>

        <!-- 价格 -->
        <div class="price">
            市场价：<del style="color: #ccc;">￥{{detail.price}}</del>
        </div>
        <div class="price price1" v-for="(item, index) in detail.pt_price" v-if="Array.isArray(detail.pt_price)==true">
            {{item.title}}：<p>￥<span>{{item.money}}</span></p>
        </div>
        <div class="price price1"  v-if="Array.isArray(detail.pt_price)==false">
            特卖价：<p>￥<span>{{detail.pt_price}}</span></p>
        </div>
        <!--预付款判断-->
        <div v-if="detail.prepay >0"  class="price">
                <p class="advancePrice">预付款：<span>￥<i>{{detail.prepay}}</i></span></p>
        </div>
        <!--end预付款-->

        <!-- 优惠券 -->
        <!-- <div class="coupons">
            领券：
            <p v-if="detail.coupon_id != ''">
                <span></span>{{detail.coupon.title}}<span></span>
            </p>
            <p v-if="detail.coupon_id == ''">暂无优惠券</p>
        </div> -->

        <!-- 选择套餐 -->
        <div class="package" @click="showPackage = 1">
            <span>选择套餐</span>
            <i class="spa icon-you"></i>
        </div>
    </div>

    <!-- 产品详情 -->
    <div class="detail" v-html="detail.description"></div>

    <!-- 底部购买 -->
    <div class="btm">
        <div>
            <i class="spa icon-chakantiezigengduoshoucang"></i>
            <p>收藏</p>
        </div>
        <button @click="user.id == detail.pid ? showShare = 1 : showPackage = 1">立即{{btnText}}</button>
    </div>

    <!-- 侧边 -->
    <!--<div class="side">-->
        <!--<i class="spa icon-fenxiang" @click="showShare=1"></i>-->
        <!--<i class="spa icon-iconfonticon5" @click="go('../my.html')"></i>-->
    <!--</div>-->
    <!--shi.右侧导航-->
    <div class="rightBar">
        <div class="barItem" @click="go('../my.html')">
            <div class="itemImg itemImg1">
                <img src="../../img/my.png" alt="">
            </div>
            <div class="itemName">
                <p>个人页</p>
            </div>
        </div>
    </div>

    <!-- 更多优惠二维码 -->
    <div class="showQrcode" v-if="showQrcode" @click="close($event.target.className)">
        <img src="./import/img/qrcode.jpg" alt="">
    </div>

    <!-- 详细规则 -->
    <div class="rule" v-if="showRule" @click="close($event.target.className)">
        <img src="./import/img/rule.jpg" class="ruleimg" />
    </div>

    <!-- 分享 -->
    <div class="share" v-if="showShare" @click="showShare=0">
        <img src="./import/img/toShare.png">
        <div class="text">
            <p>请点击右上角，将它发送给好友</p>
            <p>或朋友圈分享增进感情</p>
        </div>
    </div>
    <!-- 套餐列表 -->
    <div class="chosePackage" v-if="showPackage" @click="close($event.target.className)">
        <div class="packageList">
            <div class="goodsimg">
                <img :src="detail.banner1" />
                <span>{{detail.title}}</span>
            </div>
            <div class="goodsSize">
                <p>规格</p>
                <p>{{detail.standard}}</p>
            </div>
            <div class="goodsprice">
                <!-- <p>市场价：￥{{detail.price}}</p> -->
                <p class="specialprice" v-if="Array.isArray(detail.pt_price)==true">特卖价:<span>￥{{detail.pt_price[0].money}}</span></p>
                <p class="specialprice" v-else>特卖价:<span>￥{{detail.pt_price}}</span></p>
            </div>
            <div class="goodsnum">
                <p>数量</p>
                <p>
                    <span @click="numMinus">-</span>
                    <span>{{num}}</span>
                    <span @click="num++">+</span>
                </p>
            </div>
            <button @click="handleClick(isShare)">立即{{btnText}}</button>
            <!-- <button @click="user.id == detail.pid ? showShare = 1 : showPackage = 1">立即{{btnText}}</button> -->
        </div>
    </div>
</div>
<script src="./import/js/vue.min.js"></script>
<script src="./import/js/axios.min.js?v="+new Date()></script>
<script src="./import/js/swiper.min.js"></script>
<script src="./import/js/init.js"></script>
<script src="../../js/common.js?v="+new Date()></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js" type="text/javascript" charset="utf-8"></script>

<script>
    var app = new Vue({
        el: '#app',
        data: {
            isShare: false,
            showQrcode: 0,
            showRule: 0,
            showShare: 0,
            showPackage: 0,
            detail: {
                title: 'title',
                price: 'price',
                banner1:'banner1',
                share_img: 'share_img',
                share_desc:'share_desc',
                share_title:'share_title',//分享卡片标题
                share_link:'share_link',//分享卡片标题
                pid:'pid',
                pt_price: [
                    {title: 'pt title', money: 'pt money'},
                    {title: 'pt title', money: 'pt money'}
                ],
                coupon: {
                    title: 'coupon title'
                },
                coupon_id: 0,
                description: 'des'
            },
            user: {},
            num: 1,
            btnText: '购买'
        },
        methods: {
            close: function(e){
                if(e.match('showQrcode')){
                    this.showQrcode = 0;
                }else if(e.match('ruleimg')){
                    this.showRule = 0;
                }else if(e.match('chosePackage')){
                    this.showPackage = 0;
                }
            },
            chosePackageFoo: function(){
                this.showPackage = 1;
            },
            numMinus: function(){
                this.num <=1 ? alert('购买数量不能小于1') : this.num--;
            },
            shop:function(){
                go('../pay/shareOrder.html?type=share&id=' + this.detail.share_info.id + '&num='+this.num);
            },
            //处理分享还是购买
            handleClick(isShare){
                if(isShare){
                    this.showShare = 1;
                }else{
                    this.showPackage = 1;
                    this.shop();
                }
            }      
        },
        mounted: function(){
            var that = this;
            var mySwiper = new Swiper ('.swiper-container', {
                loop: true,
                pagination: {
                    el: '.swiper-pagination'
                }
            })
            var id = getParam('share_id');
            token = getData('TOKEN');
            var url = window.globalResURL + '/activityshare/detail?share_id=' + id + '&token=' + token;
            axios.get(url).then(function(res){
                that.detail  = res.data.data.first;
                that.user    = res.data.data.share_user;
                if(that.user.id == that.detail.pid){ //判断分享还是购买
                    that.btnText = '分享';
                    that.isShare = true;
                }else{
                    that.btnText = '购买';
                    that.isShare = false;
                    that.detail.pt_price =[
                        {title: '特卖价', money: that.detail.share_info.price}
                    ]
                }
                getShare(res.data.data.first);
            })
        }
    })

//获取url参数
function getParam(name){
    var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
    var search = decodeURIComponent(window.location.search);
    var r = search.substr(1).match(reg);
    if (r != null) {
        return unescape(r[2]);
    }
    return null;
}

//分享页面
function getShare(detail) {
    var url = window.globalResURL + '/wechat/show_share';
    var back_url=encodeURIComponent(window.location.href.split('#')[0]);
    var param = {'url': back_url };
    $.ajax({
        url:url,
        type:'GET',
        async:true,
        data: param,
        dataType:'json',
        success:function(res) {
            var _data = res.data;
            wx.config({
                debug: false,
                appId: _data.appId,
                timestamp: _data.timestamp,
                nonceStr: _data.nonceStr,
                signature: _data.signature,
                jsApiList: [
                    "onMenuShareTimeline", //分享给好友
                    "onMenuShareAppMessage", //分享到朋友圈
                    "onMenuShareQQ", //分享到QQ
                    "onMenuShareWeibo" //分享到微博
                ]
            });
            var share  = detail.share_info;

            var this_url = window.location.href.split('#')[0];
            var share_url = changeUrlArg(this_url,'token','');
            window.share_config = {
                "share": {
                    "imgUrl": detail.share_img ? detail.share_img : detail.banner1,
                    "desc": share.keywords ? share.keywords : detail.title,
                    "title": share.title ? share.title : detail.title,//分享卡片标题
                    "link": share_url + '&pid=' + detail.pid,
                    "success": function () {//分享成功后的回调函数
                        //addShareLog(share_title,share_url,share_desc);
                    },
                    'cancel': function () {
                        // 用户取消分享后执行的回调函数
                    }
                }
            };
            wx.ready(function () {
                //分享给朋友
                wx.onMenuShareTimeline(share_config.share);
                //分享到朋友圈
                wx.onMenuShareAppMessage(share_config.share);
                //分享到QQ
                wx.onMenuShareQQ(share_config.share);
                //QQ空间
                wx.onMenuShareQZone(share_config.share);
            })
        }
    });
}
</script>

</body>
</html>