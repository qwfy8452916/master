<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>echarts3</title>
	<link rel="stylesheet" type="text/css" href="css/select2.css" />
    <link rel="stylesheet" type="text/css" href="css/datepicker.css" />
    <link rel="stylesheet" type="text/css" href="css/daterangepicker-bs3.css" />
    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="js/select2.full.min.js"></script>
	<script type="text/javascript" src="js/bootstrap-datepicker.js"></script>
	<script type="text/javascript" src="js/echarts.min.js"></script>
    <script type="text/javascript" src="js/moment.min.js"></script>
    <script type="text/javascript" src="js/daterangepicker.js"></script>
	
</head>
<body>
	   <section class="content-header">
        <h1>发单量数据分析</h1>
    </section>
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <div class="btn-group btn-group" role="group" aria-label="Large button group">
                            <button type="button" class="btn btn-default">发单量走势</button>
                            <button type="button" class="btn btn-info">发单量总览</button>
                        </div>
                    </div>
                </div>
                <div class="box box-default">
                    <div class="box-header text-center">
                        <div class="box-title">多时段平均发单量柱状图</div>
                        <a href="/orderstat/sendorderoverview/?begin={$Think.get.begin}&end={$Think.get.end}" class="btn btn-info pull-right">切换至表格</a>
                        <div class="col-xs-12 no-padding">
                            <a href="/orderstat/sendordertimechart/?begin={$Think.get.begin}&end={$Think.get.end}" class="btn btn-default btn-sm pull-right" style="margin-top: 10px;">按时间段查看</a>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="col-xs-12">
                            <div class="pull-left" style="line-height: 34px;">
                                <if condition="$_GET['hb'] == 1">
                                <input id="addHuanBi" type="checkbox" name="加入环比" checked>
                                <else/>
                                <input id="addHuanBi" type="checkbox" name="加入环比">
                                </if>
                                <label for="addHuanBi" class="text-warning">加入环比</label>
                            </div>
                            <div class="pull-left" style="line-height: 34px;padding: 0 30px;">
                                <if condition="$_GET['tb'] == 1">
                                <input id="addTongBi" type="checkbox" name="加入同比" checked>
                                <else/>
                                <input id="addTongBi" type="checkbox" name="加入同比">
                                </if>
                                <label for="addTongBi" class="text-success">加入同比</label>
                            </div>

                            <div class="col-xs-3">
                                <div class="col-xs-11 no-padding">
                                    <div class="btn btn-info pull-left custom">自定义</div>
                                    <div class="input-group customTime hide">
                                        <input type="text" class="form-control pull-right" id="reservation" placeholder="自定义时间段">
                                        <div class="input-group-addon btn-default">取消</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="canvas" class="col-xs-11 no-padding" style="height: 600px;">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
   <script type="text/javascript">
     // 图表初始化渲染
    var Dom = document.querySelector("#canvas");
    var myChart = echarts.init(Dom);
    var option = {
        tooltip: {
            trigger: 'item'
        },
        legend: {
            left:'right',
            data:['现时间段','','',''], //'加入环比','加入同比','自定义时间段'
            itemGap:10,
            orient:'vertical'
        },
        xAxis: {
            data:['00：00-01：00', '01：00-02：00', '02：00-03：00', '03：00-04：00', '04：00-05：00', '05：00-06：00', '06：00-07：00', '07：00-08：00', '08：00-09：00', '09：00-10：00',  '10：00-11：00', '11：00-12：00', '12：00-13：00', '13：00-14：00', '14：00-15：00', '15：00-16：00', '16：00-17：00', '17：00-18：00', '18：00-19：00', '19：00-20：00', '20：00-21：00', '21：00-22：00', '22：00-23：00', '23：00-24：00'],
            axisLabel: {
                interval: 0,
                rotate: 60,
            }
        },
        yAxis: {},
        series: [
            {
                name: '现时间段',
                type: 'bar',
                data: [54.72,28.59,20.31,17.21,15.34,28.21,49.34,52.41,64.41,63.14,68.31,71.21,72.38,81.72,81.62,94.93,93.72,81.41,68.1,66.93,82.14,110.21,119.55,89.93]            },
            {
                name: '加入环比',
                type: 'bar',
                // data: [1, 3, 5, 0.5, 4.5, 2, 5, 4, 2.5, 7]
            },
            {
                name: '加入同比',
                type: 'bar',
                // data: [7, 1.4, 2.1, 7.4, 1.5, 2.9, 5,2,8, 7]
            },
            {
                name: '自定义时间段',
                type: 'bar',
                data: null            }
        ]
    };
    var customData = null;

    if (customData != null) {
        option.series[3].data = null;
        option.legend.data[3] = '自定义时间段';
    }

    myChart.setOption(option);

    // 自定义时间段需选择
    $('.custom').on('click',function(){ // 自定义按钮操作
        $(this).addClass('hide');
        $('.customTime').removeClass('hide');
    });
    $('.customTime .btn-default').on('click',function(){ // 取消操作
        $('.custom').removeClass('hide');
        $('.customTime').addClass('hide');
        if(option.series[3].data){
            option.series[3].data = '';
            option.legend.data[3] = '';
            var myChart = echarts.init(Dom);
            myChart.setOption(option);
        }
    });
    $('#reservation').daterangepicker( // 时间段选择
        {
            format: 'YYYY/MM/DD',
            "alwaysShowCalendars": true,
            locale : {
                applyLabel : '确定',
                cancelLabel : '取消',
                fromLabel : '起始时间',
                toLabel : '结束时间',
                customRangeLabel : '自定义',
                daysOfWeek : [ '日', '一', '二', '三', '四', '五', '六' ],
                monthNames : [ '一月', '二月', '三月', '四月', '五月', '六月',
                        '七月', '八月', '九月', '十月', '十一月', '十二月' ],
                firstDay : 1
            },
            startDate: "06/30/2017",
            endDate: "06/30/2017"
        },
        function(start, end, label) {
            var hb = $("#addHuanBi").attr("checked") == "checked"?1:0;
            var tb = $("#addTongBi").attr("checked") == "checked"?1:0;
            window.location.href = "/orderstat/sendorderaveragechart?begin=&end=&substart="+start.format('MM/DD/YY')+"&subend="+end.format('MM/DD/YY')+"&hb="+hb+"&tb="+tb;
    });

    // 窗口大小改变时，图表重新渲染
    window.onresize=function(){
        var myChart = echarts.init(Dom);
        myChart.setOption(option);
    }

    // 选择多条数据------加入环比、加入同比
    $('input[type="checkbox"]').each(function(index, el) {
        var opt = option;
        if ($(this).prop('checked')) {
            if($(this).attr('name') == "加入环比"){
                option.series[1].data = [51.9,28.77,20.3,14.4,13.87,25.77,41.83,45.7,58.63,63.53,69.7,68.13,63.9,70.53,80.53,86.9,88.9,74.4,63.53,63.9,81.03,105.3,118.1,87.17];
                option.legend.data[1] = '加入环比';
                var myChart = echarts.init(Dom);
                myChart.setOption(option);
            }else{
                option.series[2].data = [25.83,16.93,11.43,9.53,10.5,14.27,22.8,31.93,43.27,43.9,44.6,39.9,42.43,48.8,53.17,61.57,60.47,52.83,47.73,53.13,60.6,80.5,86.17,53.9];
                option.legend.data[2] = '加入同比';
                var myChart = echarts.init(Dom);
                myChart.setOption(option);
            }
        }

        $(this).on('click', function(){
            if($(this).prop('checked')){
                if($(this).attr('name') == "加入环比"){
                    option.series[1].data = [51.9,28.77,20.3,14.4,13.87,25.77,41.83,45.7,58.63,63.53,69.7,68.13,63.9,70.53,80.53,86.9,88.9,74.4,63.53,63.9,81.03,105.3,118.1,87.17];
                    option.legend.data[1] = '加入环比';
                    var myChart = echarts.init(Dom);
                    myChart.setOption(option);
                }else{
                    option.series[2].data = [25.83,16.93,11.43,9.53,10.5,14.27,22.8,31.93,43.27,43.9,44.6,39.9,42.43,48.8,53.17,61.57,60.47,52.83,47.73,53.13,60.6,80.5,86.17,53.9];
                    option.legend.data[2] = '加入同比';
                    var myChart = echarts.init(Dom);
                    myChart.setOption(option);
                }
                $(this).attr("checked","checked");
            }else{
                if($(this).attr('name') == "加入环比"){
                    option.series[1].data = '';
                    option.legend.data[1] = '';
                    var myChart = echarts.init(Dom);
                    myChart.setOption(option);
                }else{
                    option.series[2].data = '';
                    option.legend.data[2] = '';
                    var myChart = echarts.init(Dom);
                    myChart.setOption(option);
                }
                $(this).attr("checked",false);
            }
        });
    });
</script>
</body>
</html>