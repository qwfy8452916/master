
<extend name="Main:baseTemplate" />
<block name="title">
    <title>招聘通话统计详情</title>
</block>
<block name="style">
	<link rel="stylesheet" href="/assets/home/Recruit/days.css">
</block>
<block name="content">
    <section class="content-header">
       <h4>招聘通话统计详情</h4>
      
       <div class="row">
       	   <div class="col-xs-12">
    	 	 <div class="box laytop">
    	 	   <div class="box-header">
    	 	   	  <h4 style="display: inline-block">通话记录详情 > {$user.name} <input type="hidden" value="{$user.id}"></h4>
				   <span class="btn btn-success" style="margin-top: 3px;float: right" onclick="javascript:window.history.back(-1);">返回</span>
			   </div>
    	 	 <table>
    	 	 	<thead>
    	 	 		<tr>
    	 	 			<th>日期</th>
    	 	 			<th>呼出量</th>
    	 	 			<th>呼通量</th>
    	 	 			<th>未呼通量</th>
    	 	 			<th>平均时长</th>
    	 	 			<th>总时长</th>
    	 	 			<th>呼叫记录</th>
    	 	 		</tr>
    	 	 	</thead>
    	 	 	<tbody>
				<volist name="list" id="vo">
					<tr>
						<td>{$vo.days}</td>
						<td>{$vo.count}</td>
						<td>{$vo.tel_count}</td>
						<td>{$vo.un_tel_count}</td>
						<td>{$vo.avg_time}</td>
						<td>{$vo.sum_time}</td>
						<td><a class="dianji">查看</a></td>
					</tr>
				</volist>
    	 	 	</tbody>
    	 	 </table>
    	 	 </div>

           </div>
       </div>
       
       <div class="yinying"></div>
      
       <div class="laytanchu">
          <div class="waik">
       	  <span class="guanbi fa fa-close"></span>
       	  <span class="fangda">放大</span>
       	  <div class="row">
       	   <div class="col-xs-12">
    	 	 <div class="box laytop">
    	 	   <div class="box-header">
    	 	   	  <h4>记录列表</h4>
    	 	   </div>
              
    	 	 <table>
    	 	 	<thead>
    	 	 		<tr>
    	 	 			<th>产生时间</th>
    	 	 			<th>呼叫动作</th>
    	 	 			<th>挂机类型</th>
    	 	 			<th>通话录音</th>
    	 	 			<th>callSid</th>
    	 	 			<th>主叫号码</th>
    	 	 			<th>被叫号码</th>
    	 	 			<th>拨打人</th>
    	 	 		</tr>
    	 	 	</thead>
    	 	 	<tbody class="appendhtml">

<!--     	 	 		<tr>
    	 	 			<td>2018-02-28 17:24:46</td>
    	 	 			<td>开始</td>
    	 	 			<td>7</td>
    	 	 			<td>11</td>
    	 	 			<td>api001000210901519809885795QP019</td>
    	 	 			<td>051286865110</td>
    	 	 			<td>113*****134</td>
    	 	 			<td>张娟</td>
    	 	 		</tr>
    	 	 		<tr>
    	 	 			<td>2018-02-28 17:24:46</td>
    	 	 			<td>主叫接通</td>
    	 	 			<td>7</td>
    	 	 			<td>11</td>
    	 	 			<td>api001000210901519809885795QP019</td>
    	 	 			<td>051286865110</td>
    	 	 			<td>113*****134</td>
    	 	 			<td>张娟</td>
    	 	 		</tr>
    	 	 		<tr>
    	 	 			<td>2018-02-28 17:24:46</td>
    	 	 			<td>主叫接通</td>
    	 	 			<td>7</td>
    	 	 			<td>11</td>
    	 	 			<td>api001000210901519809885795QP019</td>
    	 	 			<td>051286865110</td>
    	 	 			<td>113*****134</td>
    	 	 			<td>张娟</td>
    	 	 		</tr> -->
    	 	 	</tbody>
    	 	 </table>
    	 	 </div>

           </div>
       </div>
       </div>
     </div> 
    </section>

</block>

<block name="script">
    

  <script>

     var page = 1;
     window.flag = true;
     $(function(){
     	
     	$('.dianji').click(function(){
     		$('.yinying').fadeIn();
     		$('.laytanchu').fadeIn();
     	});

     	$('.laytanchu .guanbi').click(function(){	
     		$('.laytanchu').hide();
     		$('.yinying').fadeOut();
     		window.flag = true;
     		page = 1;
     	});
        $('.laytanchu .fangda').click(function(){
        	if($('.laytanchu').hasClass('yangshifd')){
                $('.laytanchu').removeClass('yangshifd')
                $('.laytanchu .fangda').html("放大")
        	}else{
        		$('.laytanchu').addClass('yangshifd')
        		 $('.laytanchu .fangda').html("缩小")
        	}
        	
        });

     	//getData(page);
     	$('.class').on('click',function(){
     		getData(page);
     	})
     		
	    $(".laytanchu .waik").unbind("scroll").bind("scroll", function(e){  
	        var sum = this.scrollHeight;
			if (window.flag) {
		        if (sum <= $(this).scrollTop() + $(this).height()) { 
		        	page++;
		             getData(page);
		             
		        }
		    }
	    }); 
     });


    function getData(page) {
		$.ajax({
	        type : "GET",
	        url : "/recruit/items",
	        dataType : "JSON",
	        data:{pid:1080,day:'2018-04-01',pageNum:page,pageSize:50}
	    })
        .done(function(data) {
        	 if(data.status == 1){
        	 	if(data.data!=""){
			        var html=getHtml(data.data)
			        $('table .appendhtml').append(html)
        	 	}else{
        	 		window.flag=false;
        	 	}
        	 }          
        })
        .fail(function(xhr) {
            alert("网络发生错误,请稍后重试！");
        });
   }

   function getHtml(data){
   	var html='';
   	var length=data.length;

   	$.each(data,function(index) {
        html+='<tr><td>'+data[index].time_add+'</td><td>'+data[index].action+'</td><td>'+data[index].duration+'</td><td>'+data[index].called+'</td><td>'+data[index].callsid+'</td><td>'+data[index].starttime+'</td><td>'+data[index].starttime+'</td><td>'+data[index].uname+'</td></tr>'

   	});
    return html;
   }
   </script>

</block>