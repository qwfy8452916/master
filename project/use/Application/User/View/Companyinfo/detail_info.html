<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="keywords" content="{$keys.keywords}">
        <meta name="description" content="{$keys.description}">
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
        <title>{$keys.title}-{$title}</title>
        <include file="Index:resource" />
        <include file="Home:resource" />
        <link rel="stylesheet" href="{$static_host}/assets/user/home/css/ht-info.css?v={:C('STATIC_VERSION')}"/>
        <link rel="stylesheet" href="{$static_host}/assets/user/companyinfo/css/detail_info.css?v={:C('STATIC_VERSION')}"/>
        <script type="text/javascript" src="{$static_host}/assets/common/js/laydate.js?v={:C('STATIC_VERSION')}"></script>
    </head>
    <body>
        <include file="Home:header" />
        <div class="ht-wrap oflow ht-relative">
            <include file="Home:comnavleft" />
            <include file="Companyinfo:tab_header" />
            <div class="ht-main">
                <ul class="ht-moreinfo">
                    <li>
                        <span>
                            <i class="red">*</i>服务区域：
                        </span>
                        <ul class="c-info-check-info">
                        </ul>
                        <div class="c-info-list-check">
                            <ul>
                                <volist name="quyu" id="vo">
                                    <li>
                                        <label>
                                            <input name="quyu[]" class="all" type="checkbox" value="{$vo.qz_areaid}"
                                            <if condition="strpos($info['user']['quyu'],$vo['qz_areaid']) nheq false">
                                            checked="checked"
                                            </if>
                                            />{$vo.oldName}
                                        </label>
                                    </li>
                                </volist>
                            </ul>
                            <div class="c-info-list-btn">
                                确定
                            </div>
                        </div>
                        <div class="c-info-add-list">
                            <i class="icon-plus">
                            </i>
                            添加
                        </div>
                    </li>
                    <li>
                        <span>
                            <i class="red">*</i>服务类型：
                        </span>
                        <div class="c-info-check-info">
                        </div>
                        <div class="c-info-list-check">
                            <ul>
                                <volist name="fuwu" id="vo">
                                    <li>
                                        <label>
                                            <input class="all" type="checkbox" value="{$vo.id}" name="fuwu[]" <if
                                            condition="strpos($info['user']['fuwu'],$vo['id']) nheq false">
                                            checked="checked"
                                            </if>
                                            />{$vo.name}
                                        </label>
                                    </li>
                                </volist>
                            </ul>
                            <div class="c-info-list-btn">
                                确定
                            </div>
                        </div>
                        <div class="c-info-add-list">
                            <i class="icon-plus">
                            </i>
                            添加
                        </div>
                    </li>
                    <li>
                        <span>
                            服务保障：
                        </span>
                        <div class="c-info-check-info">
                        </div>
                        <div class="c-info-list-check">
                            <ul>
                                <volist name="baozhang" id="vo">
                                    <li>
                                        <label>
                                            <input class="all" type="checkbox" value="{$vo.id}" name="baozhang[]" <if
                                                condition="strpos($info['user']['baozhang'],$vo['id']) nheq false">
                                            checked="checked"
                                        </if>
                                            />{$vo.name}
                                        </label>
                                    </li>
                                </volist>
                            </ul>
                            <div class="c-info-list-btn">
                                确定
                            </div>
                        </div>
                        <div class="c-info-add-list">
                            <i class="icon-plus">
                            </i>
                            添加
                        </div>
                        <i class="red">
                            <i class="icon-info-sign mr10" style="display: inline-block;float:left;margin-top: 8px;">
                            </i>
                            <i class="jiawei-info" style="display:inline-block;">所勾选的服务保障必须是本公司真实提供的，否则需要提供法律责任</i>
                        </i>
                    </li>
                    <li>
                        <span>
                            <i class="red">*</i>擅长风格：
                        </span>
                        <div class="c-info-check-info">
                        </div>
                        <div class="c-info-list-check">
                            <ul>
                                <volist name="fengge" id="vo">
                                    <li>
                                        <label>
                                            <input type="checkbox" class="icheck" value="{$vo.id}" name="fengge[]"
                                            <if condition="strpos($info['user']['fengge'],$vo['id']) nheq false">
                                            checked="checked"
                                            </if>
                                            />{$vo.name}
                                        </label>
                                    </li>
                                </volist>
                            </ul>
                            <div class="c-info-list-btn">
                                确定
                            </div>
                        </div>
                        <div class="c-info-add-list">
                            <i class="icon-plus">
                            </i>
                            添加
                        </div>
                    </li>
                    <li>
                        <span>
                            承接价位：
                        </span>
                        <input class="jiawei" name="jiawei" style="width:50px;text-align:center;" type="text"
                        value="{$info.user.jiawei}" />
                        万起
                        <i class="red">
                            <i class="icon-info-sign mr10">
                            </i>
                            <i class="jiawei-info">留空为不限</i>
                        </i>
                    </li>
                    <li>
                        <span>
                            成立时间：
                        </span>
                        <input class="laydate-icon" name="chengli" id="ht-date" value="{$info.user.chengli|default='请填写日期'}"
                        />
                    </li>
                    <li>
                        <span>
                            施工队伍：
                        </span>
                        <input class="jiawei" name="team_num" style="width:55px;text-align:center;" type="text" value="{$info.user.team_num}" />队
                        <i class="red err-tips" style="display: inline-block;">
                        </i>
                    </li>
                    <li>
                        <span>
                            公司规模：
                        </span>
                        <select name="guimo" class="select">
                            <volist name="guimo" id="vo">
                                <option value="{$vo.id}" <if condition="$info['user']['guimo'] eq $vo['id']">
                                    selected="selected"
                                    </if>
                                    >{$vo.name}
                                </option>
                            </volist>
                        </select>
                    </li>
                    <li>
                        <span>
                            <i class="red">*</i>交通路线：
                        </span>
                        <input class="in-focus" name="luxian" type="text" value="{$info.user.luxian}" data-focus="请输入交通路线" style="width: 480px;"
                        />
                        <i class="red err-tips">
                        </i>
                    </li>
                    <li>
                        <span>
                            <i class="red">*</i>简介：
                        </span>
                        <textarea class="jianjiemain in-focus" name="text" data-focus="请输入公司简介" >{$info.user.about_jianjie}</textarea>
                        <i class="red err-tips">
                        </i>
                    </li>
                </ul>
                <div class="ht-yes">
                    <a href="javascript:;" id="edit_info_btn">更新</a>
                    <i class="red err-tips">
                    </i>
                </div>
            </div>
        </div>
        <include file="Index:footer" />
    </body>
</html>
<script type="text/javascript">
    $(function() {
        //日历控件的加载
        $("#ht-date").click(function(event) {
            laydate.skin('yahui'); //日历的样式
            laydate({
                elem: '#ht-date',
                choose: function(datas) { //选择日期完毕的回调
                }
            }); //绑定元素
        });
        //复选框的渲染实例化
        $(".all").iCheck({
            checkboxClass: 'icheckbox_minimal-red',
            radioClass: 'iradio_minimal-red',
            increaseArea: '' // optional
        });
        $('.icheck').iCheck({
            checkboxClass: 'icheckbox_minimal-red',
            radioClass: 'iradio_minimal-red',
            increaseArea: '' // optional
        });

        $('.jiawei').blur(function(event) {
            var content = $(this).val();
            if(content){
                var reg = new RegExp("^[0-9]*$");
                if(!reg.test(content)){
                    $(".jiawei-info").html('请输入数字');
                    return false;
                }
            }
        })

        $('.in-focus').blur(function(event) {
            var content = $(this).val();
            if(!content){
                $(this).parent().find(".err-tips").html($(this).attr('data-focus'));
            }else{
                $(this).parent().find(".err-tips").empty();
            }
        })

        //装修风格的复选框实例化
        $(".fengge_all").iCheck({
            checkboxClass: 'icheckbox_minimal-red',
            radioClass: 'iradio_minimal-red',
            increaseArea: '' // optional
        }).on("ifChecked",
        function(event) {
            var target = $(event.target);
            target.attr("checked", "checked");
            $("input[name=fengge\\[\\]]").iCheck("check");
        }).on("ifUnchecked",
        function(event) {
            var target = $(event.target);
            target.attr("checked", false);
            $("input[name=fengge\\[\\]]").iCheck("uncheck");
        });

        //提交修改资料
        $("#edit_info_btn").click(function(event) {
            var quyu = "";
            var fuwu = "";
            var fengge = "";
            var baozhang = "";
            var _this = $(this);
            $("input[name='quyu\\[\\]']:checked").each(function() {
                quyu += $(this).val() + ",";
            });
            $("input[name='fuwu\\[\\]']:checked").each(function() {
                fuwu += $(this).val() + ",";
            });
            $("input[name='fengge\\[\\]']:checked").each(function() {
                fengge += $(this).val() + ",";
            });
            $("input[name='baozhang\\[\\]']:checked").each(function() {
                baozhang += $(this).val() + ",";
            });
            if (quyu == "") {
                alert("请选择服务区域");
                return false;
            }
            if (fuwu == "") {
                alert("请选择服务类型");
                return false;
            }
            if (fengge == "") {
                alert("请选择擅长风格");
                return false;
            }
            var jiawei = $("input[name='jiawei']").val();

            if(jiawei){
                var reg = new RegExp("^[0-9]*$");
                if(!reg.test(jiawei)){
                    $(".jiawei-info").html('非法的输入');
                    return false;
                }
            }
            var dcount = '{$info.user.dcount}';
            var team_num = $("input[name='team_num']");
            if(team_num.val() && team_num.val() != 0){
                if(team_num.val() > 200 || !isPositiveNum(team_num.val())){
                    team_num.focus();
                    team_num.parent().find(".err-tips").html("请填写真实的数量。");
                    return false;
                }
            }

            var chengli = $("input[name='chengli']").val();
            var guimo = $("select[name='guimo']").val();
            var luxian = $("input[name='luxian']").val();
            var text = $("textarea[name='text']").val();
            var luxian_obj = $("input[name='luxian']");
            var text_obj = $("textarea[name='text']");
            if (!App.validate.run(luxian_obj.val())) {
                luxian_obj.focus();
                luxian_obj.parent().find(".err-tips").html("请填写交通路线");
                return false;
            };
            if (!App.validate.run(text_obj.val())) {
                text_obj.focus();
                text_obj.parent().find(".err-tips").html("请填写简介");
                return false;
            };
            $.post('/Companyinfo/edit_detail_info', {
                quyu: quyu,
                fuwu: fuwu,
                fengge: fengge,
                baozhang: baozhang,
                jiawei: jiawei,
                chengli: chengli,
                guimo: guimo,
                luxian: luxian,
                team_num: team_num.val(),
                text: text
            },
            function(res) {
                if (res.info != 'Ok') {
                    _this.parent().find(".err-tips").html(res.data);
                } else {
                    window.location.href = window.location.href;
                }
            },
            'json');
        });

        /*
          2016-4-29修改
          */
        //checkbox点击添加选择
        $(".c-info-list-check li").each(function() {
            var $addList = $(this).find("input[type=checkbox]");
            var html = "";
            if ($addList.prop("checked")) {
                html += $addList.parents("label").text();
                $(this).parents("li").find(".c-info-check-info").append("<li>" + html + "</li>");
            }
        });

        $(".c-info-add-list").on("click",
        function() {
            var $checkinfo = $(this).parent().find(".c-info-list-check"),
            $checkbtn = $(this);
            $checkinfo.css("display", "block");
            $checkbtn.css("display", "none");
            $(this).parents("li").find(".c-info-check-info").empty();
            $checkinfo.find(".c-info-list-btn").on("click",
            function() {
                $checkinfo.css("display", "none");
                var $checkinfolist = $checkinfo.find("ul li");
                var $checkinfolistlabel = $checkinfolist.find(".icheck");
                var arr = [];
                var html = "";
                $checkinfolist.find("input[type=checkbox]").each(function() {
                    if ($(this).prop("checked")) {
                        html += "<li>" + $(this).parents("label").text() + "</li>";
                    }
                });
                arr.push(html);
                $(this).parents("li").find(".c-info-check-info").html(arr.join(""));
                $checkbtn.css("display", "block");
            });
        });
    });
    $("input[name='team_num']").on('keyup',function () {
        var value = $("input[name='team_num']");
        if(!isPositiveNum(value.val())){
            value.focus();
            value.parent().find(".err-tips").html("请填写真实的数量。");
            return false;
        }else {
            value.parent().find(".err-tips").html("");
        }
    });
    //是否为正整数
    function isPositiveNum(s){
        var re = /^[0-9]*[1-9][0-9]*$/;
        return re.test(s)
    }
</script>