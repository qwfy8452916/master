<extend name="Main:baseTemplate" /><block name="title">    <title>新客服有效量房统计-控制台</title></block><block name="style">    <link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/datetimepicker/datepicker.css?v={:C('STATIC_VERSION')}" />    <link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/select2/select2.css?v={:C('STATIC_VERSION')}" />    <link rel="stylesheet" type="text/css" href="/assets/home/css/customerorderliangfang.css?v={:C('STATIC_VERSION')}" />    <link href="/assets/common/phpexcel/phpexcel.css?v={:C('STATIC_VERSION')}" rel="stylesheet">    <link href="/assets/common/phpexcel/handsontable.full.min.css?v={:C('STATIC_VERSION')}" rel="stylesheet">    <link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/dataTables/dataTables.bootstrap.min.css?v={:C('STATIC_VERSION')}" /></block><block name="content">    <section class="content-header">        <h1>新客服有效量房统计</h1>        <ol class="breadcrumb">            <li>                <a href="/"><i class="fa fa-dashboard"></i> 控制面板</a>            </li>            <li>                <a href="/orderstat/customerorderyouxiaoliangfang/">新客服有效量房统计</a>            </li>        </ol>    </section>    <section class="content">        <div class="row">            <div class="col-xs-12">                <div class="box">                    <div class="row">                        <form class="form-horizontal" method="GET" action="/orderstat/customerorderyouxiaoliangfang/">                            <div class="col-xs-12">                                <ul class="npoc-tab-wrap">                                    <li class="npoc-tab" data-tab='1'>                                        <a href="/orderstat/customerorderyouxiaoliangfang/?index=1"><span style="font-size: 14px;">按人统计</span></a>                                    </li>                                    <li class="npoc-tab" data-tab='2'>                                        <a href="/orderstat/customerorderyouxiaoliangfang/?index=2">按组统计</a>                                    </li>                                    <li class="npoc-tab" data-tab='3'>                                        <a href="/orderstat/customerorderyouxiaoliangfang/?index=3">按师统计</a>                                    </li>                                    <li class="npoc-tab" data-tab='4'>                                        <a href="/orderstat/customerorderyouxiaoliangfang/?index=4">客服中心统计</a>                                    </li>                                </ul>                            </div>                        </form>                    </div>                </div>            </div>            <div class="col-xs-12" id="tab1">                <div class="box">                    <div class="box-header">                        <form action="/orderstat/customerorderyouxiaoliangfang/" method="get">                            <div class="col-xs-2">                                <div>客服姓名</div>                                <select id="kfList" name="kf" data-search='1' class="form-control" name="kf">                                    <volist name="kflist" id="vo">                                        <option value="{$vo.id}">{$vo.name}</option>                                    </volist>                                </select>                            </div>                            <div class="col-xs-2">                                <div>客服组</div>                                <select id="groups1" name="groups" data-search='1' type="text" class="form-control" tabindex="3">                                    <volist name="groups" id="vo">                                        <option value="{$vo.kfgroup}">{$vo.name}</option>                                    </volist>                                </select>                            </div>                            <div class="col-xs-2">                                <div>查询月份</div>                                <input type="text" data-search='1' name="begin" class="form-control datepicker" placeholder="选择日期" readonly="true" style="background-color: white" value="{$Think.get.begin}">                            </div>                            <div class="col-xs-2 pull-right">                                <div style="opacity:0;">查询</div>                                <button type="submit" id="olSearch" class="btn-info form-control">查询</button>                                <input type="hidden" name="index" value="1" />                            </div>                            <div class="col-xs-2 pull-right">                                <div style="opacity:0;">导出EXCEL</div>                                <button type="button" class="btn-success form-control export" data-tab="1">导出EXCEL</button>                            </div>                        </form>                    </div>                    <div class="box-body table-responsive no-padding" style="max-height: 2370px;overflow-y: scroll;">                        <table id="myTable2" class="table table-hover table-bordered">                            <thead>                            <tr>                                <th>序号</th>                                <th>客服姓名</th>                                <th>客服组</th>                                <th>发单量</th>                                <th>分单量</th>                                <th>赠单量</th>                                <th>有效量房数</th>                                <th>量房率</th>                                <th>考核月份</th>                                <th>详情</th>                            </tr>                            </thead>                            <tbody>                            <volist name="list" id="vo" key="key">                                <tr>                                    <td>{$key}</td>                                    <td class="center-middle">{$vo.name}</td>                                    <td>{$vo.kfgroup}</td>                                    <td>{$vo.all|default=0}</td>                                    <td>{$vo.fen|default=0}</td>                                    <td>{$vo.zen|default=0}</td>                                    <td>{$vo.youxiao|default=0}</td>                                    <td>{$vo.youxiao_rate|default=0}%</td>                                    <td>{$vo.month|default=0}</td>                                    <td>                                        <a href="javascript:void(0);" data-name="detail">详情</a>                                        <input type="hidden" value="{$vo.kf}" id="kf">                                        <input type="hidden" value="{$vo.begin}" id="month">                                        <input type="hidden" value="{$vo.kfgroup}" id="kfgroup">                                        <input type="hidden" value="{$vo.name}" id="kfname">                                        <input type="hidden" value="{$vo.month}" id="khmonth">                                    </td>                                </tr>                            </volist>                            </tbody>                        </table>                    </div>                </div>            </div>            <div class="col-xs-12" id="tab2">                <div class="box">                    <div class="box-header">                        <form action="/orderstat/customerorderyouxiaoliangfang/" method="get">                            <div class="col-xs-2">                                <div>客服组</div>                                <select id="groups2" name="groups" data-search='1' class="form-control" type="text">                                    <volist name="groups" id="vo">                                        <option value="{$vo.kfgroup}">{$vo.name}</option>                                    </volist>                                </select>                            </div>                            <div class="col-xs-2">                                <div>客服师</div>                                <select id="manager1" name="manager" data-search='1' name="cs" type="text" class="form-control" tabindex="3">                                    <volist name="manager" id="vo">                                        <option value="{$vo.id}">{$vo.name}</option>                                    </volist>                                </select>                            </div>                            <div class="col-xs-2">                                <div>查询月份</div>                                <input type="text" data-search='1' name="begin" class="form-control datepicker" placeholder="选择日期" readonly="true" style="background-color: white" value="{$Think.get.begin}">                            </div>                            <div class="col-xs-2 pull-right">                                <div style="opacity:0;">查询</div>                                <button type="submit" id="olSearch" class="btn-info form-control">查询</button>                                <input type="hidden" name="index" value="2" />                            </div>                            <div class="col-xs-2 pull-right">                                <div style="opacity:0;">导出EXCEL</div>                                <button type="button"  class="btn-success form-control export" data-tab="2">导出EXCEL</button>                            </div>                        </form>                    </div>                    <div class="box-body table-responsive no-padding">                        <table id="myTable3" class="table table-hover table-bordered">                            <thead>                            <tr>                                <th>序号</th>                                <th>客服组</th>                                <th>客服师</th>                                <th>发单量</th>                                <th>分单量</th>                                <th>赠单量</th>                                <th>有效量房数</th>                                <th>量房率</th>                                <th>考核月份</th>                            </tr>                            </thead>                            <tbody>                            <volist name="grouplist" id="vo" key="key">                                <tr>                                    <td>{$key}</td>                                    <td>{$vo.kfgroup}组</td>                                    <td>{$vo.manager}</td>                                    <td>{$vo.all|default=0}</td>                                    <td>{$vo.fen|default=0}</td>                                    <td>{$vo.zen|default=0}</td>                                    <td>{$vo.youxiao|default=0}</td>                                    <td>{$vo.youxiao_rate|default=0}%</td>                                    <td>{$vo.month|default=0}</td>                                </tr>                            </volist>                            </tbody>                        </table>                    </div>                </div>            </div>            <div class="col-xs-12" id="tab3">                <div class="box">                    <div class="box-header">                        <form action="/orderstat/customerorderyouxiaoliangfang/" method="get">                            <div class="col-xs-2">                                <div>客服师</div>                                <select id="manager2" name="manager" data-search='1' class="form-control" type="text">                                    <volist name="manager" id="vo">                                        <option value="{$vo.id}">{$vo.name}</option>                                    </volist>                                </select>                            </div>                            <div class="col-xs-2">                                <div>查询月份</div>                                <input type="text" data-search='1' name="begin" class="form-control datepicker" placeholder="选择日期" readonly="true" style="background-color: white" value="{$Think.get.begin}">                            </div>                            <div class="col-xs-2 pull-right">                                <div style="opacity:0;">查询</div>                                <button type="submit" id="olSearch" class="btn-info form-control">查询</button>                                <input type="hidden" name="index" value="3" />                            </div>                            <div class="col-xs-2 pull-right">                                <div style="opacity:0;">导出EXCEL</div>                                <button type="button" class="btn-success form-control export" data-tab="3">导出EXCEL</button>                            </div>                        </form>                    </div>                    <div class="box-body table-responsive no-padding" style="max-height: 2370px;overflow-y: scroll;">                        <table id="myTable4" class="table table-hover table-bordered">                            <thead>                            <tr>                                <th>客服组数</th>                                <th>负责人</th>                                <th>发单量</th>                                <th>分单量</th>                                <th>赠单量</th>                                <th>有效量房数</th>                                <th>量房率</th>                                <th>考核月份</th>                            </tr>                            </thead>                            <tbody>                            <volist name="managerlist" id="vo">                                <volist name="vo.child" id="v">                                    <tr>                                        <td>{$v.kfgroup}组</td>                                        <td>{$v.groupmanager}</td>                                        <td>{$v.all|default=0}</td>                                        <td>{$v.fen|default=0}</td>                                        <td>{$v.zen|default=0}</td>                                        <td>{$v.youxiao|default=0}</td>                                        <td>{$v.youxiao_rate|default=0}%</td>                                        <td>{$v.month|default=0}</td>                                    </tr>                                </volist>                                <tr>                                    <td class="center-middle"><b>汇总</b></td>                                    <td><b>{$vo.manager}</b></td>                                    <td><b>{$vo.all|default=0}</b></td>                                    <td><b>{$vo.fen|default=0}</b></td>                                    <td><b>{$vo.zen|default=0}</b></td>                                    <td><b>{$vo.youxiao|default=0}</b></td>                                    <td><b>{$vo.youxiao_rate|default=0}%</b></td>                                    <td><b>{$vo.month|default=0}</b></td>                                </tr>                            </volist>                            <tr>                                <td class="center-middle">总计</td>                                <td>-</td>                                <td>{$total.all|default=0}</td>                                <td>{$total.fen|default=0}</td>                                <td>{$total.zen|default=0}</td>                                <td>{$total.youxiao|default=0}</td>                                <td>{$total.youxiao_rate|default=0}%</td>                                <td>{$total.month|default=0}</td>                            </tr>                            </tbody>                        </table>                    </div>                </div>            </div>            <div class="col-xs-12" id="tab4">                <div class="box">                    <div class="box-header">                        <form action="/orderstat/customerorderyouxiaoliangfang/" method="get">                            <div class="col-xs-2">                                <div>查询时间-开始:</div>                                <input type="text" data-search='1' name="begin" class="form-control datepicker" placeholder="选择日期" readonly="true" style="background-color: white" value="{$Think.get.begin}">                            </div>                            <div class="col-xs-2">                                <div>查询时间-结束:</div>                                <input type="text" data-search='1' name="end" class="form-control datepicker" placeholder="选择日期" readonly="true" style="background-color: white" value="{$Think.get.end}">                            </div>                            <div class="col-xs-1 pull-right">                                <div style="opacity:0;">查询</div>                                <button type="submit" id="olSearch" class="btn-info form-control">查询</button>                                <input type="hidden" name="index" value="4" />                            </div>                            <div class="col-xs-1 pull-right">                                <div style="opacity:0;">导出EXCEL</div>                                <button type="button" class="btn-success form-control export" data-tab="4">导出EXCEL</button>                            </div>                        </form>                    </div>                    <div class="box-body table-responsive no-padding">                        <table id="myTable5" class="table table-hover table-bordered">                            <thead>                            <tr>                                <th>考核月份</th>                                <th>发单量</th>                                <th>分单量</th>                                <th>赠单量</th>                                <th>有效量房数</th>                                <th>量房率</th>                            </tr>                            </thead>                            <tbody>                            <volist name="center.child" id="vo">                                <tr>                                    <td>{$vo.date}</td>                                    <td>{$vo.all|default=0}</td>                                    <td>{$vo.fen|default=0}</td>                                    <td>{$vo.zen|default=0}</td>                                    <td>{$vo.youxiao|default=0}</td>                                    <td>{$vo.youxiao_rate|default=0}%</td>                                </tr>                            </volist>                            </tbody>                        </table>                    </div>                </div>            </div>        </div>        <div class="col-xs-12 instruction">            <p><strong>说明：</strong></p>            <p>发单量：在考核月前的3个月（包括考核月）内发布的订单；</p>            <p>分单量：在考核月前的3个月（包括考核月）内的分单；</p>            <p>赠单量：在考核月前的3个月（包括考核月）内的赠单；</p>            <p>有效量房数：在考核月前的3个月（包括考核月）内的分（赠）单，在考核月当月被装修公司点击为“已见面/已到店”、“已量房”、“已签约”状态，则该分（赠）单被视为有效量房单。例如，客服在6月、7月、8月份的分单，在8月这一个月内被装修公司点击为“已见面/已到店”、“已量房”、“已签约”的订单，则该订单被视为8月的有效量房单。</p>            <p>量房率：量房率=量房数/（分单数+赠单数）。</p>        </div>    </section>    <iframe class="mask" src="about:blank" allowtransparency="true" marginheight="0" marginwidth="0" frameborder="0"></iframe>    <div class="order-detail">        <div class="title"><strong>客服姓名：</strong><span id="kfname"></span> <strong>客服组：</strong><span id="kfgroup"></span> <strong>考核月份：</strong><span id="kfmonth"></span></div>        <span class="close">×</span>        <table class="table table-hover table-bordered" id="kf-assessment">            <thead>            <tr>                <th>序号</th>                <th>订单号</th>                <th>分单时间</th>                <th>量房公司</th>                <th>量房时间</th>                <th>量房状态</th>                <th>城市</th>                <th>归属人</th>            </tr>            </thead>            <tbody>            <!--<td>1</td>-->            <!--<td>2</td>-->            <!--<td>3</td>-->            <!--<td>4</td>-->            <!--<td>5</td>-->            <!--<td>6</td>-->            <!--<td>7</td>-->            <!--<td>8</td>-->            </tbody>        </table>    </div></block><block name="script">    <script type="text/javascript" src="/assets/common/js/plugins/datetimepicker/bootstrap-datepicker.js?v={:C('STATIC_VERSION')}"></script>    <script type="text/javascript" src="/assets/common/js/plugins/select2/select2.full.min.js?v={:C('STATIC_VERSION')}"></script>    <script src="/assets/common/phpexcel/handsontable.full.min.js?v={:C('STATIC_VERSION')}"></script>    <script src="/assets/common/phpexcel/phpexcel.js?v={:C('STATIC_VERSION')}"></script>    <script type="text/javascript" src="/assets/common/js/plugins/dataTables/jquery.dataTables.min.js?v={:C('STATIC_VERSION')}"></script>    <script>        $(function() {            $(".datepicker").datepicker({                format:"yyyy-mm",                autoclose: true            });            $("#kfList").select2({                allowClear: true,                placeholder: "选择客服"            }).on('select2:select', function (e) {                $("#groups1").attr("disabled","disabled");            }).on("select2:unselect",function(e){                $("#groups1").attr("disabled",false);            });            $("#kfList").select2("val","{$Think.get.kf}");            $("#groups1").select2({                allowClear: true,                placeholder: "选择客服组"            }).on('select2:select', function (e) {                $("#kfList").attr("disabled","disabled");            }).on("select2:unselect",function(e){                $("#kfList").attr("disabled",false);            });            $("#groups1").select2("val","{$Think.get.groups}");            $("#groups2").select2({                allowClear: true,                placeholder: "选择客服组"            }).on('select2:select', function (e) {                $("#manager1").attr("disabled","disabled");            }).on("select2:unselect",function(e){                $("#manager1").attr("disabled",false);            });            $("#groups2").select2("val","{$Think.get.groups}");            $("#manager1").select2({                allowClear: true,                placeholder: "选择师长"            }).on('select2:select', function (e) {                $("#groups2").attr("disabled","disabled");            }).on("select2:unselect",function(e){                $("#groups2").attr("disabled",false);            });            $("#manager1").select2("val","{$Think.get.manager}");            $("#manager2").select2({                allowClear: true,                placeholder: "选择师长"            });            $("#manager2").select2("val","{$Think.get.manager}");            // 初始化select状态，当执行搜索且某个select有选中值的话，当前tab页下的其他select都要禁用            initSelectStatus()            $('.npoc-tab-wrap li.npoc-tab').eq({$Think.get.index|default=1}-1).addClass('npoc-tab-active');            //tab切换            $('.npoc-tab').on('click', function() {                $('.npoc-tab').removeClass('npoc-tab-active');                $(this).addClass('npoc-tab-active');                var tabIndex = $(this).attr('data-tab');                $("#tab1,#tab2,#tab3,#tab4,#tab5").hide();                $('#tab'+tabIndex).show();            });            $(".npoc-tab-active").trigger('click');            $(".export").click(function(event) {                var _this = $(this);                var tab =  _this.attr("data-tab");                var taget = $("#tab"+tab+" table");                var colums = [];                var data = [];                taget.find("th").each(function() {                    var text = $(this).text().trim();                    var sub = [];                    sub["text"] = text;                    sub["fontColor"] = $(this).css("color");                    sub["bgColor"] = $(this).css("background-color");                    colums.push(sub);                });                data.push(colums);                taget.find("tbody tr").each(function(i) {                    var tr = $(this);                    var sub = [];                    tr.find("td").each(function() {                        var text = $(this).text().trim();                        var _td = {                            text: text,                            fontColor: $(this).css("color"),                            bgColor: $(this).css("background-color")                        }                        sub.push(_td);                    });                    data.push(sub);                });                _this.exportExcel({                    data: data,                    title: "新客服有效量房统计",                    url: "/export/download",                    show:true                });            });        });        $(function () {            var Global_Detail_url = '/orderstat/getKfOrderyouxiaoliangfangdetail/'            var $orderDetailBox = $(".order-detail"),                $mask = $('.mask'),                $myTable2 = $('#myTable2'),                $kfAssessment = $orderDetailBox.find('#kf-assessment');            $orderDetailBox.find('.close').on('click', function () {                $orderDetailBox.fadeOut(0);                $mask.fadeOut(0)            })            $myTable2.on("click", function (event) {                var $target = $(event.target),                    kfV = $target.closest("td").find('#kf').val(),                    monthV = $target.closest("td").find('#month').val(),                    kfname = $target.closest("td").find('#kfname').val(),                    kfmonth = $target.closest("td").find('#khmonth').val(),                    kfgroup = $target.closest("td").find('#kfgroup').val();                if(!monthV) {                    monthV = new Date().getFullYear() + '-' + (new Date().getMonth() + 1)                }                if ($target.attr('data-name') == 'detail') {                    ajaxAction({                        url: Global_Detail_url,                        method : "get",                        data : {                            begin: monthV,                            kf: kfV                        },                        successCallback: function (res) {                            var tmp = '';                            if(res.status == 1) {                                res.data.forEach(function (item,index) {                                    tmp+="<tr><td>"+(index+1)+"</td>\n" +                                            "<td>"+item.order_id+"</td>\n" +                                            "<td>"+item.fdtime+"</td>\n" +                                            "<td>"+item.jc+"</td>\n" +                                            "<td>"+item.lftime+"</td>\n" +                                            "<td>"+item.dj_status+"</td>\n" +                                            "<td>"+item.cname+"</td>\n" +                                            "<td>"+item.op_name+"</td></tr>"                                })                            }                            $kfAssessment.find("tbody").html(tmp);                            $mask.fadeIn(0)                            $orderDetailBox.css("top", parseInt($(window).scrollTop()) + 100).fadeIn(0)                            $orderDetailBox.find("#kfname").text(kfname)                            $orderDetailBox.find("#kfgroup").text(kfgroup)                            $orderDetailBox.find("#kfmonth").text(kfmonth)                        },                        failCallback: function (res) {                            alert('网络异常，请稍后重试')                        }                    })                }            })        })        /**         * ajax请求，所有的请求都通过这里发送         * @param options         */        function ajaxAction(options){            var defalutOptions = {                url : "",                method : "get",                data : null,                successCallback : null,                failCallback : null            };            options = $.extend({}, defalutOptions, options);            console.log(options);            $.ajax({                url : options.url,                data : options.data,                method : options.method,                success : function(res){                    options.successCallback && options.successCallback(res);                },                fail : function(res){                    options.failCallback && options.failCallback(res);                }            });        }        /**         * 初始化select状态，分离参数         * @param localIndex  当前选项卡索引         */        function initSelectStatus(localIndex) {            var localIndex = parseInt(location.href.slice(location.href.indexOf("index")).split("=")[1]);            var tabOneSelector = ["#kfList", "#groups1"],  // 按人统计两个select选择器                tabTwoSelector = ["#groups2", "#manager1"];  // 按组统计两个select选择器            var selectorArr = null,                currentSelectIndex = 0;            if(!localIndex) {                localIndex = 1            }            switch (localIndex) {                case 1:                    selectorArr = tabOneSelector;                    currentSelectIndex = watchSelect(selectorArr);                    break;                case 2:                    selectorArr = tabTwoSelector;                    currentSelectIndex = watchSelect(selectorArr);                    break;            }            if(currentSelectIndex !== null){                disableSomeSelect(selectorArr, currentSelectIndex)            }        }        /**         * 判断当前哪个select处于选择状态         * @param selectorArr  选择器数组         */        function watchSelect(selectorArr) {            if(!Array.isArray(selectorArr)){                return            }            var selectIndex = null;            selectorArr.forEach(function (item, index) {                if($(item).val()){                    selectIndex = index                }            })            return selectIndex        }        /**         *         * @param optionSelector  当前选项卡选择器列表         * @param currentSelect  当前有值的select, int类型         */        function disableSomeSelect(optionSelector, currentSelect) {            if(!Array.isArray(optionSelector)){                return            }            optionSelector.forEach(function (item, index) {                if(currentSelect != index) {                    $(item).attr("disabled","disabled");                }            })        }    </script></block>