<extend name="Main:baseTemplate" />
<block name="title">
    <title>设置专题-控制台</title>
</block>
<block name="style">
<link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/fileinput/fileinput.min.css?v={:C('STATIC_VERSION')}" />
<link href="/assets/common/js/plugins/icheck/skins/all.css?v={:C('STATIC_VERSION')}" rel="stylesheet">
<link href="/assets/common/js/plugins/icheck/skins/flat/grey.css?v={:C('STATIC_VERSION')}" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="{:C('168NEW_URL')}/assets/common/css/select2_metro.css?v={:C('STATIC_VERSION')}" />
<link href="/assets/home/css/specialarticle.css?v={:C('STATIC_VERSION')}" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/assets/common/css/Alert.css?v={:C('STATIC_VERSION')}" />
</block>
<block name="content">
    <section class="content-header">
        <h1>设置专题</h1>
    </section>
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <form id="myForm" class="form-horizontal" method="GET" onsubmit="return false">
                        <div class="box-body">
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">专题标题</label>
                                <div class="col-sm-4">
                                    <input type="text" name="title" class="form-control" placeholder="专题标题" value="{$info.title}"  />
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">专题导语</label>
                                <div class="col-sm-4">
                                    <textarea name="description" class="form-control" placeholder="专题导语">{$info.description}</textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">专题类型</label>
                                <div class="col-sm-4">
                                    <select name="type" class="form-control">
                                        <option value="">-请选择-</option>
                                        <volist name="class" id="vo">
                                        <if condition="$info['type'] EQ $vo['id']">
                                         <option value="{$vo.id}" selected="selected">{$vo.classname}</option>
                                        <else/>
                                        <option value="{$vo.id}">{$vo.classname}</option>
                                        </if>
                                        </volist>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">推荐攻略首页</label>
                                <div class="col-sm-4">
                                    <if condition="$info['istop'] EQ 1">
                                    <label class="control-label">
                                    <input  class="icheck" type="radio" name="istop" checked="checked"  value="1" />&nbsp;&nbsp;推荐&nbsp;&nbsp;&nbsp;&nbsp;
                                     <input  class="icheck" type="radio" name="istop"  value="0" />&nbsp;&nbsp;不推荐
                                    </label>
                                    <else/>
                                    <label class="control-label">
                                    <input  class="icheck" type="radio" name="istop"  value="1" />&nbsp;&nbsp;推荐&nbsp;&nbsp;&nbsp;&nbsp;
                                     <input  class="icheck" type="radio" name="istop" checked="checked"  value="0" />&nbsp;&nbsp;不推荐
                                    </label>
                                    </if>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">推荐专题首页</label>
                                <div class="col-sm-4">
                                    <if condition="$info['isbanner'] EQ 1">
                                    <label class="control-label">
                                    <input  class="icheck" type="radio" name="isbanner" checked="checked"  value="1" />&nbsp;&nbsp;推荐&nbsp;&nbsp;&nbsp;&nbsp;
                                     <input  class="icheck" type="radio" name="isbanner"  value="0" />&nbsp;&nbsp;不推荐
                                    </label>
                                    <else/>
                                    <label class="control-label">
                                    <input  class="icheck" type="radio" name="isbanner"  value="1" />&nbsp;&nbsp;推荐&nbsp;&nbsp;&nbsp;&nbsp;
                                     <input  class="icheck" type="radio" name="isbanner" checked="checked"    value="0" />&nbsp;&nbsp;不推荐
                                    </label>
                                    </if>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">专题封面</label>
                                <div class="col-sm-4">
                                    <input id="img"  type="file" class="form-control" />
                                    <input type="hidden" name="img" value="{$info.cover_img}"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">专题大图</label>
                                <div class="col-sm-8">
                                    <input id="bigImg"  type="file" class="form-control" />
                                    <input type="hidden" name="bigImg" value="{$info.cover_bigimg}"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">图片模块</label>
                                <div class="col-sm-4">
                                    <button type="button" class="btn-add">
                                        <i>图片模块</i>
                                        <i class="fa fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group module">
                                <div class="col-sm-4 col-sm-offset-1">
                                    <div class="row">
                                        <div class="col-sm-12 img_content" >
                                            <div class="panel panel-info">
                                                <div class="panel-heading">
                                                    <div class="form-group" style="margin-bottom: 0">
                                                        <label  class="col-sm-2 control-label">模块标题</label>
                                                        <div class="col-sm-9">
                                                            <input id="meitu_title" type="text" class="form-control" placeholder="输入模块标题" value="{$info['meitu']['title']}" />
                                                        </div>
                                                        <br style="clear: both;" />
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <for start="0" end="7">
                                                    <div class="form-group subItem">
                                                        <table class="col-sm-11">
                                                            <tr>
                                                                <td class="col-sm-2">
                                                                    <label class="control-label">位置{$i+1}</label>
                                                                </td>
                                                                <td class="col-sm-10" style="border:1px solid #bce8f1; margin:0 10px; padding:10px; ">
                                                                    <table class="col-sm-12">
                                                                        <tr>
                                                                            <td>
                                                                                <label class="control-label pull-left">标题</label>
                                                                                <div class="col-sm-11">
                                                                                    <input id="search_img_{$i}" type="text" class="search_img" placeholder="输入标题" data-val="{$info['meitu']['child'][$i]['title']}" data-id="{$info['meitu']['child'][$i]['id']}" data-url="{$info['meitu']['child'][$i]['url']}" />
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <label class="control-label pull-left">链接</label>
                                                                                <div class="col-sm-11" style="margin-top: 5px;">
                                                                                    <input type="text" class="form-control url" placeholder="链接" readonly="readonly" />
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                  </for>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="prev">
                                    <div class="panel panel-warning">
                                        <div class="panel-heading">美图位置示意图:</div>
                                        <table class="table table-bordered">
                                            <tr>
                                                <td class="warning" rowspan="2" style="vertical-align: middle;">
                                                    位置1
                                                </td>
                                                <td class="warning">
                                                    位置2
                                                </td>
                                                <td class="warning">
                                                    位置3
                                                </td>
                                                <td class="warning">
                                                    位置4
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="warning">
                                                     位置5
                                                </td>
                                                <td class="warning">
                                                     位置6
                                                </td>
                                                <td class="warning">
                                                    位置7
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">文章模块</label>
                                <div class="col-sm-4">
                                    <button type="button" class="btn-add">
                                        <i>文章模块</i>
                                        <i class="fa fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group module">
                                <div class="col-sm-4 col-sm-offset-1">
                                    <div class="row">
                                        <div class="col-sm-12 img_content" >
                                            <div class="panel panel-info">
                                                <div class="panel-heading">
                                                    <div class="form-group" style="margin-bottom: 0">
                                                        <label  class="col-sm-2 control-label">模块1</label>
                                                        <div class="col-sm-9">
                                                            <input id="article_title_1" type="text" class="form-control" placeholder="输入模块标题" value="{$info['article_1']['title']}"/>
                                                        </div>
                                                        <br style="clear: both;" />
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <for start="0" end="6">
                                                    <div class="form-group subItem">
                                                        <table class="col-sm-11">
                                                            <tr>
                                                                <td class="col-sm-2">
                                                                    <label class="control-label">标题{$i+1}</label>
                                                                </td>
                                                                <td class="col-sm-10" style="border:1px solid #bce8f1; margin:0 10px; padding:10px; ">
                                                                    <table class="col-sm-12">
                                                                        <tr>
                                                                            <td>
                                                                                <label class="control-label pull-left">标题</label>
                                                                                <div class="col-sm-11">
                                                                                    <input id="search_article_1_{$i}" type="text" class="search_article" placeholder="输入标题" data-val="{$info['article_1']['child'][$i]['title']}" data-id="{$info['article_1']['child'][$i]['id']}" />
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                  </for>
                                                </div>
                                            </div>
                                            <div class="panel panel-info">
                                                <div class="panel-heading">
                                                    <div class="form-group" style="margin-bottom: 0">
                                                        <label  class="col-sm-2 control-label">模块2</label>
                                                        <div class="col-sm-9">
                                                            <input id="article_title_2" type="text" class="form-control" placeholder="输入模块标题" value="{$info['article_2']['title']}"/>
                                                        </div>
                                                        <br style="clear: both;" />
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <for start="0" end="5">
                                                    <div class="form-group subItem">
                                                        <table class="col-sm-11">
                                                            <tr>
                                                                <td class="col-sm-2">
                                                                    <label class="control-label">标题{$i+1}</label>
                                                                </td>
                                                                <td class="col-sm-10" style="border:1px solid #bce8f1; margin:0 10px; padding:10px; ">
                                                                    <table class="col-sm-12">
                                                                        <tr>
                                                                            <td>
                                                                                <label class="control-label pull-left">标题</label>
                                                                                <div class="col-sm-11">
                                                                                    <input id="search_article_2_{$i}" type="text" class="search_article" placeholder="输入标题" data-val="{$info['article_2']['child'][$i]['title']}" data-id="{$info['article_2']['child'][$i]['id']}"  />
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                  </for>
                                                </div>
                                            </div>
                                            <div class="panel panel-info">
                                                <div class="panel-heading">
                                                    <div class="form-group" style="margin-bottom: 0">
                                                        <label  class="col-sm-2 control-label">模块3</label>
                                                        <div class="col-sm-9">
                                                            <input id="article_title_3" type="text" class="form-control" placeholder="输入模块标题" value="{$info['article_3']['title']}"/>
                                                        </div>
                                                        <br style="clear: both;" />
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <for start="0" end="4">
                                                    <div class="form-group subItem">
                                                        <table class="col-sm-11">
                                                            <tr>
                                                                <td class="col-sm-2">
                                                                    <label class="control-label">标题{$i+1}</label>
                                                                </td>
                                                                <td class="col-sm-10" style="border:1px solid #bce8f1; margin:0 10px; padding:10px; ">
                                                                    <table class="col-sm-12">
                                                                        <tr>
                                                                            <td>
                                                                                <label class="control-label pull-left">标题</label>
                                                                                <div class="col-sm-11">
                                                                                    <input id="search_article_3_{$i}" type="text" class="search_article" placeholder="输入标题" data-val="{$info['article_3']['child'][$i]['title']}" data-id="{$info['article_3']['child'][$i]['id']}"  />
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                  </for>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="prev">
                                    <div class="panel panel-warning">
                                        <div class="panel-heading">文章模块1位置示意图:</div>
                                        <table class="table table-bordered">
                                            <tr>
                                                <td class="warning" rowspan="2" style="vertical-align: middle;">
                                                   文章标题1
                                                </td>
                                                <td class="warning">
                                                    文章标题2
                                                </td class="warning">
                                                <td class="warning" rowspan="2" style="vertical-align: middle;">
                                                    文章标题3
                                                </td>
                                                <td class="warning">
                                                     文章标题4
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="warning">
                                                    文章标题5
                                                </td>
                                                <td class="warning">
                                                    文章标题6
                                                </td>
                                            </tr>
                                        </table>
                                    </div>

                                    <div class="panel panel-warning panel-module2">
                                        <div class="panel-heading">文章模块2位置示意图:</div>
                                        <table class="table table-bordered">
                                            <tr>
                                                <td class="warning">
                                                   文章标题1
                                                </td>
                                                <td class="warning">
                                                    文章标题2
                                                </td>
                                                <td class="warning">
                                                    文章标题3
                                                </td>
                                                <td class="warning">
                                                     文章标题4
                                                </td>
                                            </tr>
                                        </table>
                                    </div>

                                    <div class="panel panel-warning panel-module3">
                                        <div class="panel-heading">文章模块3位置示意图:</div>
                                        <table class="table table-bordered">
                                            <tr>
                                                <td class="warning">
                                                   文章标题1
                                                </td>
                                                <td class="warning">
                                                    文章标题2
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="warning">
                                                    文章标题3
                                                </td>
                                                <td class="warning">
                                                    文章标题4
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">问答模块</label>
                                <div class="col-sm-4">
                                    <button type="button" class="btn-add">
                                        <i>问答模块</i>
                                        <i class="fa fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group module">
                                <div class="col-sm-4 col-sm-offset-1">
                                    <div class="row">
                                        <div class="col-sm-12 img_content" >
                                            <div class="panel panel-info">
                                                <div class="panel-heading">
                                                    <div class="form-group" style="margin-bottom: 0">
                                                        <label  class="col-sm-2 control-label">模块标题</label>
                                                        <div class="col-sm-9">
                                                            <input id="ask_title" type="text" class="form-control" placeholder="输入模块标题" value="{$info['ask']['title']}"/>
                                                        </div>
                                                        <br style="clear: both;" />
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <for start="0" end="9">
                                                    <div class="form-group subItem">
                                                        <table class="col-sm-11">
                                                            <tr>
                                                                <td class="col-sm-2">
                                                                    <label class="control-label">问答{$i+1}</label>
                                                                </td>
                                                                <td class="col-sm-10" style="border:1px solid #bce8f1; margin:0 10px; padding:10px; ">
                                                                    <table class="col-sm-12">
                                                                        <tr>
                                                                            <td>
                                                                                <label class="control-label pull-left">标题</label>
                                                                                <div class="col-sm-11">
                                                                                    <input id="search_ask_{$i}" type="text" class="search_ask" placeholder="输入标题" data-val="{$info['ask']['child'][$i]['title']|mbstr=0,20}" data-id="{$info['ask']['child'][$i]['id']}" />
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                  </for>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-1 control-label">视频模块</label>
                                <div class="col-sm-4">
                                    <button type="button" class="btn-add">
                                        <i>视频模块</i>
                                        <i class="fa fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group module">
                                <div class="col-sm-4 col-sm-offset-1">
                                    <div class="row">
                                        <div class="col-sm-12 img_content" >
                                            <div class="panel panel-info">
                                                <div class="panel-heading">
                                                    <div class="form-group" style="margin-bottom: 0">
                                                        <label  class="col-sm-2 control-label">模块标题</label>
                                                        <div class="col-sm-9">
                                                            <input id="video_title" type="text" class="form-control" placeholder="输入模块标题" value="{$info['video']['title']}"/>
                                                        </div>
                                                        <br style="clear: both;" />
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <for start="0" end="5">
                                                    <div class="form-group subItem">
                                                        <table class="col-sm-11">
                                                            <tr>
                                                                <td class="col-sm-2">
                                                                    <label class="control-label">视频{$i+1}</label>
                                                                </td>
                                                                <td class="col-sm-10" style="border:1px solid #bce8f1; margin:0 10px; padding:10px; ">
                                                                    <table class="col-sm-12">
                                                                        <tr>
                                                                            <td>
                                                                                <label class="control-label pull-left">标题</label>
                                                                                <div class="col-sm-11">
                                                                                    <input id="search_video_{$i}" type="text" class="search_video" placeholder="输入标题"  data-val="{$info['video']['child'][$i]['title']}" data-id="{$info['video']['child'][$i]['id']}" data-url="{$info['video']['child'][$i]['url']}"   />
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <label class="control-label pull-left">链接</label>
                                                                                <div class="col-sm-11" style="margin-top: 5px;">
                                                                                    <input type="text" class="form-control url" placeholder="链接" readonly="readonly" />
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                  </for>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-1 col-sm-1">
                                    <button id="btnSave" class="btn btn-block btn-info">保存</button>
                                    <input type="hidden" name="id" value="{$info.id}" />
                                </div>
                                <div class="col-sm-1">
                                    <a href="/specialarticle/" class="btn btn-block btn-default">返回</a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="box box-default">
                    <div class="alert alert-warning">
                        <p>说明</p>
                        <p>尺寸: 封面图片 440px * 310px  封面大图 930px * 340px</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
</block>
<block name="script">
<script src="{:C('168NEW_URL')}/assets/common/js/select2.min.js?v={:C('STATIC_VERSION')}"></script>
<!-- <script src="/assets/common/js/plugins/select2/zh-CN.js?v={:C('STATIC_VERSION')}"></script> -->
<script type="text/javascript" src="/assets/common/js/plugins/fileinput/fileinput.js?v={:C('STATIC_VERSION')}"></script>
<script type="text/javascript" src="/assets/common/js/plugins/fileinput/fileinput_locale_zh.js?v={:C('STATIC_VERSION')}"></script>
<script type="text/javascript" src="/assets/common/js/Alert.js?v={:C('STATIC_VERSION')}"></script>
<script type="text/javascript" src="/assets/common/js/plugins/icheck/icheck.min.js?v={:C('STATIC_VERSION')}"></script>

<script type="text/javascript">
    $("#bigImg").fileinput({
            language: 'zh', //设置语言,
            uploadUrl:"/upload/uploadImg",
            showCaption:false,
            browseClass:"btn btn-primary",
            allowedFileExtensions : ['jpg','png','gif'],
            maxFileCount:1,
            uploadClass:"btn btn-info",
            removeClass:"btn btn-danger",
            uploadAsync:true,
            dropZoneEnabled:false,
            previewSettings:{
                image: {width: "930px", height: "340px"}
            },
            layoutTemplates:{
                actionDelete:"",
                actionUpload:""
            },
            uploadExtraData:{
                prefix:"zhuanti"
            },
            minImageWidth: "930",//440
            minImageHeight: "340",//310
            maxImageWidth: "930",
            maxImageHeight: "340",
            initialPreview:{$info.bigImg|default=""|json_encode},
    }).on('fileuploaded', function(event, data) {
        var _this = $(this);
        if(data.response.status == 1){
            var obj = data.response.data;
            $("input[name=bigImg]").val(obj.name);
        }else{
            _this.Alert({
                msg:data.response.info,
                level:2
            });
        }
    }).on("fileuploaderror",function(event, data){
        var _this = $(this);
        _this.Alert({
            msg:"附件上传失败,请联系技术部门！",
            level:2
        });
        return false;
    }).on("fileclear",function(){
        $("input[name=bigImg]").val("");
    });

    $("#img").fileinput({
        language: 'zh', //设置语言,
        uploadUrl:"/upload/uploadImg",
        showCaption:false,
        browseClass:"btn btn-primary",
        allowedFileExtensions : ['jpg','png','gif'],
        maxFileCount:1,
        uploadClass:"btn btn-info",
        removeClass:"btn btn-danger",
        uploadAsync:true,
        dropZoneEnabled:false,
        previewSettings:{
            image: {width: "440px", height: "310px"}
        },
        layoutTemplates:{
            actionDelete:"",
            actionUpload:""
        },
        uploadExtraData:{
            prefix:"zhuanti"
        },
        minImageWidth: "440",//440
        minImageHeight: "310",//310
        maxImageWidth: "440",
        maxImageHeight: "310",
        initialPreview:{$info.img|default=""|json_encode},
    }).on('fileuploaded', function(event, data) {
        var _this = $(this);
        if(data.response.status == 1){
            var obj = data.response.data;
            $("input[name=img]").val(obj.name);
        }else{
            _this.Alert({
                msg:data.response.info,
                level:2
            });
        }
    }).on("fileuploaderror",function(event, data){
        var _this = $(this);
        _this.Alert({
            msg:"附件上传失败,请联系技术部门！",
            level:2
        });
        return false;
    }).on("fileclear",function(){
          $("input[name=img]").val("");
    });

    $('.icheck').iCheck({
        checkboxClass: 'icheckbox_flat-grey',
        radioClass: 'iradio_flat-grey',
        increaseArea: '' // optional
    });

    $(".btn-add").click(function(event) {
        var module = $(this).parents(".form-group").next(".module");

        if (module.is(":hidden")) {
            module.show();
            $(this).find(".fa").addClass('fa-eye-slash');
        } else {
            module.hide();
            $(this).find(".fa").removeClass('fa-eye-slash');
        }
    });

    $("#btnSave").click(function(event) {
        var _this = $(this);
        var data = $("#myForm").serializeArray();
        var img = {};
        img["title"] = $("#meitu_title").val();
        img["type"] = "meitu";
        img["child"] = {};
        $("input[id*=search_img_]").each(function(i){
            var _this = $(this);
            var subData = _this.select2("data");
            if (subData != null) {
                img["child"][i] = {
                    sort:i,
                    id:subData["id"],
                    title:subData["text"]
                }
            }
        });
        img = JSON.stringify(img);
        data.push({name:"meitu",value:img});

        var article = {};
        article[1] = {};
        article[1]["title"] = $("#article_title_1").val();
        article[1]["type"] = "article_1";
        article[1]["child"] = {};
        $("input[id*=search_article_1_]").each(function(i){
            var _this = $(this);
            var subData = _this.select2("data");
            if (subData != null) {
                article[1]["child"][i] = {
                    sort:i,
                    id:subData["id"],
                    title:subData["text"]
                }
            }
        });

        article[2] = {};
        article[2]["title"] = $("#article_title_2").val();
        article[2]["type"] = "article_2";
        article[2]["child"] = {};
        $("input[id*=search_article_2_]").each(function(i){
            var _this = $(this);
            var subData = _this.select2("data");
            if (subData != null) {
                article[2]["child"][i] = {
                    sort:i,
                    id:subData["id"],
                    title:subData["text"]
                }
            }
        });

        article[3] = {};
        article[3]["title"] = $("#article_title_3").val();
        article[3]["type"] = "article_3";
        article[3]["child"] = {};
        $("input[id*=search_article_3_]").each(function(i){
            var _this = $(this);
            var subData = _this.select2("data");
            if (subData != null) {
                article[3]["child"][i] = {
                    sort:i,
                    id:subData["id"],
                    title:subData["text"]
                }
            }
        });
        article = JSON.stringify(article);
        data.push({name:"article",value:article});

        var ask = {};
        ask["title"] = $("#ask_title").val();
        ask["type"] = "ask";
        ask["child"] = {};
        $("input[id*=search_ask_]").each(function(i){
            var _this = $(this);
            var subData = _this.select2("data");
            if (subData != null) {
                ask["child"][i] = {
                    id:subData["id"],
                    title:subData["text"],
                    sort:i
                }
            }
        });
        ask = JSON.stringify(ask);
        data.push({name:"ask",value:ask});

        var video = {};
        video["title"] = $("#video_title").val();
        video["type"] = "video";
        video["child"] = {};
        $("input[id*=search_video_]").each(function(i){
            var _this = $(this);
            var subData = _this.select2("data");
            if (subData != null) {
                video["child"][i] = {
                    id:subData["id"],
                    title:subData["text"],
                    sort:i
                }
            }
        });
        video = JSON.stringify(video);
        data.push({name:"video",value:video});

        $.ajax({
          url: '/specialarticle/specialup/',
          type: 'POST',
          dataType: 'json',
          data: data
        })
        .done(function(data) {
            if (data.status == 1) {
                window.location.href = "/specialarticle/";
            } else {
                _this.Alert({
                    msg:data.info,
                    level:2
                });
            }
        })
        .fail(function() {
            _this.Alert({
                msg:"操作失败,请联系技术部门！",
                level:2
            });
        });
    });

    $(".search_img").each(function(){
        var _this = $(this);
        _this.select2({
            allowClear: true,
            minimumInputLength: 1,
            maximumInputLength:10,
            query: function(query) {
                var result = null;
                $.ajax({
                      url: '/specialarticle/getmeitu/',
                      type: 'POST',
                      dataType: 'JSON',
                      data: {
                          condition: query.term
                      }
                })
                .done(function(data) {
                    if(data.status == 1){
                        var result = {
                           results: []
                        };
                        var company = data.data;
                        for(var i in data.data){
                            result.results.push({
                                id:data.data[i].id,
                                text: data.data[i].title,
                                url: data.data[i].url
                            });
                        }
                        query.callback(result);
                    }
                });
            }
        }).on("change",function(e){
            var data = _this.select2("data");
            _this.parents(".subItem").find('.url').val(data.url);
        });

        if (_this.attr("data-val") != "") {
            var data = {text:_this.attr("data-val"),id:_this.attr("data-id"),url:_this.attr("data-url")};
            _this.parents(".subItem").find('.url').val(_this.attr("data-url"));
            _this.select2("data",data);
        };
    });

    $(".search_article").each(function(){
        var _this = $(this);
        _this.select2({
            allowClear: true,
            minimumInputLength: 1,
            maximumInputLength:10,
            query: function(query) {
                var result = null;
                $.ajax({
                      url: '/specialarticle/getarticle/',
                      type: 'POST',
                      dataType: 'JSON',
                      data: {
                          condition: query.term
                      }
                })
                .done(function(data) {
                    if(data.status == 1){
                        var result = {
                           results: []
                        };
                        var company = data.data;
                        for(var i in data.data){
                            result.results.push({
                                id:data.data[i].id,
                                text: data.data[i].title,
                                url: data.data[i].url
                            });
                        }
                        query.callback(result);
                    }
                });
            }
        });

        if (_this.attr("data-val") != "") {
            var data = {text:_this.attr("data-val"),id:_this.attr("data-id")};
            _this.select2("data",data);
        };
    });

    $(".search_ask").each(function(){
        var _this = $(this);
        _this.select2({
            allowClear: true,
            minimumInputLength: 1,
            maximumInputLength:10,
            query: function(query) {
                var result = null;
                $.ajax({
                      url: '/specialarticle/getask/',
                      type: 'POST',
                      dataType: 'JSON',
                      data: {
                          condition: query.term
                      }
                })
                .done(function(data) {
                    if(data.status == 1){
                        var result = {
                           results: []
                        };
                        var company = data.data;
                        for(var i in data.data){
                            result.results.push({
                                id:data.data[i].id,
                                text: data.data[i].title,
                                url: data.data[i].url
                            });
                        }
                        query.callback(result);
                    }
                });
            }
        });

        if (_this.attr("data-val") != "") {
            var data = {text:_this.attr("data-val"),id:_this.attr("data-id")};
            _this.select2("data",data);
        };
    });

    $(".search_video").each(function(){
        var _this = $(this);
        _this.select2({
            allowClear: true,
            minimumInputLength: 1,
            maximumInputLength:10,
            query: function(query) {
                var result = null;
                $.ajax({
                      url: '/specialarticle/getvideo/',
                      type: 'POST',
                      dataType: 'JSON',
                      data: {
                          condition: query.term
                      }
                })
                .done(function(data) {
                    if(data.status == 1){
                        var result = {
                           results: []
                        };
                        var company = data.data;
                        for(var i in data.data){
                            result.results.push({
                                id:data.data[i].id,
                                text: data.data[i].title,
                                url: data.data[i].url
                            });
                        }
                        query.callback(result);
                    }
                });
            }
        }).on("change",function(e){
            var data = _this.select2("data");
            _this.parents(".subItem").find('.url').val(data.url);
        });

        if (_this.attr("data-val") != "") {
            var data = {text:_this.attr("data-val"),id:_this.attr("data-id")};
            _this.parents(".subItem").find('.url').val(_this.attr("data-url"));
            _this.select2("data",data);
        };
    });
</script>
</block>