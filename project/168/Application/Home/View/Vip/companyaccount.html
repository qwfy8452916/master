<extend name="Main:baseTemplate" />
<block name="title">
    <title>帐号信息管理-控制台</title>
</block>
<block name="style">
    <link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/dataTables/dataTables.bootstrap.min.css?v={:C('STATIC_VERSION')}" />
    <link rel="stylesheet" href="/assets/common/js/plugins/select2-42/select2.min.css?v={:C('STATIC_VERSION')}">
</block>
<block name="content">
    <section class="content-header">
        <h1>帐号信息管理</h1>
    </section>
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">修改用户账号</a></li>
                    <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">清空装修公司信息</a></li>
                    <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">VIP会员撤销</a></li>
                </ul>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="home">
                        <div class="box box-info">
                            <div class="box-content">
                                <div class="box-header with-border">
                                    <h3 class="box-title">修改用户账号</h3>
                                </div>
                                <form id="form_account" class="form-horizontal">
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司ID：
                                            </label>
                                            <div class="col-sm-3">
                                                <select class="form-control companys">
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                所在城市
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled"  class="form-control city" placeholder="所在城市">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                原帐号
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled"  class="form-control account" placeholder="帐号">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                修改帐号
                                            </label>
                                            <div class="col-sm-3">
                                                <input name="account" type="text" class="form-control" placeholder="帐号">
                                            </div>
                                        </div>
                                        <button id="btnAccount" type="button" class="col-sm-offset-1 btn btn-info submit-save">修改</button>
                                        <input type="hidden" name="id"  />
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="profile">
                        <div class="box box-info">
                            <div class="box-content">
                                <div class="box-header with-border">
                                    <h3 class="box-title">清空装修公司信息</h3>
                                </div>
                                <form id="form_company" class="form-horizontal">
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司ID：
                                            </label>
                                            <div class="col-sm-3">
                                                <select class="form-control companys" style="width: 100%">
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                所在城市
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled"  class="form-control city" placeholder="所在城市">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司帐号
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled"  class="form-control account" placeholder="帐号">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司简称
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled" class="form-control jc" placeholder="公司简称">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司全称
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled" class="form-control qc" placeholder="公司全称">
                                            </div>
                                        </div>
                                        <button id="btnReset" type="button" class="col-sm-offset-1 btn btn-danger submit-save">清空</button>
                                        <input type="hidden" name="id"  />
                                        <input type="hidden" name="tab" value="2" />
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="messages">
                        <div class="box box-info">
                            <div class="box-content">
                                <div class="box-header with-border">
                                    <h3 class="box-title">VIP会员撤销</h3>
                                </div>
                                <form id="form_vip" class="form-horizontal">
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司ID：
                                            </label>
                                            <div class="col-sm-3">
                                                <select class="form-control companys" style="width: 100%">
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                所在城市
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled"  class="form-control city" placeholder="所在城市">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司帐号
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled"  class="form-control account" placeholder="帐号">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司简称
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled" class="form-control jc" placeholder="公司简称">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-1 control-label">
                                                公司全称
                                            </label>
                                            <div class="col-sm-3">
                                                <input type="text" disabled="disabled" class="form-control qc" placeholder="公司全称">
                                            </div>
                                        </div>
                                        <button id="btnVipReset" type="button" class="col-sm-offset-1 btn btn-danger submit-save">撤销</button>
                                        <input type="hidden" name="id"  />
                                        <input type="hidden" name="tab" value="3" />
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
</block>
<block name="script">
    <script src="/assets/common/js/plugins/select2-42/select2.min.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript">
        $(".nav-tabs li").removeClass('active').eq("{$Think.get.tab|default=1}"-1).addClass('active');
        $(".nav-tabs li.active").trigger('click');

        $(".companys").select2({
            ajax: {
                url: "/vip/findcomnapnyinfo/",
                dataType: 'json',
                type: "post",
                data: function(params) {
                    return {
                        q: params.term // search term
                    };
                },
                processResults: function(data, params) {
                    return {
                        results: data.items
                    };
                }
            },
            escapeMarkup: function(markup) {
                return markup;
            },
            minimumInputLength: 3,
            templateResult: function(repo) {
                if (repo.loading) return repo.text;
                var markup = "<div class='select2-result-repository clearfix'>" +
                    "<div class='select2-result-repository__meta'>" +
                    "<div class='select2-result-repository__title'>" + repo.id + " " + repo.jc + " (" + repo.cname + ")</div>";
                return markup;
            },
            templateSelection: function(repo) {
                $(".city",$(".tab-pane.active")).val(repo.cname);
                $(".account",$(".tab-pane.active")).val(repo.user);
                $(".jc",$(".tab-pane.active")).val(repo.jc);
                $(".qc",$(".tab-pane.active")).val(repo.qc);
                $("input[name=id]",$(".tab-pane.active")).val(repo.id);
                return repo.jc;
            }
        });

        $("#btnAccount").click(function(event) {
            if (confirm("确定修改该公司登录帐号吗？")) {
                $.ajax({
                    url: '/vip/initcompanyaccount/',
                    type: 'POST',
                    dataType: 'JSON',
                    data:$("#form_account").serializeArray()
                })
                .done(function(data) {
                    alert(data.info);
                    if (data.status == 1) {
                        window.location.href = '/vip/companyaccount?tab='+ 1;
                    }
                });
            }
        });

        $("#btnReset").click(function(event) {
            if (confirm("确定要删除该装修公司的信息吗?")) {
                $.ajax({
                    url: '/vip/resetcompanyinfo',
                    type: 'POST',
                    dataType: 'JSON',
                    data:$("#form_company").serializeArray()
                })
                .done(function(data) {
                    alert(data.info);
                    if (data.status == 1) {
                        window.location.href = '/vip/companyaccount?tab='+2;
                    }
                });

            }
        });

        $("#btnVipReset").click(function(event) {

            if (confirm("确定要将上错的VIP会员撤销吗?")) {
                $.ajax({
                    url: '/vip/vipreset',
                    type: 'POST',
                    dataType: 'JSON',
                    data:$("#form_vip").serializeArray()
                })
                .done(function(data) {
                    alert(data.info);
                    if (data.status == 1) {
                        window.location.href = '/vip/companyaccount?tab='+3;
                    }
                });

            }
        });
    </script>
</block>