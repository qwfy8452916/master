<extend name="Main:baseTemplate" />
<block name="title">
	<title>案例管理 - 控制台</title>
</block>
<block name="style">
	<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/js/plugins/select2/select2.min.css?v={:C('STATIC_VERSION')}">
	<link rel="stylesheet" type="text/css" href="{:C('168NEW_URL')}/assets/common/css/select2_metro.css?v={:C('STATIC_VERSION')}" />
	<link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/datetimepicker/datepicker.css?v={:C('STATIC_VERSION')}" />
	<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/css/global.css?v={:C('STATIC_VERSION')}">
</block>
<block name="content">

	<section class="content-header">
		<h1>分单计划达成</h1>
		<ol class="breadcrumb">
			<li>
				<a href="/"><i class="fa fa-dashboard"></i> 会员统计概览</a>
			</li>
			<li class="active">
				<a href="/homecase">分单计划</a>
			</li>
		</ol>
	</section>

	<section class="content">
        <div class="row">
            <div class="col-xs-12">
            	<div class="box box-default">
					<div class="box-body">
						<div class="row">
							<form class="form-horizontal" method="GET" action="/tongji/order_tel">
								<div class="col-xs-12 no-padding">
									<div class="col-xs-2">
										<div>会员名称：</div>
										<input type="text" name="date" class="form-control"  placeholder="会员名称" value="{$date}">
									</div>
									<div class="col-xs-2">
										<div>选择部门：</div>
										<select name="" class="form-control">
											<option value="">请选择</option>
											<option value="">商务</option>
											<option value="">客服</option>
										</select>
									</div>
									<div class="col-xs-2">
		                                <div>生效月份：</div>
		                                <div class="input-group">
		                                	<input type="text" name="date" class="form-control datepicker" style="border-radius:0 !important;" placeholder="选择月份" value="{$date}">
		                                	<span class="input-group-addon" id="basic-addon1"><i class="fa fa-calendar"></i></span>
		                                </div>
		                            </div>
		                            <div class="col-xs-2">
										<div>选择操作人：</div>
										<select name="" class="form-control">
											<option value="">请选择</option>
											<option value="">某某</option>
											<option value="">某某</option>
										</select>
									</div>
								</div>
                                <div class="col-xs-12 no-padding" style="padding-top: 20px !important;">
	                                <div class="col-xs-4">
	                                	<button type="button" class="btn btn-primary add-new">新增</button>
										<button type="button" class="btn btn-success">下载模板</button>
										<button type="button" class="btn btn-info">导入</button>
	                                </div>
	                                <div class="col-xs-2 pull-right">
	                                	<button type="button" class="btn btn-primary pull-left">查询</button>
										<button type="button" class="btn btn-success pull-right hideLoading">导出</button>
	                                </div>
                                </div>
							</form>
						</div>
					</div>
				</div>
				<style>
					.city-content,.num-content,.time-content,.new-list .company-text,.new-list .city-text,.new-list .num-text,.new-list .order-text{display: none;}
					.new-list .city-content,.new-list .num-content,.new-list .time-content{display: block;}
					thead tr th{background: #3399cc;color: #fff;}
				</style>
				<div class="box box-default">
					<div class="box-body">
						<div class="row">
							<div class="col-sm-12">
								<table id="" class="table table-bordered table-hover dataTable no-footer" role="grid" >
			                        <thead>
			                            <tr role="row">
			                            	<th class="" tabindex="0" >会员名称</th>
			                            	<th class="" tabindex="0" >城市</th>
			                            	<th class="" tabindex="0" >部门</th>
			                            	<th class="" tabindex="0" >倍数 <i class="fa fa-unsorted"></i></th>
			                            	<th class="" tabindex="0" >计划月单数 <i class="fa fa-unsorted"></i></th>
			                            	<th class="" tabindex="0" >生效月份 <i class="fa fa-unsorted"></i></th>
			                            	<th class="" tabindex="0" >操作时间 <i class="fa fa-unsorted"></i></th>
			                            	<th class="" tabindex="0" >操作人</th>
			                            	<th class="" tabindex="0" >操作</th>
			                            </tr>
			                        </thead>
			                        <tbody>
			                            <tr role="row" class="odd">
			                                <td><span>苏州商业公司</span></td>
			                                <td class="sel-city">
			                                	<span class="city-text">北京</span>
				                                <div class="city-content">
					                                <select type="text" class="form-control">
														<option >北京</option>
														<option >上海</option>
														<option >南京</option>
														<option >广东</option>
													</select>
												</div>
											</td>
			                                <td>商务</td>
			                                <td class="sel-num">
			                                	<span class="num-text">2</span>
												<div class="num-content">
													<select type="text" class="form-control">
														<option>1</option>
														<option>2</option>
														<option>3</option>
													</select>
												</div>
			                                </td>
			                                <td><span class="order-text">15</span></td>
			                                <td class="sel-time">
			                                	<span class="time-text">2016-12</span>
												<input type="text" name="date" class="form-control datepicker-in time-content" style="border-radius:0 !important;" placeholder="选择月份" value="{$date}">
			                                </td>
			                                <td class="revise-time">2016-12-12</td>
			                                <td>某某</td>
			                                <td class="revise"><a href="javascript:;">修改</a></td>
			                            </tr>
			                        </tbody>
			                    </table>
		                    </div>
						</div>
					</div>
				</div>
            </div>
        </div>
    </section>
</block>
<block name="script">
	<script src="{:C('168NEW_URL')}/assets/common/js/plugins/select2/select2.js?v={:C('STATIC_VERSION')}"></script>
	<script src="{:C('168NEW_URL')}/assets/common/js/plugins/datetimepicker/bootstrap-datepicker.js?v={:C('STATIC_VERSION')}"></script>
	<script src="{:C('168NEW_URL')}/assets/common/js/select2.min.js?v={:C('STATIC_VERSION')}"></script>
	<script type="text/javascript">
		$(function() {
			$(".datepicker").datetimepicker({
				startView:3,
				minView:'decade',
				format:"yyyy-mm",
				autoclose:true,
				pickerPosition: "bottom-left"
			});
			$('.add-new').on('click', function(){
				var obj = '<tr role="row" class="odd new-list">\
	                            <td>\
	                            	<span class="company-text"></span>\
	                            	<div class="company-content">\
		                            	<select class="form-control">\
		                            		<option>选择</option>\
		                            		<option>苏州1公司</option>\
		                            		<option>苏州2公司</option>\
		                            	</select>\
	                            	</div>\
	                            </td>\
	                            <td class="sel-city">\
	                            	<span class="city-text"></span>\
	                                <div class="city-content">\
		                                <select type="text" class="form-control">\
											<option >选择</option>\
											<option >上海</option>\
											<option >南京</option>\
											<option >广东</option>\
										</select>\
									</div>\
								</td>\
	                            <td>商务</td>\
	                            <td class="sel-num">\
	                            	<span class="num-text"></span>\
									<div class="num-content">\
										<select type="text" class="form-control">\
											<option>选择</option>\
											<option>1</option>\
											<option>2</option>\
											<option>3</option>\
										</select>\
									</div>\
	                            </td>\
	                            <td><span class="order-text"></span><input type="text" name="" class="order-content form-control"></td>\
	                            <td class="sel-time">\
	                            	<span class="time-text"></span>\
									<input type="text" name="date" class="form-control datepicker-in time-content" style="border-radius:0 !important;" placeholder="选择月份" value="{$date}">\
	                            </td>\
	                            <td class="revise-time">0000-00-00</td>\
	                            <td>某某</td>\
	                            <td class="revise"><a class="text-success" href="javascript:;">保存</a></td>\
	                        </tr>'

				$(obj).insertBefore($('.table tbody').find('tr:first'));
				$('.time-content').datetimepicker({
					startView:3,
					minView:'decade',
					format:"yyyy-mm",
					autoclose:true,
					pickerPosition: "bottom-left"
				});
			});
			
			
			$('tbody').on('click', function(event){
				if(event.target.nodeName == 'A'){
					var $a = $(event.target);
					if($a.html() == '保存'){
						// 计划月单数
						var orderVal = $a.parent().parent().find(".order-content").val();
						// 城市选择
						var cityVal = $a.parent().parent().find(".city-content").find("select").val();
						// 公司名称
						var companyVal = $a.parent().parent().find(".company-content").find("select").val();
						// 会员倍数
						var numVal = $a.parent().parent().find(".num-content").find("select").val();
						// 时间选择
						var timeVal = $a.parent().parent().find('.time-content').val();
						
						// 公司名称
						
						if( companyVal != '选择'){
							$a.parent().parent().find(".company-content").siblings().html(companyVal);
						}else{
							$a.parent().parent().find(".company-content").find('select').focus();
							return false;
						}
						// 城市选择
						
						if( cityVal != '选择'){
							$a.parent().parent().find(".city-content").siblings().html(cityVal);
						}else{
							$a.parent().parent().find(".city-content").find('select').focus();
							return false;
						}
						// 倍数选择
						
						if( numVal != '选择'){
							$a.parent().parent().find(".num-content").siblings().html(numVal);
						}else{
							$a.parent().parent().find(".num-content").find('select').focus();
							return false;
						}
						// 计划月单数
						 
						if(orderVal){
							$a.parent().parent().find(".order-content").siblings().html(orderVal);

						}else if($a.parent().parent().find(".order-text").html()){
							
						}else{
							$a.parent().parent().find(".order-content").focus();
							return false;
						}
						// 生效月份
						 
						if(timeVal){
							$a.parent().parent().find(".time-text").html(timeVal); 
						}else{
							$a.parent().parent().find(".time-content").focus();
							return false;
						}
						// 操作时间选择
						var now = new Date(),
						nowYear = now.getFullYear(),
						nowMonth = now.getMonth()+1,
						nowDay = now.getDate();
						$a.parent().parent().find(".revise-time").html(nowYear+'-'+nowMonth+'-'+nowDay);

						$a.parent().parent().find(".city-content").hide().siblings().show();
						$a.parent().parent().find(".num-content").hide().siblings().show();
						$a.parent().parent().find(".time-content").hide().datetimepicker('remove').siblings().show();
						$a.parent().parent().find(".company-content").hide().siblings().show();
						$a.parent().parent().find(".order-content").hide().siblings().show();
						
						$a.html('修改').removeClass('text-success');
					}else{
						$a.parent().parent().find(".city-content").show().siblings().hide();
						$a.parent().parent().find(".num-content").show().siblings().hide();
						$a.parent().parent().find(".time-content").show().datetimepicker({
							startView:3,
							minView:'decade',
							format:"yyyy-mm",
							autoclose:true,
							pickerPosition: "bottom-left"
						}).siblings().hide();
						$a.html('保存').addClass('text-success');
					}
				}
			});
		});
	</script>
</block>