<extend name="Main:baseTemplate"/>
<block name="title">
    <title>渠道发单走势</title>
</block>
<block name="style">
    <link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/datetimepicker/datepicker.css?v={:C('STATIC_VERSION')}"/>
    <link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/css/select2_metro.css?v={:C('STATIC_VERSION')}"/>
</block>
<block name="content">
    <section class="content-header">
        <h1>渠道发单走势</h1>
    </section>
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <div class="box-body">
                        <div class="row">
                            <form class="form-horizontal">
                                <div class="col-xs-12">
                                    <div class="col-xs-1 reset-padding" style="width:11.4%">
                                        <div>开始时间：</div>
                                        <input type="text" name="start"
                                               class="form-control datepicker clear-target" id="start_time"
                                               placeholder="选择日期" AUTOCOMPLETE="off"
                                               value="{$Think.get.start}">
                                    </div>
                                    <div class="col-xs-1" style="width:11.4%">
                                        <div>结束时间：</div>
                                        <input type="text" name="end" class="form-control datepicker clear-target"
                                               id="end_time" AUTOCOMPLETE="off"
                                               placeholder="选择日期" value="{$Think.get.end}">
                                    </div>
                                    <div class="col-xs-1" style="width:11.4%">
                                        <div>部门:</div>
                                        <select name="dept" id="dept" class="form-control">
                                            <optgroup label="全部">
                                                <option value="0">所有部门</option>
                                            </optgroup>
                                            <volist name="department" id="vo">
                                                <optgroup label="{$key}">
                                                    <volist name="vo.child" id="v">
                                                        <option value="{$v.id}" <if condition="$_GET['dept'] eq $v['id']">selected</if>>{$v.name}</option>
                                                    </volist>
                                                </optgroup>
                                            </volist>
                                        </select>
                                    </div>
                                    <div class="col-xs-1" style="width:11.4%">
                                        <div>渠道组:</div>
                                        <select class="group select2" name="group" id="group" type="text">
                                            <volist name="group" id="vo">
                                                <option value="{$vo.id}">{$vo.name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                    <div class="col-xs-1" style="width:11.4%">
                                        <div>渠道:</div>
                                        <select class="src select2" name="src" id="src" type="text">
                                            <option value="">请选择</option>
                                            <volist name="src" id="vo">
                                                <option value="{$vo.src}">{$vo.name}</option>
                                            </volist>
                                        </select>
                                    </div>
                                    <div class="col-xs-2" style="padding-top: 16px;">
                                        <button type="submit" id="search" class="btn btn-primary col-xs-1"
                                                style="width: 80px; float: none">查询
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-body no-padding">
                        <table class="table table-hover table-bordered" id="tablelist">
                            <thead>
                            <tr>
                                <th>时间</th>
                                <th>汇总</th>
                                <th>0:00-1:00</th>
                                <th>1:00-2:00</th>
                                <th>2:00-3:00</th>
                                <th>3:00-4:00</th>
                                <th>4:00-5:00</th>
                                <th>5:00-6:00</th>
                                <th>6:00-7:00</th>
                                <th>7:00-8:00</th>
                                <th>8:00-9:00</th>
                                <th>9:00-10:00</th>
                                <th>10:00-11:00</th>
                                <th>11:00-12:00</th>
                                <th>12:00-13:00</th>
                                <th>13:00-14:00</th>
                                <th>14:00-15:00</th>
                                <th>15:00-16:00</th>
                                <th>16:00-17:00</th>
                                <th>17:00-18:00</th>
                                <th>18:00-18:00</th>
                                <th>19:00-20:00</th>
                                <th>20:00-21:00</th>
                                <th>21:00-22:00</th>
                                <th>22:00-23:00</th>
                                <th>23:00-00:00</th>
                            </tr>
                            </thead>
                            <tbody>
                            <volist name="list" id="vo">
                                <tr>
                                    <td>{$vo.t|default=0}</td>
                                    <td>{$vo.all|default=0}</td>
                                    <td>{$vo.h0|default=0}</td>
                                    <td>{$vo.h1|default=0}</td>
                                    <td>{$vo.h2|default=0}</td>
                                    <td>{$vo.h3|default=0}</td>
                                    <td>{$vo.h4|default=0}</td>
                                    <td>{$vo.h5|default=0}</td>
                                    <td>{$vo.h6|default=0}</td>
                                    <td>{$vo.h7|default=0}</td>
                                    <td>{$vo.h8|default=0}</td>
                                    <td>{$vo.h9|default=0}</td>
                                    <td>{$vo.h10|default=0}</td>
                                    <td>{$vo.h11|default=0}</td>
                                    <td>{$vo.h12|default=0}</td>
                                    <td>{$vo.h13|default=0}</td>
                                    <td>{$vo.h14|default=0}</td>
                                    <td>{$vo.h15|default=0}</td>
                                    <td>{$vo.h16|default=0}</td>
                                    <td>{$vo.h17|default=0}</td>
                                    <td>{$vo.h18|default=0}</td>
                                    <td>{$vo.h19|default=0}</td>
                                    <td>{$vo.h20|default=0}</td>
                                    <td>{$vo.h21|default=0}</td>
                                    <td>{$vo.h22|default=0}</td>
                                    <td>{$vo.h23|default=0}</td>
                                </tr>
                            </volist>
                            </tbody>
                        </table>
                        {$page|default=''}
                    </div>
                </div>
            </div>
        </div>
    </section>

</block>
<block name="script">

    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/datetimepicker/bootstrap-datepicker.js?v={:C('STATIC_VERSION')}"></script>
    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/select2/select2.js?v={:C('STATIC_VERSION')}"></script>
    <script src="{:C('168NEW_URL')}/assets/common/js/select2.min.js?v={:C('STATIC_VERSION')}"></script>
    <script>


        /*S-初始化插件*/
        // 开始时间
        $('#start_time').datepicker({
            todayBtn: false,
            autoclose: true,
            endDate: new Date()
        }).on('changeDate', function (e) {
            var startTime = e.date,
                endTime = new Date(e.date.getTime() + (3 * 31 * 24 * 60 * 60 * 1000));
            // console.log(startTime);
            $('#end_time').datepicker('setStartDate', startTime);
            $('#end_time').datepicker('setEndDate', endTime);
        });
        //结束时间：
        $('#end_time').datepicker({
            todayBtn: false,
            autoclose: true,
            endDate: new Date()
        }).on('changeDate', function (e) {
            var startTime = new Date(e.date.getTime() - (3 * 31 * 24 * 60 * 60 * 1000)),
                endTime = new Date(e.date.getTime() + (24 * 60 * 60 * 1000));
            $('#start_time').datepicker('setStartDate', startTime);
            $('#start_time').datepicker('setEndDate', endTime);
        });
        $('.select2').select2({
            language: "zh-CN"
        })
        $('#dept').select2('val','{$Think.get.dept}')
        $('#group').select2('val','{$Think.get.group}')
        $('#src').select2('val','{$Think.get.src}')
        //获取对应渠道来源
        $("#group").on('click', function () {
            $.ajax({
                url: '/CompanyLiangFang/ajaxSrcList',
                type: 'GET',
                dataType: 'JSON',
                data: {group: $("#group").val()}
            })
                .done(function (data) {
                    if (data.status == 1) {
                        var html = '';
                        $.each(data.info, function (k,v) {
                            html += '<option value="' + v.src + '">' + v.name + '</option>';
                        })
                        $('#src').html(html);
                        /*渠道格式化*/
                        $('#src').select2();
                        $("#src").select2('val', '{$Think.get.src}');
                    }
                });
        });
    </script>
</block>