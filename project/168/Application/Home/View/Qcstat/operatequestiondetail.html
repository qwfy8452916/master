<extend name="Main:baseTemplate" />
<block name="title">
    <title>录音操作问题统计 - 控制台</title>
</block>
<block name="style">
    <link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/js/plugins/datetimepicker/datepicker.css?v={:C('STATIC_VERSION')}" />
    <link href="{:C('168NEW_URL')}/assets/common/phpexcel/phpexcel.css?v={:C('STATIC_VERSION')}" rel="stylesheet">
    <link href="{:C('168NEW_URL')}/assets/common/phpexcel/handsontable.full.min.css?v={:C('STATIC_VERSION')}" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/common/css/select2_metro.css?v={:C('STATIC_VERSION')}" />
</block>
<block name="content">
    <section class="content-header">
        <h1>录音操作问题统计 >
            <switch name="type" >
                <case value="1" >客服详情</case>
                <case value="2">客服团详情</case>
                <case value="3">客服师详情</case>
            </switch>
        </h1>

    </section>
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-default">
                    <div class="box-header with-border">
                        <h3 class="box-title">条件查询</h3>
                    </div>
                    <div class="box-body">
                        <div class="row mgb-10">
                            <div class="col-xs-2">
                            开始时间：<input type="text" name="time_start" class="form-control datepicker" placeholder="开始时间" value="{$Think.get.time_start}">
                            </div>
                            <div class="col-xs-2">
                            结束时间：<input type="text" name="time_end" class="form-control datepicker" placeholder="结束时间" value="{$Think.get.time_end}">
                            </div>


                            <div class="col-xs-1 pull-right">
                                <br/>
                                <button type="button" id="export"  class="btn btn-block btn-info">
                                    <i class="fa fa-download"></i>导出
                                </button>
                            </div>
                            <div class="col-xs-1 pull-right">
                                <br/>
                                <button type="button" id="search" data-triger="#search" class="key-down-event btn btn-block btn-primary">
                                    <i class="fa fa-search"></i>查询
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">查询列表</h3>
                    </div>
                    <div class="box-body">
                        <!--审核团对接团都有-->
                        <form role="form" class="list-form">
                        <switch name="type" >
                            <case value="1" >
                                <table class="table table-hover position-top">
                                    <thead class="thead1">
                                    <tr>
                                        <th>日期</th>
                                        <th>抽查总量</th>
                                        <th>问题合计</th>

                                        <th>问题点占比</th>
                                        <th>沟通错误</th>
                                        <th>沟通问题点占比</th>
                                        <th>记录错误</th>
                                        <th>记录问题点占比</th>


                                        <th>审核客服操作错误</th>
                                        <th>审核操作问题点占比</th>
                                        <th>抽查项目数</th>
                                        <th>抽查项目问题占比</th>
                                        <th>问题订单条数</th>

                                    </tr>
                                    </thead>
                                    <!--头部悬浮用-->
                                    <thead class="thead2 hide">
                                    <tr>
                                        <th>日期</th>
                                        <th>抽查总量</th>
                                        <th>问题合计</th>

                                        <th>问题点占比</th>
                                        <th>沟通错误</th>
                                        <th>沟通问题点占比</th>
                                        <th>记录错误</th>
                                        <th>记录问题点占比</th>

                                        <th>审核客服操作错误</th>
                                        <th>审核操作问题点占比</th>
                                        <th>抽查项目数</th>
                                        <th>抽查项目问题占比</th>
                                        <th>问题订单条数</th>

                                    </tr>
                                    </thead>
                                    <tbody>
                                    <volist name="stat" id="vi">
                                    <tr>
                                            <td>{$vi.month}</td>
                                            <td>{$vi.zj_dd|default=0}</td>
                                            <td>{$vi.zj_cw|default=0}</td>

                                            <td>{:number_format($vi[zj_cw] / $vi['zj_dd'] * 100, 2)}%</td>
                                            <td>{$vi.sh_gt_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_gt_cw] / $vi['zj_cw'] * 100, 2)}%</td>
                                            <td>{$vi.sh_jl_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_jl_cw] / $vi['zj_cw'] * 100, 2)}%</td>

                                            <td>{$vi.sh_cz_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_cz_cw] / $vi['zj_cw'] * 100, 2)}%</td>
                                            <td>{$vi['zj_dd'] * 13}</td>
                                            <td>{:number_format($vi[sh_zj_cw] / ($vi['zj_dd'] * 13) * 100, 2)}%</td>
                                            <td>{$vi.zj_cw_dd|default=0}</td>
                                    </tr>
                                    </volist>
                                    </tbody>
                                    <tfoot>

                                    </tfoot>

                                </table>
                            </case>
                            <case value="2">
                                <table class="table table-hover position-top">
                                    <thead class="thead1">
                                    <tr>
                                        <th>日期</th>
                                        <th>抽查总量</th>
                                        <th>问题合计</th>
                                        <th>问题点占比</th>
                                        <th>沟通错误</th>
                                        <th>沟通问题点占比</th>
                                        <th>记录错误</th>
                                        <th>记录问题点占比</th>
                                        <th>审核客服操作错误</th>
                                        <th>审核操作问题点占比</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <volist name="stat" id="vi">
                                        <tr>
                                            <td>{$vi.month}</td>
                                            <td>{$vi.zj_dd|default=0}</td>
                                            <td>{$vi.sh_zj_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_zj_cw] / $vi['zj_dd'] * 100, 2)}%</td>
                                            <td>{$vi.sh_gt_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_gt_cw] / $vi['sh_zj_cw'] * 100, 2)}%</td>
                                            <td>{$vi.sh_jl_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_jl_cw] / $vi['sh_zj_cw'] * 100, 2)}%</td>
                                            <td>{$vi.sh_cz_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_cz_cw] / $vi['sh_zj_cw'] * 100, 2)}%</td>
                                        </tr>
                                    </volist>
                                    </tbody>
                                </table>
                            </case>
                            <case value="3">
                                <table class="table table-hover position-top">
                                    <thead class="thead1">
                                    <tr>
                                        <th>日期</th>
                                        <th>抽查总量</th>
                                        <th>问题合计</th>
                                        <th>问题点占比</th>
                                        <th>沟通错误</th>
                                        <th>沟通问题点占比</th>
                                        <th>记录错误</th>
                                        <th>记录问题点占比</th>
                                        <th>审核客服操作错误</th>
                                        <th>审核操作问题点占比</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <volist name="stat" id="vi">
                                        <tr>
                                            <td>{$vi.month}</td>
                                            <td>{$vi.zj_dd|default=0}</td>
                                            <td>{$vi.sh_zj_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_zj_cw] / $vi['zj_dd'] * 100, 2)}%</td>
                                            <td>{$vi.sh_gt_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_gt_cw] / $vi['sh_zj_cw'] * 100, 2)}%</td>
                                            <td>{$vi.sh_jl_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_jl_cw] / $vi['sh_zj_cw'] * 100, 2)}%</td>
                                            <td>{$vi.sh_cz_cw|default=0}</td>
                                            <td>{:number_format($vi[sh_cz_cw] / $vi['sh_zj_cw'] * 100, 2)}%</td>
                                        </tr>
                                    </volist>
                                    </tbody>
                                </table>
                            </case>
                        </switch>
                        </form>

                    </div>
                </div>
            </div>

        </div>
    </section>
</block>
<block name="script">
    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/datetimepicker/bootstrap-datepicker.js?v={:C('STATIC_VERSION')}"></script>
    <!-- 引入排序表格开始 -->
    <link href="{:C('168NEW_URL')}/assets/common/js/plugins/dataTables/metisMenu.css?v={:C('STATIC_VERSION')}" rel="stylesheet">
    <link href="{:C('168NEW_URL')}/assets/common/js/plugins/dataTables/dataTables.bootstrap.css?v={:C('STATIC_VERSION')}" rel="stylesheet">
    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/dataTables/metisMenu.min.js?v={:C('STATIC_VERSION')}"></script>
    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/dataTables/jquery.dataTables.min.js?v={:C('STATIC_VERSION')}"></script>
    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/dataTables/dataTables.bootstrap.min.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="/assets/common/js/select2.min.js?v={:C('STATIC_VERSION')}"></script>
    <!-- 引入排序表格结束 -->

    <script src="/assets/common/phpexcel/handsontable.full.min.js?v={:C('STATIC_VERSION')}"></script>
    <script src="/assets/common/phpexcel/phpexcel.js?v={:C('STATIC_VERSION')}"></script>
    <script>
    $(document).ready(function(){
        $('.select2').select2({
            allowClear: true,
            language: "zh-CN"
        });

        //初始化插件
        $('.datepicker').datepicker({
            autoclose: true,
            format: 'yyyy-mm-dd'
        });

       

        //搜索按钮
        $('#search').click(function(event) {
            var type = {$type};
            if(type == 1){
                var kf = '&kf_id='+{$vars['kf_id']};
            }else if(type == 2){
                var kf = '&kf_group='+{$vars['kf_group']};
            }else if(type == 3){
                var kf = '&kf_manager='+{$vars['kf_manager']};
            }
            if($('input[name=time_start]').val() == '' && $('input[name=time_end]').val() != ''){
                alert("未选择开始时间");
                return false;
            }
            if($('input[name=time_end]').val() == '' && $('input[name=time_start]').val() != ''){
                alert("未选择结束时间");
                return false;
            }
            window.location.href = '/qcstat/operatequestiondetail/?time_start=' + $('input[name=time_start]').val() + '&time_end=' + $('input[name=time_end]').val()+ '&type=' + {$type}+kf;
        });

        //导出功能
        $('#export').click(function(event) {
            var colums = [];
            var data =[];
            $(".list-form .thead1 th").each(function(){
                var text = $(this).html().trim();
                text = text.split("/")[0];
                var sub =[];
                sub["text"] = text;
                sub["fontColor"] = $(this).css("color");
                sub["bgColor"] = $(this).css("background-color");
                colums.push(sub);
            });
            data.push(colums);
            $(".list-form tbody tr").each(function(i){
                var tr = $(this);
                var sub = [];
                tr.find("td").each(function(){
                   var text = $(this).text().trim();
                   text = text.split("(")[0];
                   var _td = {
                        text:text,
                        fontColor:$(this).css("color"),
                        bgColor:$(this).css("background-color")
                   }
                   sub.push(_td);
                });
                data.push(sub);
            });
            $(".list-form tfoot tr").each(function(i){
                var tr = $(this);
                var sub = [];
                tr.find("td").each(function(){
                   var text = $(this).text().trim();
                   text = text.split("(")[0];
                   var _td = {
                        text:text,
                        fontColor:$(this).css("color"),
                        bgColor:$(this).css("background-color")
                   }
                   sub.push(_td);
                });
                data.push(sub);
            });
            $(this).exportExcel({
                data:data,
                title:"客服操作问题统计",
                url:"/export/download"
            });
        });
    })
    </script>
</block>
