<extend name="Main:baseTemplate" />
<block name="title">
    <title>齐装网品牌榜编辑后台 - 控制台</title>
</block>
<block name="style">
    <link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/js/plugins/artdialog/ui-dialog.css?v={:C('STATIC_VERSION')}" />
    <link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/js/plugins/validation/css/validationEngine.jquery.css?v={:C('STATIC_VERSION')}">
    <link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/plugins/select2/css/select2.css?v={:C('STATIC_VERSION')}" />
    <link rel="stylesheet" href="{:C('168NEW_URL')}/assets/home/friendlink/css/operate.css?v={:C('STATIC_VERSION')}" />
</block>
<block name="content">
    <section class="content-header">
        <h1>友情链接操作</h1>
        <ol class="breadcrumb">
            <li><a href="/"><i class="fa fa-dashboard"></i> 控制面板</a></li>
            <li><a href="/fdlink/">友情链接</a></li>
        </ol>
    </section>
    <section class="content">
        <div class="box box-default color-palette-box">
            <div class="box-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="nav-tabs-custom">
                            <form id="form" action="javascript:void(0)" method="POST">
                                <div class="tab-content">
                                    <div class="tab-pane active" id="tab_1">
                                        <div class="box-body">
                                            <div class="form-group">
                                                <label>选择城市</label>
                                                <select name="cs" class="form-control select-city">
                                                    <option value="">全部城市</option>
                                                    <volist name="citys" id="vo">
                                                        <eq name="main.info.cs" value="$vo['cid']">
                                                            <option value="{$vo.cid}" selected>{$vo.char_name}</option>
                                                        <else />
                                                            <option value="{$vo.cid}">{$vo.char_name}</option>
                                                        </eq>
                                                    </volist>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>选择类型</label>
                                                <select name="show_class" class="form-control" >
                                                    <if condition="!$main['info'] OR $main['info']['show_class'] EQ 1">
                                                        <option value="1" selected="selected">友情链接</option>
                                                        <option value="2">热门城市</option>
                                                        <option value="3">热门标签</option>
                                                        <option value="4">附近城市</option>
                                                    <elseif condition="$main['info']['show_class'] EQ 2"/>
                                                        <option value="1">友情链接</option>
                                                        <option value="2" selected="selected">热门城市</option>
                                                        <option value="3">热门标签</option>
                                                        <option value="4">附近城市</option>
                                                    <elseif condition="$main['info']['show_class'] EQ 3"/>
                                                        <option value="1">友情链接</option>
                                                        <option value="2">热门城市</option>
                                                        <option value="3" selected="selected">热门标签</option>
                                                        <option value="4">附近城市</option>
                                                    <else />
                                                        <option value="1">友情链接</option>
                                                        <option value="2">热门城市</option>
                                                        <option value="3">热门标签</option>
                                                        <option value="4" selected="selected">附近城市</option>
                                                    </if>
                                                </select>
                                            </div>
                                            <div class="tab">
                                                <div class="form-group">
                                                    <label>链接页面</label>
                                                    <select name="link_page" class="form-control" >
                                                        <option value="">请选择</option>
                                                        <volist name="category" id="vo">
                                                            <if condition="$main['info']['link_page'] EQ $key">
                                                                <option selected="selected" value="{$key}">{$vo}</option>
                                                            <else/>
                                                                <option value="{$key}">{$vo}</option>
                                                            </if>
                                                        </volist>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label>链接名称</label>
                                                    <div class="row">
                                                        <div class="col-xs-6">
                                                        <input type="input" class="form-control" name="link_name" placeholder="链接名称" value="{$main.info.link_name}">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label>链接地址</label>
                                                    <div class="row">
                                                        <div class="col-xs-6">
                                                        <input type="input" class="form-control" name="link_url" placeholder="链接地址" value="{$main.info.link_url}">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab">
                                                <div class="form-group">
                                                    <label>推荐城市</label>
                                                    <div class="row">
                                                        <div class="col-sm-7">
                                                            <select name="show_cs" class="show_cs form-control" multiple="">
                                                                <notempty name="main.info.show_cs">
                                                                    <volist name="citys" id="vo">
                                                                        <if condition="strstr($main['info']['show_cs'],$vo['cid']) NEQ false">
                                                                            <option value="{$vo.cid}" selected="selected">
                                                                                {$vo.char_name}
                                                                            </option>
                                                                        <else/>
                                                                            <option value="{$vo.cid}" >
                                                                                {$vo.char_name}
                                                                            </option>
                                                                        </if>
                                                                    </volist>
                                                                </notempty>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="box-footer">
                                            <button type="button" class="btn btn-success btn-save">
                                                <i class="fa fa-save"></i>&nbsp;保存
                                            </button>
                                            <button type="button" class="btn btn-default" onclick="history.back(-1)">
                                                <i class="fa fa-mail-reply"></i>&nbsp;返回
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</block>
<block name="script">
    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/validation/js/jquery.validationEngine_zh_CN.js?v={:C('STATIC_VERSION')}"></script>
    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/validation/js/jquery.validationEngine.js?v={:C('STATIC_VERSION')}"></script>
    <script src="{:C('168NEW_URL')}/assets/common/js/plugins/artdialog/dialog.min.js?v={:C('STATIC_VERSION')}"></script>
    <script src="{:C('168NEW_URL')}/assets/common/plugins/select2/js/select2.js?v={:C('STATIC_VERSION')}"></script>
    <script src="{:C('168NEW_URL')}/assets/common/plugins/select2/js/zh-CN.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript">
        /*S-初始化*/
        var id = "{$Think.get.id}";
        if (id != '') {
            $('.select-city').prop('disabled', 'disabled');
            $('select[name=show_class]').prop('disabled', 'disabled');
        };
        $(".select-city").select2();
        $("select[name=show_class]").change(function(event) {
            $(".tab").hide();
            if(2 == $(this).val() || 4 == $(this).val()){
                $(".tab").eq(1).show();
            }else{
                $(".tab").eq(0).show();
            }
        });
        $("select[name=show_class]").trigger('change');
        /*E-初始化*/

        $(".show_cs").select2({
            language: "zh-CN",
            tags: false,
            multiple: true, //是否使用多个标签
            escapeMarkup: function (markup) { return markup; },
        });

        $('.btn-save').click(function(){
            var list = $(".show_cs").select2("data");
            var show_cs = '';
            $.each(list,function(n,value) {
                show_cs = show_cs + value.id + ',';
            });
            var data = {
                id:"{$Think.get.id}",
                cs:$('select[name=cs]').val(),
                show_class:$('select[name=show_class]').val(),
                link_page:$('select[name=link_page]').val(),
                link_name:$('input[name=link_name]').val(),
                link_url:$('input[name=link_url]').val(),
                show_cs:show_cs
            };
            $.ajax({
                url: '/fdlink/operate/',
                type: 'POST',
                dataType: 'JSON',
                data: data
            })
            .done(function(data) {
                if(data.status == '1'){
                    var e = dialog({
                        title: '消息',
                        content: '操作成功',
                        okValue: '确 定',
                        quickClose: true,
                        ok: function () {
                            window.location.href = window.location.href;
                        }
                    });
                    e.show();
                }else{
                    var e = dialog({
                        title: '消息',
                        content: data.info,
                        okValue: '确 定',
                        quickClose: true,
                        ok: function () {}
                    });
                    e.show();
                }
            })
            .fail(function(xhr) {
                var e = dialog({
                    title: '消息',
                    content: '操作失败,请联系技术部门！',
                    okValue: '确 定',
                    quickClose: true,
                    ok: function () {}
                });
                e.show();
            })
        })
    </script>
</block>