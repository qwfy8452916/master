<extend name="Main:baseTemplate" />
<block name="style">
<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/home/css/font-awesome.min.css?v={:C('STATIC_VERSION')}">
<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/js/plugins/select2/select2.min.css?v={:C('STATIC_VERSION')}">
<link href="{:C('168NEW_URL')}/assets/common/js/plugins/datetimepicker/datepicker.css?v={:C('STATIC_VERSION')}" rel="stylesheet" />
<script charset="utf-8" src="/assets/home/js/jquery-1.11.0.min.js?v={:C('STATIC_VERSION')}"></script>
<style type="text/css">
    .fl_l   { float: left;font-family: "Libre Baskerville", "Lucida Grande", "Hiragino Sans GB", "Hiragino Sans GB W3", "Microsoft YaHei", "wenquanyi micro hei", sans-serif, "Apple Color Emoji"; }
    .box2   { border: 1px solid #e0e0e0; margin-top: 8px; width:800px; margin-left: 6px; padding-bottom: 20px;}
    .box2 .nav      { height: 34px; background-color:#dddee0 ; margin-bottom: 10px; padding-left: 10px; }
    .box2 .nav a    { font-size: 14px; height: 34px; line-height: 34px; vertical-align: middle; float: left; display: block; padding: 0 10px; margin-right: 10px; }
    .box2 .nav a.on { color: red; font-weight: bold; background:url(/Public/useradmin/image/nav_bg2.png) repeat-x ;}
    textarea, textarea.input-text, textarea.input-focus
    { font-size:12px;height:auto; padding:5px; margin:0; }
    select  { vertical-align:middle;background:none repeat scroll 0 0 #F9F9F9;border-color:#d0d0d0;border-style:solid;border-width:1px;color:#333;padding:2px; height:24px;}

    .moddle2        { width: 780px; overflow: hidden; margin: 0px auto; margin-top: 10px; margin-left: 5px; }
    .form-div       { width:440px; padding-left:40px; margin-top: 20px;}
    #form_btn       { cursor: pointer;}
    .input          { padding:5px 0;position: relative;list-style-type:none;}
    .input input{height: 30px; line-height: 30px; border:1px solid #DDD; padding-left: 5px;}

    .input label    { width:84px; line-height: 28px; display: block; font-size:14px;text-align:right; float: left; vertical-align: middle; margin-right: 6px;font-weight: normal}
    .firstdiv       { width:84px; line-height: 28px; display: block; font-size:14px;text-align:right; float: left; vertical-align: middle; margin-right: 6px;font-weight: normal}
    .radio          { position: absolute; vertical-align: middle; }
    textarea        { width: 300px; height: 60px;}
    .input .select_type{height: 30px; border:1px solid #DDD;}
    .onShow, .onFocus, .onError, .onCorrect, .onLoad, .onTime
    { zoom:1; background:url(/Public/useradmin/image/msg_bg.png) no-repeat; color:#444;padding:2px 10px 2px 23px; margin-left:10px;_margin-left:5px; margin-top: -5px; position:absolute; margin-top: 1px; font-size: 12px; line-height: 150%; }
    .onShow         {background-position:3px -147px;border-color:#40B3FF;color:#959595}
    .onFocus        {background-position:3px -147px;border-color:#40B3FF;}
    .onError        {background-position:3px -47px;border-color:#40B3FF; color:red}
    .onCorrect      {background-position:3px -247px;border-color:#40B3FF; color: #fff; }

    .tablebg{background: #F3F3F3;}
    .table .tableth{text-align: left;}
    .table .tableCell .input{float: left; margin:0 5px; padding:0;}
    .table .tableCell .input input[type=text]{width: 100px;height: 30px; border: 1px solid #c6c6c6;  padding-left: 5px; border-radius: 3px;}
    .table .tableCell .input input[type=radio]{margin-top:8px;}
    .table .tableCell .input select{border: 1px solid #c6c6c6;width: 50px; padding:5px; border-radius: 3px;}
    .table .rowSpan .tableCell{border-top: 0;}
    .table .tableCell .input textarea{width:455px; border:1px solid #c6c6c6; border-radius:3px; padding-left:2px; height:60px; resize:none;}
    .table .tableth .input{padding:0;}
    .table .tableth .span,.table .tableCell .span{font-size: 14px; font-weight: bold; float: left; margin-top:5px;cursor:pointer;}
    .table .tableCell:after{content: ""; clear:both; display: block;}
    .table .tableCell .button{float: left; margin-left: 10px; width: 100px;padding:4px 12px; }
    .table .adv_index{margin-right: 5px;}
    .table .adv_index:first-child{margin-left:5px;}
    .table .tableCell .adv_citys{font-weight: normal;font-size: 12px;margin-right: 5px;}
    .table .tableCell .adv_input{margin:0;}
    .table .tableCell .adv_input .span:hover{color: #ff0000;}
    .table .tableCell .adv_active{background: #428BCA;color: #ffffff;}
    .table .tableCell .adv_current{font-weight: bold; color: #ff0000;}

    .tags{margin: 0;padding: 0; width: 600px; float: left; margin-bottom: 10px;}
    .tags li{float: left;padding:5px; border: 1px solid #DDD; background:#ECF0F1; border-radius: 5px; margin-right: 10px; margin-bottom: 10px; cursor: pointer; color: #666;}
    .tags li i{margin-right: 3px;}
    .tags .active{background: #FF8589; color: #FFF; border: 1px solid #FF8589; }
    .select2-selection--multiple{height: 30px;}
    .select2-search__field{margin-top: 0px !important;}
    .tuiguang{display: none;}
</style>
</block>
<block name="content">
<section class="content-header">
    <h1>新后台发单入口</h1>
    <ol class="breadcrumb">
        <li><a href="/"><i class="fa fa-dashboard"></i> 控制面板</a></li>
        <li><a href="/order/adpostorder/">新后台发单入口</a></li>
    </ol>
</section>
<section class="content">
    <form id="form1" action="" method="POST">
        <ul>
            <li class="input"><label><span style="color:red;">*</span>订单来源：</label>
                <select name="orderfrom" id="categoryid" class="select_type orderfrom">
                    <option value="">-请选择分类-</option>
                    <option value="1" >53客服</option>
                    <option value="2" >400电话</option>
                    <option value="3" >QQ咨询</option>
                    <option value="0" >推广部</option>
                </select>
            </li>
            <li class="input kefu"><label><span style="color:red;">*</span>渠道来源：</label>
                <select name="ordersource" id="source" class="select_type ordersourcekefu">
                    <option value="">-请选择分类-</option>
                    <option value="1" >客服发单</option>
                </select>
            </li>
            <li class="input tuiguang"><label><span style="color:red;">*</span>渠道来源：</label>
                <select name="ordersource" id="source" class="select_type ordersourcetuiguang">
                    <option value="">-请选择分类-</option>
                    <option value="2" >视频接待1</option>
                    <option value="3" >视频接待2</option>
                </select>
            </li>
            <li class="input">
                <div style="display: inline-block;">
                    <div class="firstdiv"><span style="color:red;">*</span>联系电话：</div>
                    <input name="mobile" class="mobilemain" id="mobile" type="text"  value="" style="width:150px;" class="select_type">
                    <span id="checkPhone" style="font-size: 18px"></span>
                </div>
                <div style="display: inline-block;">
                    <div class="firstdiv">备用电话：</div>
                    <input name="secoundmobile" id="secoundmobile" type="text"  value="" style="width:150px;" class="select_type">
                </div>
            </li>
            <li class="input">
                <div style="display: inline-block;">
                    <div class="firstdiv"><span style="color:red;">*</span>联系人：</div>
                    <input name="name" id="name" type="text"  value="" style="width:150px;" class="select_type name">
                </div>
                <select name="ordersex" id="sex" class="select_type sex">
                    <option value="">性别</option>
                    <option value="女士" >女士</option>
                    <option value="先生" >先生</option>
                </select>
            </li>
            <li class="input">
                <label><span style="color:red;">*</span>选择城市：</label>
                <select name="cs" class="select_type cs" id="cs" style="width:150px;"></select>
                <select name="qy" class="select_type qy" id="qy" style="width:150px;"></select>
                <script type="text/javascript" src="/assets/home/js/default.js?v={:C('STATIC_VERSION')}"></script>
                <script type="text/javascript">
                    mobile.citys.init({$city});
                </script>
                <div style="display: inline-block;">
                    <div class="firstdiv">小区名称：</div>
                    <input name="xiaoqu" id="xiaoqu" type="text"  value="" style="width:150px;" class="select_type">
                </div>
            </li>
            <li class="input">
                <label>装修类型：</label>
                <select name="lx" class="select_type lx" style="width:150px;">
                    <option value="1">家装</option>
                    <option value="2">公装</option>
                    <option value="" selected="selected">未选择</option>
                </select>
                <select name="lxs" class="select_type lxs" style="width:150px;">
                   <option value="1">新房装修</option>
                   <option value="2">旧房装修</option>
                   <option value="" selected="selected">未选择</option>
                </select>
                <div style="display: inline-block;">
                    <div class="firstdiv">用途：</div>
                    <input name="yt" id="yt" type="text"  value="" style="width:150px;" class="select_type">
                </div>
            </li>
            <li class="input">
                <label>户型：</label>
                <select name="huxing" class="select_type huxing" style="width:150px;">
                    <volist name="info.hx" id="hx">
                        <option value="{$hx.id}">{$hx.name}</option>
                    </volist>
                    <option value="" selected="selected">未选择</option>
                </select>
                <select name="shi" class="shi">
                    <option value="">-</option>
                    <php> for ($i = 1; $i < 11; $i++) { </php>
                        <option value="{$i}">{$i}</option>
                    <php> } </php>
                </select>室
                <div style="display: inline-block;">
                    <div class="firstdiv">面积：</div>
                    <input name="mianji" id="mianji" type="text"  value="" style="width:150px;" class="select_type">
                </div>
            </li>
            <li class="input">
                <label>喜欢风格：</label>
                <select name="fengge" class="fengge">
                    <option value="" selected="selected">-请选择风格-</option>
                    <volist name="info.fg" id="fg">
                        <option value="{$fg.id}">{$fg.name}</option>
                    </volist>
                </select>
                预算：
                <select name="fangshi" class="fangshi">
                    <option value="" selected="selected">未选择</option>
                    <volist name="info.fs" id="fs">
                        <option value="{$fs.id}">{$fs.name}</option>
                    </volist>

                </select>
                <select name="yusuan" class="yusuan">
                    <option value="" selected="selected">未选择</option>
                    <volist name="info.jg" id="ys">
                        <option value="{$ys.id}">{$ys.name}</option>
                    </volist>
                </select>
            </li>
            <li class="input">
                <div style="display: inline-block;">
                    <label>拿房时间：</label>
                    <input type="text" class="select_type nfsj datepicker" name="nfsj" value="" placeholder="选择日期">
                </div>
                <div style="display: inline-block;">
                    <label>钥匙：</label>
                    <select name="keys" class="select_type keys" style="width:150px;">
                        <option value="2" selected="selected" style="background:white;">未选择</option>
                        <option value="1" style="background:#1AFD9C;">有</option>
                        <option value="0" style="background:#FF7575;">无</option>
                        <option value="3" style="background:white;">其它</option>
                    </select>
                </div>
            </li>
            <li class="input">
                <div style="display: inline-block;">
                    <label>开工时间：</label>
                    <input type="text" class="select_type kgsj" name="kgsj" value="">
                </div>
                <div style="display: inline-block;">
                    <label>量房时间：</label>
                    <input type="text" class="select_type lfsj" name="lfsj" value="">
                </div>
            </li>
            <li class="input">
                <label>装修需求：</label>
                <textarea name="content" id="content" placeholder="补充描述"  style="height:100px;width:450px;" class="form-control" class="input-text" ></textarea><br>
                <span id="contentCount" style="padding-left:90px;margin-top:10px;">还可以输入 <em>150</em>  字</span>
            </li>
            <li class="input">
                <div style="display: inline-block;">
                    <label>提交人：</label>
                    <input type="text" class="select_type" name="tjname" value="{$user['name']}" disabled="disabled">
                    <input type="hidden" name="tjid" value="{$user['id']}">
                </div>
            </li>
            <li class="input" style=" margin-left: 95px;"><a id="submit" href="javascript:;" class="btn btn-success button"><i class=" icon-plus-sign "></i> 确定</a></li>
        </ul>
    </form>
</section>
</block>
<block name="script">
<script src="{:C('168NEW_URL')}/assets/common/js/plugins/select2/select2.min.js?v={:C('STATIC_VERSION')}"></script>
<script src="{:C('168NEW_URL')}/assets/common/js/plugins/datetimepicker/bootstrap-datepicker.js?v={:C('STATIC_VERSION')}"></script>
<script type="text/javascript">
$(document).ready(function(){
    $('.datepicker').datepicker({
        autoclose: true,
        format: 'yyyy-mm-dd'
    });

})


//检测手机号是否存在d
function checkOrderPhone(mobile){
    $.ajax({
        url: '/order/checkOrderPhone',
        type: 'POST',
        dataType: 'JSON',
        data: {
            phone:mobile
        },
    })
    .done(function(data) {
        if(data.status == 1){
            alert('此号码半个月之内存在发单记录');
            $('#checkPhone').html('<i class="icon icon-remove-sign"></i>').css('color','red');
        }
        if(data.status == 0){
            $('#checkPhone').html('<i class="icon icon-ok-sign"></i>').css('color','green');
        }
        if(data.status == 2){
            alert('检测手机号数据错误！')
        }
    })
    .fail(function(xhr) {
        alert('检测手机号操作失败！');
    });
}


$(function() {

    //检测手机号是否存在
    $("#mobile").blur(function(){
        var mobile = $(this).val();
        if(mobile != ''){
            checkOrderPhone(mobile);
        }
    });

    $("#categoryid").change(function(){
        var laiyuan = $(".orderfrom").val();//订单来源
        if(parseInt(laiyuan) == 0){
            $(".tuiguang").css('display','block');
            $(".kefu").css('display','none');
            $(".ordersourcekefu").removeClass("ordersource");
            $(".ordersourcetuiguang").addClass("ordersource");

        }else{
            $(".tuiguang").css('display','none');
            $(".kefu").css('display','block');
            $(".ordersourcetuiguang").removeClass("ordersource");
            $(".ordersourcekefu").addClass("ordersource");
         }

    });

    $("#submit").click(function(event){

        var mobile = $("#mobile").val();//电话
        if(mobile == ''){
            alert("请填写业主电话！");
            return false;
        }
        //ajax提交数据
        //先数据监测
        var orderfrom = $(".orderfrom").val();//订单来源
        if(orderfrom == ''){
            alert("请选择来源！");
            return false;
        }
        var name = $("#name").val();//联系人
        if(name == ''){
            alert("请填写业主称呼！");
            return false;
        }
        var ordersource = $(".ordersource").val();//渠道
        if(ordersource == ''){
            alert("请选择渠道！");
            return false;
        }
        var cs              = $('#cs option:selected').val();//城市
        var qy              = $('#qy option:selected').val();//区域
        if(cs == '000001' || qy == '' || qy == '选区域'){
            alert("请选择业主区域！");
            return false;
        }
        
        

        var fangshi = $(".fangshi").val();//方式
        var yusuan = $(".yusuan").val();//预算
        //备用电话、小区、面积、装修类型、类型详细、户型、室、厅、卫、喜欢风格、拿房时间、钥匙、开工时间、量房时间、装修需求、提交人ID、性别
        var secoundmobile   = $("#secoundmobile").val();
        var xiaoqu          = $("#xiaoqu").val();
        var mianji          = $("#mianji").val();
        var lx              = $(".lx").val();
        var lxs             = $(".lxs").val();
        var yt              = $("input[name=yt]").val();
        var huxing          = $(".huxing").val();
        var shi             = $(".shi").val();
        var ting            = $(".ting").val();
        var wei             = $(".wei").val();
        var fengge          = $(".fengge").val();
        var nfsj            = $(".nfsj").val();
        var keys            = $(".keys").val();
        var kgsj            = $(".kgsj").val();
        var lfsj            = $(".lfsj").val();
        var content         = $("#content").val();
        var tjid            = $("input[name=tjid]").val();
        var sex             = $(".sex").val();

        

        $.ajax({
            url: '/order/ajaxAdminIn',
            type: 'POST',
            dataType: 'JSON',
            data: {
                from        : orderfrom ,
                source      : ordersource,
                cs          : cs ,
                qx          : qy ,
                name        : name ,
                sex         : sex ,
                tel         : mobile ,
                other_contact   : secoundmobile ,
                xiaoqu      : xiaoqu ,
                mianji      : mianji ,
                lx          : lx ,
                lxs         : lxs ,
                yt          : yt ,
                huxing      : huxing ,
                shi         : shi ,
                ting        : ting ,
                wei         : wei ,
                fengge      : fengge ,
                fangshi     : fangshi ,
                yusuan      : yusuan ,
                nfsj        : nfsj ,
                keys        : keys ,
                kaigong     : kgsj ,
                liangfang   : lfsj ,
                xuqiu       : content ,
                adminuser   : tjid 
            },
            success:function(data){
                if(data.status == 1){
                    alert("发布成功！");
                    //window.location.href='http://168.qizuang.com/wwgadmin/order?chkid=4&order_id='+data.data;
                }else{
                    alert("发布失败");
                }
            },
            error:function(xhr){
                alert("网络不稳定，请重试！");
            }
        });

    });

    $("#content").bind("input propertychange",function(){
        var length = $(this).val().length;
        if(length > 150){
            var offset = length - 150;
            $("#contentCount").html('<i class="red">您已经超出了 '+offset+" 字</i>");
        }else{
            $("#contentCount em").html(150 - length);
        }
    });

});
</script>
</block>