<extend name="Main:baseTemplate" />
<block name="title">
	<title>会员发展统计 - 控制台</title>
</block>
<block name="style">
	<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/js/plugins/select2/select2.min.css?v={:C('STATIC_VERSION')}">
	<link rel="stylesheet" type="text/css" href="{:C('168NEW_URL')}/assets/common/css/select2_metro.css?v={:C('STATIC_VERSION')}" />
	<link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/datetimepicker/datepicker.css?v={:C('STATIC_VERSION')}" />
	<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/css/global.css?v={:C('STATIC_VERSION')}">
	<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/js/plugins/newTree/css/style.css?v={:C('STATIC_VERSION')}">
	<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/home/css/specialarticle.css?v={:C('STATIC_VERSION')}">
	<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/home/css/sale.css?v={:C('STATIC_VERSION')}">
</block>

<block name="content">
	<section class="content-header">
		<span class="h3">会员发展统计</span>
	</section>
	<section class="content">
        <div class="row">
            <div class="col-xs-12">
            	<div class="box box-default">
					<div class="box-body">
						<div class="h4">筛选条件</div>
						<div class="row">
							<form class="form-horizontal" method="GET" action="/tongji/order_tel">
								<div class="col-xs-12">
									<div class="col-xs-2">
										<div>城市</div>
										<select id="search" name="cs" type="text" placeholder="所属城市" class="select2-offscreen" tabindex="-1">
											<option value="0">全部城市</option>
											<volist name="citys" id="v">
												<option value="{$v.cid}">{$v.cname}</option>
											</volist>
										</select>
									</div>
									<div class="col-xs-2">
										<div>部门</div>
										<select id="search1" name="cs1" type="text" placeholder="所属城市" class="select2-offscreen" tabindex="-1">
											<option value="0">全部部门</option>
											<option value="1">商务</option>
											<option value="2">客服</option>
										</select>
									</div>
									<div class="col-xs-2">
		                                <div>选择日期:</div>
		                                <input type="text" name="date" class="form-control datepicker"  placeholder="选择日期" value="{$date}">
		                            </div>
	                                <div class="col-xs-2 reset-padding">
	                                	<div>实际会员</div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="0" value="">
	                                    </div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="30" value="">
	                                    </div>
	                                </div>
	                                <div class="col-xs-2 reset-padding">
	                                	<div>多倍会员</div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="0" value="">
	                                    </div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="30" value="">
	                                    </div>
	                                </div>
								</div>
                                <div class="col-xs-12 set-mt16">
                                	<div class="col-xs-2 reset-padding">
	                                	<div>会员完成率</div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="0" value="">
	                                    	<i class="percent-sign">%</i>
	                                    </div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="30" value="">
	                                    	<i class="percent-sign">%</i>
	                                    </div>
	                                </div>
	                                <div class="col-xs-2 reset-padding">
	                                	<div>到期会员</div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="0" value="">
	                                    </div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="30" value="">
	                                    </div>
	                                </div>
	                                <div class="col-xs-2 reset-padding">
	                                	<div>续费会员</div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="0" value="">
	                                    </div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="30" value="">
	                                    </div>
	                                </div>
	                                <div class="col-xs-2 reset-padding">
	                                	<div>暂停会员</div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="0" value="">
	                                    </div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="30" value="">
	                                    </div>
	                                </div>
	                                <div class="col-xs-2 reset-padding">
	                                	<div>退费会员</div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="0" value="">
	                                    </div>
	                                    <div class="col-xs-4">
	                                    	<input type="text" name="date" class="form-control" placeholder="30" value="">
	                                    </div>
	                                </div>
	                                <div class="col-xs-4 set-mt16 pull-right">
	                                	<button type="button" class="btn btn-primary">开始查看</button>
										<button type="button" class="btn btn-info">恢复默认格式</button>
	                                </div>
                                </div>
							</form>
						</div>
					</div>
				</div>
				<div class="box box-default">
					<div class="box-body">
						<div class="row">
							<div class="set-rel">
								<div class="col-xs-2">
									<div class="col-xs-8">
										<span>每页显示</span>
										<select>
											<option>100</option>
										</select>
										<span>条</span>
									</div>
								</div>
								<div class="col-xs-2">
									<div class="col-xs-8" data-toggle="modal" data-target="#check-list">
										<i class="fa fa-fw fa-outdent"></i>
										<span>选择查看的列</span>
									</div>
								</div>
								<div class="col-xs-2">
									<div class="col-xs-8">
										<i class="fa fa-fw fa-file-excel-o"></i>
										<span>导出报表</span>
									</div>
								</div>
								<div class="pull-right sale-marginleft-10 sale-marginright-20">
									<a href="#">
										<i class="fa fa-fw fa-credit-card"></i>
										<span>查看多倍会员</span>
									</a>
								</div>
								<div class="pull-right">
									<a href="#">
										<i class="fa fa-fw fa-bar-chart"></i>
										<span>对比分析</span>
									</a>
								</div>
							</div>
							<div class="col-sm-12 set-mt16">
								<div class="oflow">
									<table id="myTable" class="table table-bordered table-hover dataTable no-footer" role="grid" aria-describedby="myTable_info">
				                        <thead>
				                            <tr role="row">
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">城市<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">地级市<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">系数<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">部门<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">师长<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">区域经理<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable" >会员指标<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">实际会员<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">会员总数<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">会员完成率<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">多倍会员<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable" >到期会员<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">暂停会员<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable" >续费会员<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            	<th class="sorting nowrap sale-gray" tableindex="0" aria-controls="myTable">退费会员<i class="fa fa-sort-amount-desc sale-marginleft-10 sort"></i></th>
				                            </tr>
				                        </thead>
				                        <tbody>
				                            <tr role="row" class="odd">
				                                <td class="sorting_1">苏州</td>
				                                <td>昆山</td>
				                                <td>昆山</td>
				                                <td>商务</td>
				                                <td>50</td>
				                                <td>100</td>
				                                <td>18</td>
				                                <td>30%</td>
				                                <td>30</td>
				                                <td>40%</td>
				                                <td>40</td>
				                                <td>30%</td>
				                                <td>90</td>
				                                <td>20%</td>
				                                <td>30</td>
				                            </tr>
				                        </tbody>
				                    </table>
								</div>
		                    </div>
	                    	<div class="col-xs-4">总记录：<span>1500</span>条</div>
	                    	<div class="col-xs-4">
	                    		<div class="page">
		                    		<ul class="pagination">
		                    			<li><a href="javascript:void(0)" class="current">1</a></li>
		                    			<li><a class="num" href="">2</a></li>
		                    			<li><a class="next" href="">下一页</a></li>
		                    		</ul>
	                    		</div>
	                    	</div>
						</div>
					</div>
				</div>
				<!-- 查看列的模态框 -->
				<div class="modal fade" id="check-list" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							    <h4 class="modal-title" id="myModalLabel">选择要查看的列数</h4>
							</div>
							<div class="modal-body judge-input" style="height: auto;overflow: hidden;">
								<div class="check-label"><label class="select-all text-danger"><input type="checkbox" name=""><span>全选</span></label></div>
								<div class="select-list">
									<div class="check-label"><label><input type="checkbox" name=""><span>城市</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>地级市</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>系数</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>部门</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>师长</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>区域经理</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>会员指标</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>实际会员</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>会员总数</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>会员完成率</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>多倍会员</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>到期会员</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>暂停会员</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>续费会员</span></label></div>
									<div class="check-label"><label><input type="checkbox" name=""><span>退费会员</span></label></div>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default pull-left" data-dismiss="modal">关闭</button>
							    <button type="button" class="btn btn-primary btn-ok" data-dismiss="modal">确定</button>
							</div>
						</div>
					</div>
				</div>
				<div class="box box-default">
					<div class="box-body" style="background: #eee;">
						<div class="row">
							<div class="col-xs-12">
								<div class="col-xs-2">帮助说明:</div>
								<div class="row">
									<div class="col-xs-12 set-mt16">
										<table id="explain" class="table table-bordered dataTable no-footer" role="grid" aria-describedby="myTable_info">
					                        <thead>
					                            <tr role="row"></tr>
					                            <tr role="row" class="white">
					                            	<th class="col-xs-2">列表名(依次为)</th>
					                            	<th class="sorting_asc">说明</th>
					                            	<th class="sorting">备注</th>
					                            </tr>
					                        </thead>
					                        <tbody>
					                            <tr role="row" class="odd white">
					                                <td class="col-xs-2" class="sorting_1">系数</td>
					                                <td>数据来源：后台城市重点系数设置。</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="even white">
					                                <td class="col-xs-2" class="sorting_1">师长</td>
					                                <td>数据来源：后台城市职能部门设置。</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="odd white">
					                                <td class="col-xs-2" class="sorting_1">区域经理</td>
					                                <td>数据来源：后台城市职能部门设置。</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="even white">
					                                <td class="col-xs-2" class="sorting_1">会员指标</td>
					                                <td>数据来源：后台会员指标设置。</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="odd white">
					                                <td class="col-xs-2" class="sorting_1">实际会员</td>
					                                <td>后台统计到的实际会员总个数。</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="even white">
					                                <td class="col-xs-2" class="sorting_1">会员总数</td>
					                                <td>公式：会员总数=实际会员数+当日多倍会员超出数。</td>
					                                <td class="col-xs-4">多倍会员超出数：多倍会员超出数量的合计数，比如某城市1个2倍会员，2个3倍会员；数值=（1*2）+（2*3）-已经计算过的3个1倍会员=5；</td>
					                            </tr>
					                            <tr role="row" class="odd white">
					                                <td class="col-xs-2" class="sorting_1">会员完成率</td>
					                                <td>公式：会员完成率=会员总数/会员指标*100%</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="even white">
					                                <td class="col-xs-2" class="sorting_1">多倍会员</td>
					                                <td>计算规则：计算多倍会员的个数，一个多倍会员算一个。</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="odd white">
					                                <td class="col-xs-2" class="sorting_1">到期会员</td>
					                                <td>本次会员结束时间在当月的会员总个数。</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="even white">
					                                <td class="col-xs-2" class="sorting_1">暂停会员</td>
					                                <td>后台统计到的当月暂停会员</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                            <tr role="row" class="odd white">
					                                <td class="col-xs-2" class="sorting_1">续费会员</td>
					                                <td>*商务部的续费会员定义为：本月发生续费行为的会员。*外销部的续费会员定义为：到期日最少在本月第一天往前倒退45天内，在本月进行续费的会员。9月份统计的续费会员是指，到期日是9月1号往前倒退45+1天，即7月16号以后到期在9月进行续费的会员。</td>
					                                <td class="col-xs-4">新会员不纳入续费会员统计</td>
					                            </tr>
					                            <tr role="row" class="even white">
					                                <td class="col-xs-2" class="sorting_1">退费会员</td>
					                                <td>数据来源：原来后台</td>
					                                <td class="col-xs-4">...</td>
					                            </tr>
					                        </tbody>
				                    	</table>
									</div>
								</div>
							</div>
		                </div>
					</div>
					</div>
				</div>
            </div>
        </div>
    </section>
</block>
<block name="script">
	<script src="{:C('168NEW_URL')}/assets/common/js/plugins/select2/select2.js?v={:C('STATIC_VERSION')}"></script>
	<script src="{:C('168NEW_URL')}/assets/common/js/plugins/datetimepicker/bootstrap-datepicker.js?v={:C('STATIC_VERSION')}"></script>
	<script src="{:C('168NEW_URL')}/assets/common/js/select2.min.js?v={:C('STATIC_VERSION')}"></script>
	<script src="{:C('168NEW_URL')}/assets/home/js/sale.js?v={:C('STATIC_VERSION')}"></script>
	<script type="text/javascript">
		$(function() {
			$("#search").select2({
		        allowClear: true,
		        placeholder: "选择城市"
		    });
		    $("#search1").select2({
		        allowClear: true,
		        placeholder: "选择部门"
		    });
		    $("#search").select2("val","{$cs}");
		    $("#search1").select2("val","{$cs1}");
		    $(".datepicker").datepicker({
		          autoclose: true,
				  format: "yyyy-mm",
				  minViewMode: 1
		    });
		    // 城市选择了就不能修改其他的关联值
		    $('#s2id_autogen1').on('focus',function(){
		    	if($("#s2id_search").find("span").text()!="全部城市"){
		    		$('.reset-padding').find('input').attr('disabled',true);
		    	}else{
		    		$('.reset-padding').find('input').attr('disabled',false);
		    	}
		    });
		    // 全选
			$('.select-all').find('input').on('click',function(){
				if($(this).is(':checked')){
					$('.select-list').find('input').each(function(index, el) {
						$(el).attr('gou','yes');
						$(el).prop('checked', true);
					});
				}else{
					$('.select-list').find('input').each(function(index, el) {
						$(el).attr('gou','no');
						$(el).prop('checked', false);
					});
				}
			});
			// 单个选择// 全选联动
            $('.select-list input').each(function(){
                $(this).on('click',function(){
                    if(!$(this).is(':checked')){
                        $(this).attr('gou','no');
                    }else{
                        $(this).attr('gou','yes'); 
                    }
                    if($('.select-list input').length == $('input[gou="yes"]').length){
                        $('.select-all input').prop('checked',true);
                    }else{
                        $('.select-all input').prop('checked',false);
                    }
                });
            });
            // 列表选择
			$('.btn-ok').on('click',function(){
				var arr=[];
				if($('.select-list input[gou="yes"]').length<=0){
					$('#myTable thead tr th').show();
					$('#myTable tbody tr td').show();
				}else{
					$('#myTable thead tr th').hide();
					$('#myTable tbody tr td').hide();
					$('.select-list input:checked').each(function(index, el){
						arr.push($('.select-list input:checked').parents().parents().eq(index).index());
					});
					for(var i=0;i<arr.length;i++){
						$('#myTable thead tr th').eq(arr[i]).show();
					}
					$('#myTable tbody tr').each(function(index, el){
						for(var i=0;i<arr.length;i++){
							$(el).children().eq(arr[i]).show();
						}	
					});
				}
			});
		});
	</script>
</block>