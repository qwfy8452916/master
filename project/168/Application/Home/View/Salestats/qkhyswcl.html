<extend name="Main:baseTemplate" />
<block name="title">
	<title>全瞰-会员数完成率 - 控制台</title>
</block>
<block name="style">
	<link rel="stylesheet" href="{:C('168NEW_URL')}/assets/common/js/plugins/select2/select2.min.css?v={:C('STATIC_VERSION')}">
	<link rel="stylesheet" type="text/css" href="{:C('168NEW_URL')}/assets/common/css/select2_metro.css?v={:C('STATIC_VERSION')}" />
	<link rel="stylesheet" type="text/css" href="/assets/common/js/plugins/datetimepicker/datepicker.css?v={:C('STATIC_VERSION')}" />
	<link rel="stylesheet" type="text/css" href="/assets/home/css/xs-gangwei.css?v={:C('STATIC_VERSION')}">
</block>
<block name="content">
    <style>table#reset-table thead tr th{line-height: 45px;}</style>
	<div class="content">
		<div class="row">
			<div class="col-xs-12">
				<div class="box">
					<div class="overflow-x">
						<div class="overflow-box" style="width: 1190px;">
							<div class="box-header">
								<h3><i class="xs-icon huiyuanwanchenglv-icon"></i> 全瞰-会员数完成率</h3>
								<form id="searchform" action="" method="get" class="form-horizontal">
									<div class="from-list">
										<div class="from-item">
											<span style="width: auto">部门：</span>
											<select name="dept">
												<switch name="department">
						                            <case value="0">
						                                <option value="0">营销中心</option>
						                                <option value="1">商务</option>
						                                <option value="2">外销</option>
						                            </case>
						                            <case value="1">
						                                <option value="1">商务</option>
						                            </case>
						                            <case value="2">
						                                <option value="2">外销</option>
						                            </case>
						                        </switch>
											</select>
										</div>
										<div class="from-item" >
											<span class="timer-tit">财年：</span>
											<input type="text" name="date" class="form-control datepicker timer-input" placeholder="选择财年" value="{$info.time}">
											<i class="fa fa-calendar timer-icon"></i>
										</div>
										<button class="search-btn xs-btn" type="submit">查询</button>
									</div>
								</form>
							</div>
							<div class="box-body">
								<div class="todo-item">
									<div class="pull-right position-relative">
										<i class="xs-icon zhushi-icon"></i>
										<div class="zhushi-info">
											<p>输入人注意事项：本页数据以部门及月份为唯一标识，其他数据均为部门及月份附属信息</p>
											<p>默认显示数据为：部门=“营销中心”的记录（每年的2月到次年1月）</p>
											<p>名词解释：（当月的数据：当日凌晨0:10，之前月数据：统计当次月1日凌晨0：10）；</p>
											<p>所有百分比类型的是指全部为：XX.X%，即取值小数点后1位，比如：90.17%取值90.2%，90.14%取值90.1%四舍五入，90%取值90.0%。</p>
											<p>以下“营销中心”数值为：（除会员数完成率外）外销部和商务部的总计</p>
											<p>1、总城市数：统计月份内已开站的所有的城市累计值</p>
											<p>2、地级市数：统计月份内《岗位城市权限》中地级市的总累计值</p>
											<p>3、会员指标：统计月份内《城市会员指标》中会员指标的总累计值</p>
											<p>4、实际总会员数：<span style="color: #ff5659">统计次月1日凌晨0：10</span >的单倍会员数+（多倍会员数*多倍）的总和</p>
											<p>5、会员数完成率：实际总会员数/会员指标*100%</p>
											<p>6、地级市会员数完成率：地级市实际总会员数/地级市会员指标*100%</p>
											<p>7、单倍会员数：<span style="color: #ff5659">统计次月1日凌晨0：10</span> 的单倍会员数</p>
											<p>8、多倍会员数：<span style="color: #ff5659">统计次月1日凌晨0：10</span> 的多倍会员数，2倍会员为2个，以此类推。分段多倍的按照分段期计算多倍，比如：合作6个月，其中前2个月为多倍的，则多倍只计算前2个月。比如：本次合作时间3月10日-9月9日共6个月，其中3月10-5月9日为2倍会员，则3月10-5月9日时间段为2个会员数，其他时间为1个会员数。</p>
											<p>9、当月数据显示：以当日凌晨0:10的数值显示，比如4月16日当天数据显示为4月16日凌晨0：10的数值，分析折线图不显示4月数值。</p>
											<p>10、所有统计数值，取次月1日凌晨0：10的数值定格保存。</p>
										</div>
									</div>
								</div>

								<table id="reset-table" class="table table-bordered table-hover dataTable no-footer" role="grid" >
					                <thead class="thead1" style="width: 1190px;">
					                    <tr role="row">
					                    	<th title="财年">财年</th>
					                    	<th title="总城市数">总城市数</th>
					                    	<th title="地级市数">地级市数</th>
					                    	<th title="会员指标">会员指标</th>
					                    	<th title="实际总会员数">实际总会员数</th>
					                    	<th title="会员数完成率">会员数完成率</th>
					                    	<th title="地级市会员完成率">地级市会员完成率</th>
					                    	<th title="单倍会员数">单倍会员数</th>
					                    	<th title="多倍会员数">多倍会员数</th>
					                    </tr>
					                </thead>
					                <thead class="thead2" style="width: 1190px;">
					                    <tr role="row">
					                    	<th title="财年">财年</th>
					                    	<th title="总城市数">总城市数</th>
					                    	<th title="地级市数">地级市数</th>
					                    	<th title="会员指标">会员指标</th>
					                    	<th title="实际总会员数">实际总会员数</th>
					                    	<th title="会员数完成率">会员数完成率</th>
					                    	<th title="地级市会员完成率">地级市会员完成率</th>
					                    	<th title="单倍会员数">单倍会员数</th>
					                    	<th title="多倍会员数">多倍会员数</th>
					                    </tr>
					                </thead>
					                <tbody>
					                	<volist name="list" id="v">
					                    <tr role="row" class="odd">
					                        <td>{$v.time}</td>
											<td>{$v.csnum|default="0"}</td>
											<td>{$v.djs_csnum|default="0"}</td>
											<td>{$v.hyzb|default="0"}</td>
											<td>{$v.vipcnt|default="0"}</td>
											<td>{$v.hyswcl|default="0.0"} %</td>
											<td>{$v.djs_hywcl|default="0.0"} %</td>
											<td>{$v.vipnum|default="0"}</td>
											<td>{$v.doublecnt|default="0"}</td>
					                    </tr>
					                    </volist>
					                </tbody>
					            </table>
							</div>
                            <div class="box-footer text-center">
                                <div style="overflow:hidden;max-width: 1210px;">
                                    <div id="canvas" class="col-xs-6 no-padding canvas-height-300">
                                    </div>
                                    <div id="canvas1" class="col-xs-6 no-padding canvas-height-300">
                                    </div>
                                    <div id="canvas2" class="col-xs-6 no-padding canvas-height-300">
                                    </div>
                                </div>
                            </div>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
</block>
<block name="script">
	<script src="https://cdn.bootcss.com/echarts/3.5.4/echarts.js?v={:C('STATIC_VERSION')}"></script>
	<script type="text/javascript">
		$(function() {

			{$info.deptinfo}

			// 时间选择
			$(".datepicker").datetimepicker({
				startView:4,
				minView:'decade',
				format:"yyyy",
				autoclose:true,
				pickerPosition: "bottom-left"
			});

			// 注释信息
            $('.zhushi-icon').click(function() {
                if($(this).attr('show') == 'show'){
                    $('.zhushi-info').hide();
                    $(this).removeAttr('show')
                }else{
                    $('.zhushi-info').show();
                    $(this).attr('show','show');
                }
            });
            // 竖向滚动时，表格头部悬浮
            var x = 0;
            $(document).on('scroll',function(){
                if($(document).scrollTop() >= 300){
                    $('.thead1').show();
                    $('.thead2').css({'position':'fixed','top':0,'left':$('.sidebar').width()+26-x,'z-index':10});
                }else{
                    $('.thead1').hide();
                    $('.thead2').css({'position':'relative',left:0});
                }
            });
            // 横向滚动时，表格头部悬浮
            $('.overflow-x').on('scroll',function(){
                x = $(this).scrollLeft();
                $('.thead2').css({'left':$('.sidebar').width()+26-$(this).scrollLeft()});
            });

			// canvas图标
			var dom = document.getElementById("canvas");
			var dom1 = document.getElementById("canvas1");
			var dom2 = document.getElementById("canvas2");

			var myChart = echarts.init(dom);
			var myChart1 = echarts.init(dom1);
			var myChart2 = echarts.init(dom2);

			// 实际会员数同比 [参数项]
			var option = {
			    title : {
			        text: '实际会员数对比',
			        subtext: '会员数',
			        textStyle:{
					    color: '#359bed'
					}
			    },
			    tooltip : {
			        trigger: 'axis'
			    },
			    legend: {
			        data:['{$info.curYear}年实际会员数','{$info.perYear}年实际会员数'],
			        right:'60'
			    },
			    calculable : true,
			    xAxis : [
			        {
			            type : 'category',
			            boundaryGap : true,
			            data : ['02','03','04','05','06','07','08','09','10','11','12','01']
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value',
			            axisLabel : {
			                formatter: '{value}'
			            },
			            splitArea:{
				    		show:true,
				    		onGap:'boundaryGap',
				    		areaStyle:{
							    color: [
							        'rgba(250,250,250,0.3)',
							        'rgba(200,200,200,0.3)'
							    ]
							}
				    	}
			        }
			    ],
			    axis:{

			    },
			    series : [
			        {
			            name:'{$info.curYear}年实际会员数',
			            type:'line',
			            smooth:true,
			            data:[{$chart.cur.vipcnt}],
                        itemStyle: {
				            normal: {
				                color: "#359bed",  // 会设置点和线的颜色，所以需要下面定制 line
				            }
				        },
			            markPoint : {
			                data : [
			                    {type : 'max', name: '最大值'},
			                    // {type : 'min', name: '最小值'}
			                ]
			            }
			        },
			        {
			            name:'{$info.perYear}年实际会员数',
			            type:'line',
			            smooth:true,
			            data:[{$chart.per.vipcnt}],
                        itemStyle: {
				            normal: {
				                color: "#f5994e",  // 会设置点和线的颜色，所以需要下面定制 line
				            }
				        },
			            markPoint : {
			                data : [
			                    {type : 'max', name: '最大值'},
			                    // {type : 'min', name: '最小值'}
			                ]
			            }
			        }
			    ]
			};

			// 会员数完成率同比 [参数项]
			var option1 = {
			    title : {
			        text: '会员数完成率同比',
			        subtext: '完成率',
			        textStyle:{
					    color: '#359bed'
					}
			    },
			    tooltip : {
			        trigger: 'axis'
			    },
			    legend: {
			        data:['{$info.curYear}年会员数完成率','{$info.perYear}年会员数完成率'],
			        right:'60'
			    },
			    calculable : true,
			    xAxis : [
			        {
			            type : 'category',
			            boundaryGap : true,
			            smooth:true,
			            data : ['02','03','04','05','06','07','08','09','10','11','12','01']
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value',
			            axisLabel : {
			            	formatter: function(val){
                    			return val + '%';
                			}
			            },
			            splitArea:{
				    		show:true,
				    		onGap:'boundaryGap',
				    		areaStyle:{
							    color: [
							        'rgba(250,250,250,0.3)',
							        'rgba(200,200,200,0.3)'
							    ]
							}
				    	}
			        }
			    ],
			    series : [
			        {
			            name:'{$info.curYear}年会员数完成率',
			            type:'line',
			            smooth:true,
			            data:[{$chart.cur.hywcl}],
			            itemStyle: {
				            normal: {
				                color: "#359bed",  // 会设置点和线的颜色，所以需要下面定制 line
				            }
				        },
			            markPoint : {
			            	symbolSize: 60,
                            itemStyle: {
                                normal: {
                                    label:{ 
                                        show: true, 
                                        formatter: '{c}%' 
                                    }
                                }
                            },
			                data : [
			                    {type : 'max', name: '最大值'},
			                    // {type : 'min', name: '最小值'}
			                ]
			            }
			        },
			        {
			            name:'{$info.perYear}年会员数完成率',
			            type:'line',
			            smooth:true,
			            data:[{$chart.per.hywcl}],
			            itemStyle: {
				            normal: {
				                color: "#f5994e",  // 会设置点和线的颜色，所以需要下面定制 line
				                /*label:{ 
		                            show: true, 
		                            formatter: '{c}%' 
		                        }*/
				            }
				        },
			            markPoint : {
			            	symbolSize: 60,
                            itemStyle: {
                                normal: {
                                    label:{ 
                                        show: true, 
                                        formatter: '{c}%' 
                                    }
                                }
                            },
			                data : [
			                    {type : 'max', name: '最大值'},
			                ]
			            }
			        }
			    ]
			};
			// 会员数指标同比 [参数项]
			var option2 = {
			    title : {
			        text: '会员数指标同比',
			        subtext: '指标数',
			        textStyle:{
					    color: '#359bed'
					}
			    },
			    tooltip : {
			        trigger: 'axis'
			    },
			    legend: {
			        data:['{$info.curYear}年会员数指标','{$info.perYear}年会员数指标'],
			        right:'60'
			    },
			    calculable : true,
			    xAxis : [
			        {
			            type : 'category',
			            boundaryGap : true,
			            smooth:true,
			            data : ['02','03','04','05','06','07','08','09','10','11','12','01']
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value',
			            axisLabel : {
			                formatter: '{value}'
			            },
			            splitArea:{
				    		show:true,
				    		onGap:'boundaryGap',
				    		areaStyle:{
							    color: [
							        'rgba(250,250,250,0.3)',
							        'rgba(200,200,200,0.3)'
							    ]
							}
				    	}
			        }
			    ],
			    series : [
			        {
			            name:'{$info.curYear}年会员数指标',
			            type:'line',
			            smooth:true,
			            data:[{$chart.cur.hyzb}],
			            itemStyle: {
				            normal: {
				                color: "#359bed",  // 会设置点和线的颜色，所以需要下面定制 line
				            }
				        },
			            markPoint : {
			                data : [
			                    {type : 'max', name: '最大值'},
			                ]
			            }
			        },
			        {
			            name:'{$info.perYear}年会员数指标',
			            type:'line',
			            smooth:true,
			            data:[{$chart.per.hywcl}],
			            itemStyle: {
				            normal: {
				                color: "#f5994e",  // 会设置点和线的颜色，所以需要下面定制 line
				            }
				        },
			            markPoint : {
			                data : [
			                    {type : 'max', name: '最大值'},
			                ]
			            }
			        }
			    ]
			};


			// 实际会员数同比 canvas渲染
			myChart.setOption(option, true);
			// 会员数完成率同比 canvas渲染
			myChart1.setOption(option1, true);
			// 会员数指标同比 canvas渲染
			myChart2.setOption(option2, true);

			$(window).on('resize',function(){
				var myChart = echarts.init(dom);
				var myChart1 = echarts.init(dom1);
				var myChart2 = echarts.init(dom2);

				// 实际会员数同比 canvas渲染
				myChart.setOption(option, true);
				// 会员数完成率同比 canvas渲染
				myChart1.setOption(option1, true);
				// 会员数指标同比 canvas渲染
				myChart2.setOption(option2, true);
			});
		});
	</script>
</block>