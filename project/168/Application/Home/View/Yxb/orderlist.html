<extend name="Main:baseTemplate" />
<block name="style">
    <link rel="stylesheet" type="text/css" href="{:C('168NEW_URL')}/assets/common/plugins/pullselect/pullselect.css?v={:C('STATIC_VERSION')}">
    <link rel="stylesheet" type="text/css" href="{:C('168NEW_URL')}/assets/home/erp/css/common.css?v={:C('STATIC_VERSION')}">
    <link rel="stylesheet" type="text/css" href="{:C('168NEW_URL')}/assets/home/erp/css/order.css?v={:C('STATIC_VERSION')}">
    <link rel="stylesheet" type="text/css" href="{:C('168NEW_URL')}/assets/home/erp/css/orderlist.css?v={:C('STATIC_VERSION')}">
</block>
<block name="content">
    <section class="content-header">
        <div class="box-header">
            <h4>ERP订单列表</h4>
        </div>
        <div class="box box-body">
            <div class="row">
                <div class="col-xs-12">
                    <div class="tab-menu">
                        <input type="hidden" name="cid" value="{$_GET['cid']}">
                        <input type="hidden" name="btype" value="{$_GET['btype']}">

                        <div class="all fl"><a href="/yxb/orderlist/?cid={$_GET['cid']}&btype=1" <if condition="$_GET['btype'] eq 1">class="active"</if> >全部订单</a></div>

                        <div class="documentary fl"><a href="/yxb/orderlist/?cid={$_GET['cid']}&btype=2" <if condition="$_GET['btype'] eq 2">class="active"</if>>跟单中</a></div>

                        <div class="construction fl"><a href="/yxb/orderlist/?cid={$_GET['cid']}&btype=3" <if condition="$_GET['btype'] eq 3">class="active"</if>>施工中</a></div>

                        <div class="complete fl"><a href="/yxb/orderlist/?cid={$_GET['cid']}&btype=4" <if condition="$_GET['btype'] eq 4">class="active"</if>>已竣工</a></div>

                        <div class="abandon fl"><a href="/yxb/orderlist/?cid={$_GET['cid']}&btype=5" <if condition="$_GET['btype'] eq 5">class="active"</if>>已完成</a></div>

                        <div class="abandon fl"><a href="/yxb/orderlist/?cid={$_GET['cid']}&btype=6" <if condition="$_GET['btype'] eq 6">class="active"</if>>其他</a></div>
                    </div>
                    <table class="table-hover">
                        <thead>
                            <tr>
                                <th class="relative">
                                    <div>
                                        <span>ERP单号</span>
                                        <if condition="$_GET['ordertype'] eq 1 and $_GET['order'] eq 1">
                                            <i class="fa fa-sort-asc paixu" data-type="1"  data-order="{$ordertype[1]|default=1}"></i>
                                            <else/>
                                            <i class="fa fa-sort-desc paixu" data-type="1"  data-order="{$ordertype[1]|default=1}"></i>
                                        </if>
                                    </div>
                                </th>
                                <th class="relative">
                                    <div >
                                        <span>装修订单编号</span>
                                        <if condition="$_GET['ordertype'] eq 2 and $_GET['order'] eq 1">
                                            <i class="fa fa-sort-asc paixu" data-type="2"  data-order="{$ordertype[2]|default=1}"></i>
                                            <else/>
                                            <i class="fa fa-sort-desc paixu" data-type="2"  data-order="{$ordertype[2]|default=1}"></i>
                                        </if>

                                    </div>
                                </th>
                                <th>
                                    业主姓名
                                </th>
                                <th class="relative">
                                    <div >
                                        <span>订单类型</span><i class="fa fa-filter order-type-select"></i>
                                    </div>

                                </th>
                                <th class="relative">
                                    <div>
                                        <span>分单时间</span>
                                        <if condition="$_GET['ordertype'] eq 5 and $_GET['order'] eq 1">
                                            <i class="fa fa-sort-asc paixu" data-type="5"  data-order="{$ordertype[5]|default=1}"></i>
                                            <else/>
                                            <i class="fa fa-sort-desc paixu" data-type="5"  data-order="{$ordertype[5]|default=1}"></i>
                                        </if>
                                    </div>
                                </th>
                                <th class="relative">
                                    <div>
                                        <span>接单时间</span>
                                        <if condition="$_GET['ordertype'] eq 3 and $_GET['order'] eq 1">
                                            <i class="fa fa-sort-asc paixu" data-type="3"  data-order="{$ordertype[3]|default=1}"></i>
                                            <else/>
                                            <i class="fa fa-sort-desc paixu" data-type="3"  data-order="{$ordertype[3]|default=1}"></i>
                                        </if>

                                    </div>
                                </th>
                                <th class="relative">
                                    <div>
                                        <span>量房时间</span>
                                        <if condition="$_GET['ordertype'] eq 4 and $_GET['order'] eq 1">
                                            <i class="fa fa-sort-asc paixu" data-type="4"  data-order="{$ordertype[4]|default=1}"></i>
                                            <else/>
                                            <i class="fa fa-sort-desc paixu" data-type="4"  data-order="{$ordertype[4]|default=1}"></i>
                                        </if>

                                    </div>
                                </th>
                                <th class="relative">
                                    <div>
                                        <span>订单状态</span><i class="fa fa-filter order-status-select"></i>
                                    </div>
                                </th>
                                <th class="relative">
                                    <div>
                                        <span>施工状态</span><i class="fa fa-filter work-status-select"></i>
                                    </div>
                                </th>

                            </tr>
                        </thead>
                        <tbody>
                        <volist name="list" id="vo">
                            <tr>
                                <td><a href="/yxb/orderdetail/?id={$vo.order_no}&cid={$vo.company_id}" target="_blank">{$vo.order_no}</a></td>
                                <td>{$vo.qz_order}</td>
                                <td>{$vo.consumer_name}</td>
                                <td>{$vo.source}</td>
                                <td>{$vo.add_time}</td>
                                <td>{$vo.reception_time}</td>
                                <td>{$vo.follow_time}</td>
                                <td>{$vo.state}</td>
                                <td>{$vo.build_state|default='--'}</td>
                            </tr>
                        </volist>

                        </tbody>
                    </table>
                    <div class="data-num clearfix">
                        {$page}
                    </div>
                </div>
            </div>
        </div>
        <a href="javascript:history.back(-1)"><div class="btn back" >返回</div></a>
    </section>
    <form id="sx_form">
        <input type="hidden" name='dd_type'>
        <input type="hidden" name='dd_status'>
        <input type="hidden" name='sg_type'>
    </form>
</block>
<block name="script">
<script src="{:C('168NEW_URL')}/assets/common/plugins/pullselect/pullselect.js?v={:C('STATIC_VERSION')}"></script>
<script src="{:C('168NEW_URL')}/assets/common/js/plugins/dataTables/jquery.dataTables.js?v={:C('STATIC_VERSION')}"></script>
<script src="{:C('168NEW_URL')}/assets/common/js/plugins/dataTables/dataTables.bootstrap.min.js?v={:C('STATIC_VERSION')}"></script>
<script type="text/javascript" src="{:C('168NEW_URL')}/assets/home/erp/js/orderlist.js?v={:C('STATIC_VERSION')}"></script>
<script>

    $(function(){
        var searchData={$type};
        console.log(searchData);
        var dd_status=searchData.dd_status,
            dd_type=searchData.dd_type,
            sg_type=searchData.sg_type;


        var dataType =  '{$paixustatus}';
        var dataOrder = '{$paixu}';
        var cid = $('input[name=cid]').val();
        var btype = $('input[name=btype]').val();

          //下拉多选择筛选框

        $(".order-type-select").click(function(){
             pullSelect({
                target:$(this),
                //筛选项
                data:changArray(dd_type),
                searchFun:function(data){
                    //确定按钮后,执行
                    $("input[name=dd_type]").val(data.join("-"));



                    window.location = '/yxb/orderlist?ordertype='+dataType+'&order='+dataOrder+'&cid='+cid+'&btype='+btype+"&"+$("#sx_form").serialize();


                }
            })
        });

        //订单状态筛选
        $(".order-status-select").click(function(){
             pullSelect({
                target:$(this),
                //筛选项
                data: changArray(dd_status),
                searchFun:function(data){
                    //确定按钮后,执行
                    $("input[name=dd_status]").val(data.join("-"));

                    window.location = '/yxb/orderlist?ordertype='+dataType+'&order='+dataOrder+'&cid='+cid+'&btype='+btype+"&"+$("#sx_form").serialize();
                }
            })
        });


        //施工状态筛选
        $(".work-status-select").click(function(){
             pullSelect({
                target:$(this),
                //筛选项
                data:changArray(sg_type),
                searchFun:function(data){
                    //确定按钮后,执行
                  $("input[name=sg_type]").val(data.join("-"));
                   window.location = '/yxb/orderlist?ordertype='+dataType+'&order='+dataOrder+'&cid='+cid+'&btype='+btype+"&"+$("#sx_form").serialize();
                }
            })
        });


        //转化筛选数据
        function changArray(jsonObj){
            var jsonArray=[];
            for(var i in jsonObj){
                var item={
                    id:i,
                    name:jsonObj[i]
                }
                jsonArray.push(item);
            }
            return jsonArray;
        }
    })
</script>
</block>