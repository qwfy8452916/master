<include file="./Tpl/default/Wwgadmin/header.html" />
<style type="text/css">
.fl_l   { float: left;font-family: "Libre Baskerville", "Lucida Grande", "Hiragino Sans GB", "Hiragino Sans GB W3", "Microsoft YaHei", "wenquanyi micro hei", sans-serif, "Apple Color Emoji"; }
.box2   { border: 1px solid #e0e0e0; margin-top: 8px; width:730px; margin-left: 6px; padding-bottom: 20px;}
.box2 .nav      { height: 34px; background-color:#dddee0 ; margin-bottom: 10px; padding-left: 10px; }
.box2 .nav a    { font-size: 14px; height: 34px; line-height: 34px; vertical-align: middle; float: left; display: block; padding: 0 10px; margin-right: 10px; }
.box2 .nav a.on { color: red; font-weight: bold; background:url(/Public/useradmin/image/nav_bg2.png) repeat-x ;}
textarea, textarea.input-text, textarea.input-focus
{ font-size:12px;height:auto; padding:5px; margin:0; }
select  { vertical-align:middle;background:none repeat scroll 0 0 #F9F9F9;border-color:#d0d0d0;border-style:solid;border-width:1px;color:#333;padding:2px; height:24px;}

.moddle2        { width: 718px; overflow: hidden; margin: 0px auto; margin-top: 10px; margin-left: 5px; }
.form-div       { width:440px; padding-left:40px; margin-top: 20px;}
#form_btn       { cursor: pointer;}
.input          { padding:10px 0;position: relative;}
.input input{height: 30px; line-height: 30px; border:1px solid #DDD; padding-left: 5px;}

.input label    { width:84px; line-height: 28px; display: block; font-size:14px;text-align:right; float: left; vertical-align: middle; margin-right: 6px;font-weight: normal}

.radio          { position: absolute; vertical-align: middle; }
textarea        { width: 300px; height: 60px;}
.input .select_type{height: 30px; border:1px solid #DDD;}
.onShow, .onFocus, .onError, .onCorrect, .onLoad, .onTime
{ zoom:1; background:url(/Public/useradmin/image/msg_bg.png) no-repeat; color:#444;padding:2px 10px 2px 23px; margin-left:10px;_margin-left:5px; margin-top: -5px; position:absolute; margin-top: 1px; font-size: 12px; line-height: 150%; }
.onShow         {background-position:3px -147px;border-color:#40B3FF;color:#959595}
.onFocus        {background-position:3px -147px;border-color:#40B3FF;}
.onError        {background-position:3px -47px;border-color:#40B3FF; color:red}
.onCorrect      {background-position:3px -247px;border-color:#40B3FF; color: #fff; }

.tablebg{background: #F3F3F3;}
.table .tableth{text-align: left;}
.table .tableCell .input{float: left; margin:0 5px; padding:0;}
.table .tableCell .input input[type=text]{width: 100px;height: 30px; border: 1px solid #c6c6c6;  padding-left: 5px; border-radius: 3px;}
.table .tableCell .input input[type=radio]{margin-top:8px;}
.table .tableCell .input select{border: 1px solid #c6c6c6;width: 50px; padding:5px; border-radius: 3px;}
.table .rowSpan .tableCell{border-top: 0;}
.table .tableCell .input textarea{width:455px; border:1px solid #c6c6c6; border-radius:3px; padding-left:2px; height:60px; resize:none;}
.table .tableth .input{padding:0;}
.table .tableth .span,.table .tableCell .span{font-size: 14px; font-weight: bold; float: left; margin-top:5px;cursor:pointer;}
.table .tableCell:after{content: ""; clear:both; display: block;}
.table .tableCell .button{float: left; margin-left: 10px; width: 100px;padding:4px 12px; }
.table .adv_index{margin-right: 5px;}
.table .adv_index:first-child{margin-left:5px;}
.table .tableCell .adv_citys{font-weight: normal;font-size: 12px;margin-right: 5px;}
.table .tableCell .adv_input{margin:0;}
.table .tableCell .adv_input .span:hover{color: #ff0000;}
.table .tableCell .adv_active{background: #428BCA;color: #ffffff;}
.table .tableCell .adv_current{font-weight: bold; color: #ff0000;}

.tags{margin: 0;padding: 0; width: 600px; float: left; margin-bottom: 10px;}
.tags li{float: left;padding:5px; border: 1px solid #DDD; background:#ECF0F1; border-radius: 5px; margin-right: 10px; margin-bottom: 10px; cursor: pointer; color: #666;}
.tags li i{margin-right: 3px;}
.tags .active{background: #FF8589; color: #FFF; border: 1px solid #FF8589; }
.contents {width:600px;}
.contentCount {padding-left:90px;margin-top:10px;}
.imgList {width:720px;padding-left:90px;padding-top:10px;display:none}
.ptime {margin-left:10px;width:200px;}
.username {width:300px;}
.select2-selection--multiple{height: 30px;}
.select2-search__field{margin-top: 0px !important;}
</style>
<script src="/Public/default/js/uploadify/jquery.uploadify.min.js?v={:C('STATIC_VERSION')}"></script>
<link href="/Public/default/js/uploadify/uploadify.css?v={:C('STATIC_VERSION')}" rel="stylesheet" type="text/css" />
<link rel='stylesheet' href="/Public/select2/css/select2.css?v={:C('STATIC_VERSION')}"/>
<script charset="utf-8" src="/Public/bootstrap/js/bootstrap.autocomplete.js?v={:C('STATIC_VERSION')}"></script>
 <div id="right" class="fl_l">
  <div class="text">
    <div class="box2">
      <div class="moddle2 form_div">
          <form id="form1" action="" method="POST">
          <ul>
            <li class="input"><label>问题分类：</label>
                <select name="cid" id="category_id" class="select_type">
                   <option value="-1">-请选择分类-</option>
                   <volist name="rootCategory"  id="vo">
                    <if condition="$vo['cid'] EQ $ask['cid']">
                        <option value="{$vo.cid}" selected="selected" >{$vo.name}</option>
                    <else/>
                        <option value="{$vo.cid}">{$vo.name}</option>
                    </if>
                   </volist>
                </select>
                <select name="sub_category" id="sub_category" class="select_type" {$ask.is_show}>
                   <volist name="subCategory"  id="vo">
                    <if condition="$vo['cid'] EQ $ask['sub_category']">
                        <option value="{$vo.cid}" selected="selected" >{$vo.name}</option>
                    <else/>
                        <option value="{$vo.cid}">{$vo.name}</option>
                    </if>
                   </volist>
                </select>
                <span><span style="font-size: 14px;vertical-align: middle;">&nbsp;&nbsp;&nbsp;&nbsp;城市：</span>&nbsp;&nbsp;</span>
                <select name="area_id" id="area_id" class="select_type">
                   <option value="-1">-选择省份-</option>
                   <volist name="provinceList"  id="vo">
                    <if condition="$vo['qz_provinceid'] EQ $ask['area_id']">
                        <option value="{$vo.qz_provinceid}" selected="selected" >{$vo.qz_province}</option>
                    <else/>
                        <option value="{$vo.qz_provinceid}">{$vo.qz_province}</option>
                    </if>
                   </volist>
                </select>
                <select  name="city_id" id="city_box" class="select_type">
                   <volist name="cityList"  id="vo">
                    <if condition="$vo['cityid'] EQ $ask['city_id']">
                        <option value="{$vo.cityid}" selected="selected" >{$vo.city}</option>
                    <else/>
                        <option value="{$vo.cityid}">{$vo.city}</option>
                    </if>
                   </volist>
                </select>
            </li>
            <li class="input"><label>用户/时间：</label>
            <div>
            <input name="username" type="text" placeholder="请输入用户名系统会自动提示，请勿手动修改！" value="" style="width:300px;" class="form-control pull-left username" autocomplete="off">
            <input name="post_time" type="text" style="margin-left:10px;width:200px;" value="" class="form-control pull-left ptime">
            <div class="clearfix">
            </div>
            </li>
            <li class="input"><label>标题：</label>
            <input name="title" type="text" placeholder="题问标题" value="" style="width:600px;" class="form-control"></li>

            <li class="input"><label>关键字：</label>
            <input name="keywords" type="text" value="" style="width:600px;"  placeholder="keywords" class="form-control">
            </li>

            <li class="input">
                <label>标签:</label>
                <select name="tags" class="tags validate[required] input-text" id="tags"
                multiple="">
                    <notempty name="ask.tagname">
                        <volist name="ask.tagname" id="vo">
                            <option value="{$vo}" selected>
                                {$vo}
                            </option>
                        </volist>
                    </notempty>
                </select>
                <input name="tagnames" id="tagnames" type="hidden">
            </li>

            <li class="input"><label>问题补充：</label>
            <textarea name="content" id="content" style="height:110px" class="form-control contents"></textarea><br>
            <span class="contentCount">还可以输入 <em>1500</em>  字</span>
            <div class="row imgList" id="imgList"></div>
            </li>

            <li class="input" style=" margin-left: 95px;"><a name="uploadPic" id="uploadPic" href="javascript:;" class="btn btn-success button"><i class=" icon-plus-sign "></i>上传文件</a></li>

    <li class="input" style=" margin-left: 95px;">
    <a href="javascript:;" id="createAnwser" class="btn btn-info button" style="width:600px;"><i class=" icon-plus-sign "></i> 增加一条答案</a></li>

    <div id="anwserList">

        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li>

        <div id="answer_1"  style="display:none">
        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li>
        </div>

        <div id="answer_2" style="display:none">
        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li>
        </div>

        <div id="answer_3" style="display:none">
        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li>
        </div>

        <div id="answer_4" style="display:none">
        <li class="input" ><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li>
        </div>

        <div  id="answer_5" style="display:none">
        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li></div>

        <div  id="answer_6" style="display:none">
        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li></div>

        <div  id="answer_7" style="display:none">
        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li></div>

        <div  id="answer_8" style="display:none">
        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li></div>

        <div  id="answer_9" style="display:none">
        <li class="input"><label>用户/时间：</label>
        <input name="a_username[]" type="text" value="" class="form-control pull-left username">
        <input name="a_post_time[]" type="text" class="form-control pull-left ptime">
        <div class="clearfix"></div></li>
        <li class="input"><label>答案内容：</label><textarea name="a_content[]" style="height:80px" class="form-control contents"></textarea><br>
        <span class="contentCount">还可以输入 <em>1500</em>  字</span></li>
        </li></div>

        </div>
    </div>

    <li class="input" style=" margin-left: 95px;">
    <a id="submit" href="javascript:;" class="btn btn-success button" style="width:600px;"><i class="icon-ok-sign "></i> 增加问题和答案</a></li>
          </ul><div class="alert alert-warning" role="alert"><i class="icon-volume-up"></i> 提示：回答问题时请注意，用户/时间/回答缺一不可.特别说明：现在已全部支持自动注册帐号，答案不支持上传图片
          </div>
          </form>
      </div>
      <div class="bottom"></div>
    </div>
  </div>
 </div>
<br style="clear: both;" />
<script src="/Public/select2/js/select2.js?v={:C('STATIC_VERSION')}"></script>
<script src="/Public/select2/js/zh-CN.js?v={:C('STATIC_VERSION')}"></script>
<script type="text/javascript">

$(document).ready(function(){
    $(".tags").select2({
        language: "zh-CN",
        tags: false,
        multiple: true, //是否使用多个标签
        ajax: {
            url: "/admintags/gettagsapi/",
            dataType: 'json',
            type: 'GET',
            delay: 1000,
            data: function (params) {
              return {
                key: params.term, //查询参数
              };
            },
            processResults: function (data, page) {
                var parsed = data.data;
                var arr = [];
                for(var x in parsed){
                    arr.push(parsed[x]); //这个应该是个json对象
                }
                return {
                    results: arr
                };
            },
            cache: true
          },
        escapeMarkup: function (markup) { return markup; },
        /*最小需要输入多少个字符才进行查询，与之相关的小需要输入多少个字符才进行查询，与之相关的maximumSelectionLength表示最大输入限制*/
        minimumInputLength: 1
    });
})

function getResult(content){
    var obj = new Function("return" + content)();
    $("#imgList").show();
    $("#imgList").append('<div class="col-xs-6 col-md-3"><a href="http://staticqn.qizuang.com/'+ obj.data +'" class="thumbnail"><img src="http://staticqn.qizuang.com/'+ obj.data +'" data-holder-rendered="true" target="_blank" style="height: 120px; width: 120%; display: block;"></a></div>');
    $("#imgList").append($("<input type='hidden' name='imgId[]' value='" + obj.data + "'/>"));
}

$(function() {
    var answerid = 1;
    $("#createAnwser").click(function(event){
        if(answerid <= 9){
            $("#answer_"+answerid).show();
            answerid++;
        }else{
            alert('已达系统支持的最大数，慢慢来吧？');
        }
    });

    $(".contents").bind("input propertychange",function(){
        var length = $(this).val().length;
        if(length > 1500){
            var offset = length - 1500;
            $(this).parent().find('span em').html('<i class="red">您已经超出了 '+offset+" 字</i>");
        }else{
            $(this).parent().find('span em').html(1500 - length);
        }
    });

    $('#uploadPic').uploadify({
        'swf'      : '/Public/default/js/uploadify/uploadify.swf',
        'uploader' : '/adminask/upload',
        'fileTypeExts': '*.gif; *.jpg; *.png',
        'buttonText': '上传图片',
        'queueSizeLimit' : 5,
        'height'   : 35,
        'auto': true,
        'multi': true,
        'progressData' : 'speed',
        'formData' : {
            'id': '',
            'type': '1'
        },
        'onUploadSuccess':function(file,data,response){
            getResult(data);
        }
    });

    $('.ptime').datetimepicker({
        language:  'zh-CN',
        weekStart: 1,
        todayHighlight: true,
        minuteStep:1,
        autoclose: true,
        startView: 1,
        //forceParse: 0,
        pickerPosition: "bottom-left"
    });
    $('.ptime').datetimepicker('setEndDate','{$endtime}');

    $('.username').autocomplete({
        items:20,
        source:function(query,process){
            var matchCount = this.options.items;//返回结果集最大数量
            $.ajax({
                url: '/adminask/getseouser',
                type: 'GET',
                dataType: 'JSON',
                data: {
                    matchcount : matchCount,
                    text: query
                },
            })
            .done(function(data) {
                mask.hide(); mask_img.hide();
                if(data.status == 1){
                    return process(data.data);
                }else{
                    return process(data.info);
                }
            }).fail(function(xhr){
                alert(xhr.responseText);
            });

        },
        formatItem:function(item){
           return item["name"];
        },
        setValue:function(item){
            return {"data-value":item["uid"]+'|'+item["name"],"real-value":item["id"]};
        },
    });

    $("#area_id").change(function(){
        $("#city_box").load("/adminask/getcitybyajax/id/"+$("#area_id").val());
    });

    $("#category_id").change(function(){
        if ($("#sub_category").css('display') == 'none'){
            $("#sub_category").show();
        }
        var cid = $("#category_id").val();
        if(cid !== '0'){
            $("#sub_category").load("/adminask/getcategorybyajax/id/" + cid);
        }else{
            $("#sub_category").empty();
        }
    });

    //提交
    $("#submit").click(function(event){
        var categoryId = $("#category_id").val();
        if(categoryId==-1){
            alert('请选择一级分类');
            return false;
        }
        var subCategory = $("#sub_category").val();
        if(subCategory==-1){
            alert('请选择二级分类');
            return false;
        }
        var area_id = $("#area_id").val();
        if(area_id == -1){
            alert('请选择省份！');
            return false;
        }
        var city_box = $("#city_box").val();
        if(city_box == -1){
            alert('请选择城市');
            return false;
        }
        if($('[name=title]').val() === ''){
            $("input[name=title]").focus();
            $("input[name=title]").addClass('focus');
            alert("请填写标题");
            return false;
        }
        if($("input[name=contents]").val() === ''){
            $("input[name=contents]").focus();
            $("input[name=contents]").addClass('focus');
            alert("请填写内容");
            return false;
        }

        var tags = $("#tags").select2("data");
        var tagnames = '';
        $.each(tags,
        function(n, value) {
            tagnames = tagnames + value.text + ',';
        });
        $('#tagnames').val(tagnames);
        $("#form1").submit();
    });
    $("#title").bind("input propertychange",function(){
        var length = $(this).val().length;
        if(length > 50){
            var offset = length - 50;
            $("#titleCount").html('<i style="color:red">您已经超出了 '+offset+" 字</i>");
        }else{
            $("#titleCount em").html(50 - length);
        }
    });

});
</script>
