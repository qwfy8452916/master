
<div class="win_box zxfb">
    <div class="win_box_bg">
    </div>
    <div class="win_box_content zxbj_content">
        <div class="form-horizontal">
            <div class="win_box_list">
                <form id="bj-form">
                <div class="step1" >
                    <div class="line">
                        <div class="steptop">
                            <div class="shutdown step_close"></div>
                        </div>
                    </div>
                    <div class="step_form">
                        <div class="line">
                            <div class="col-2 label">
                                小区名称
                            </div>
                            <div class="col-5">
                                 <input type="text" name="bj-xiaoqu" placeholder="小区名称" />
                            </div>
                        </div>
                        <div class="line">
                            <div class="col-2 label">
                                房屋面积
                            </div>
                            <div class="col-2">
                                <input name="bj-mianji" type="text" placeholder="房屋面积">
                            </div>
                            <div class="col-2">
                                <i style="font-style:normal; margin-left:15px; margin-top:8px; float:left;">平方米</i>
                            </div>
                            <div class="col-4">
                                <i class="win_box_tip zxbj-tip" style="margin-left:-20px"></i>
                            </div>
                        </div>
                        <!-- <div class="line">
                            <div class="col-2 label">
                                装修风格
                            </div>
                            <div class="col-8">
                                <select name="bj-fengge" class="col-5">
                                <option value="0">请选择</option>
                                <volist name="fengge" id="vo">
                                    <option value="{$vo.id}">{$vo.name}</option>
                                </volist>
                                </select>
                                <i class="win_box_tip zxbj-tip"></i>
                            </div>
                        </div> -->
                        <div class="line">
                            <div class="col-2 label">
                                房屋地址
                            </div>
                            <div class="col-6">
                                <select id="bj-cs" class="col-5 cs_winbox">
                                </select>
                                <select id="bj-qy"  class="col-5 qy_winbox">
                                </select>
                            </div>
                            <div class="col-4">
                                <i class="win_box_tip zxbj-tip" style="margin-left:-20px"></i>
                            </div>
                        </div>
                        <!-- <div class="line">
                            <div class="col-2 label">
                                装修种类
                            </div>
                            <div class="col-5">
                                <input id="house1" name="bj-lxs" type="radio" value="1" class="icheck" checked>
                                <label for="house1" class="span">新房装修</label>
                                 <input name="bj-lxs" class="icheck" type="radio" value="2">
                                <label for="house2" class="span">二手房装修</label>
                            </div>
                        </div> -->
                        <div class="line">
                            <div class="col-2 label">
                                装修档次
                            </div>
                            <div class="col-4">
                                <input name="bj-zxdc" type="radio" class="icheck"  id="plan1" value="1">
                                <label for="plan1" class="span">简装</label>
                                <input name="bj-zxdc" type="radio" class="icheck" id="plan2" value="2" checked>
                                <label for="plan2" class="span">精装</label>
                                <input id="plan3" name="bj-zxdc" class="icheck" type="radio" value="3">
                                <label for="plan3" class="span">豪装</label>
                            </div>
                        </div>
                        <div class="line">
                            <a id="btnNext" class="button" href="javascript:void(0)">快完成了，下一步</a>
                        </div>
                    </div>
                </div>
                <div class="step2">
                    <div class="line">
                        <div class="steptop">
                            <h2>手机验证</h2>
                            <div class="shutdown step_next"></div>
                            <div class="win_line"></div>
                        </div>
                    </div>
                    <div class="line">
                        <div class="step_info">
                            为了给您提供更快速高效的服务、我们会给您手机免费发送短信
                        </div>
                    </div>
                    <div class="step_form">
                        <!-- <div class="line">
                            <div class="col-3 label">
                                您的称呼
                            </div>
                            <div class="col-2">
                                <input type="text" class="step_input step_contact" name="bj-name" placeholder="您的称呼"  />
                            </div>
                            <div class="col-4">
                                <div class="col-1">
                                    &nbsp;
                                </div>
                                <input id="sex-man" type="radio" name="bj-sex" class="icheck" checked="checked" value="先生" />
                                <label for="sex-man" class="span">先生</label>
                                <input id="sex-lady" type="radio" name="bj-sex" class="icheck" value="女士" />
                                <label for="sex-lady" class="span">女士</label>
                            </div>
                        </div> -->
                        <div class="line">
                            <div class="col-3 label">
                                手机号码
                            </div>
                            <div class="col-6">
                                <input name="bj-tel" class="step_input" type="text" placeholder="手机号码">
                            </div>
                        </div>
                        <!-- <div class="line">
                            <div class="col-3 label">
                                验证码
                            </div>
                            <div class="col-2">
                                <input name="bj-verfiy" type="text" class="step_input step_contact" placeholder="验证码">
                            </div>
                            <div class="col-1">
                                &nbsp;
                            </div>
                            <div class="col-3">
                                <button class="verify bj-verify"  type="button">获取短信验证码</button>
                            </div>
                        </div> -->
                        <!-- <div class="line">
                            <div class="step_tips">
                                验证码有效期为30分钟
                            </div>
                        </div> -->
                        <div class="line">
                            <div class="step_tips step2_tips">
                                &nbsp;
                            </div>
                        </div>
                        <div class="line buttons">
                            <!-- <button class="button btnBack">
                                返回上一步
                            </button> -->
                            <button id="btn_bj_sub" class="button">
                                提交
                            </button>
                            <input name="bj-id" type="hidden" value=""/>
                            <input name="bj-safecode" type="hidden" value="{$safecode}"/>
                            <input name="bj-safekey" type="hidden" value="{$safekey}"/>
                            <input name="bj-ssid" type="hidden" value="{$ssid}"/>
                        </div>
                    </div>
                </div>
                <div class="step3">
                    <div class="steptop">
                        <h2>距离拿到免费报价只差一步，您真的要离开吗?</h2>
                        <div class="shutdown step_close"></div>
                        <div class="win_line"></div>
                    </div>
                    <div class="step_form">
                        <div class="line">
                            <div class="step_info">
                                <dl>
                                    <dt>您可能就会无法获得:</dt>
                                    <dd>1.您需要的报价清单</dd>
                                    <dd>2.齐装网为您免费提供的4大服务，其中包括：上门量房、户型设计、预算报价、参观工地及样板房，实现全面对比,让您装修0负担!</dd>
                                </dl>
                            </div>
                        </div>
                        <div class="line buttons">
                            <button class="button btnBack">
                                返回上一步
                            </button>
                            <button class="button step_close">
                                关闭
                            </button>
                        </div>
                    </div>
                </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
App.citys.init("#bj-cs","#bj-qy",shen,shi,"{$cityid}");
$(function(){
    $('.icheck').iCheck({
        checkboxClass: 'icheckbox_minimal-red',
        radioClass: 'iradio_minimal-red',
        increaseArea: '' // optional
    });


    $(".win_box_bg").click(function(event) {
        close();
        return false;
    });

    $(".step_close").click(function(event) {
        close();
        return false;
    });

    $(".btnClose").click(function(event) {
        close();
        return false;
    });

    $("#btnNext").click(function(event) {
        if ($("input[name=bj-mianji]").val() == "") {
            $("input[name=bj-mianji]").addClass('win_box_focus');
            $("input[name=bj-mianji]").focus();
            $("input[name=bj-mianji]").parent().parent().find(".zxbj-tip").html("亲,您还没有填写房屋面积!");
            $(".win_box_list").animate({
                left: 0
            }, 400);
            return false;
        }
        var re = /^[0-9]+(.[0-9]{1,2})?$/gi;
        if (!re.test($("input[name=bj-mianji]").val())) {
            $("input[name=bj-mianji]").addClass('win_box_focus');
            $("input[name=bj-mianji]").focus();
            $("input[name=bj-mianji]").parent().parent().find(".zxbj-tip").html("亲,只能填写纯数字!");
            $(".win_box_list").animate({
                left: 0
            }, 400);
            return false;
        }

        $("input[name=bj-mianji]").removeClass('win_box_focus');
        $("input[name=bj-mianji]").parent().parent().find(".zxbj-tip").html("");

        // if ($("select[name='bj-fengge']").val() == 0) {
        //     $("select[name='bj-fengge']").addClass('win_box_focus');
        //     $("select[name='bj-fengge']").parent().parent().find(".zxbj-tip").html("亲,您房屋的装修风格还没选!");
        //     $(".win_box_list").animate({
        //         left: 0
        //     }, 400);
        //     return false;
        // }

        $("select[name='bj-fengge']").removeClass('win_box_focus');
        $("select[name='bj-fengge']").parent().parent().find(".zxbj-tip").html("");

        $("input[name=bj-mianji]").removeClass('win_box_focus');
        $("input[name=bj-mianji]").parent().parent().find(".zxbj-tip").html("");

        if ($("#bj-cs").val() == 0) {
            $("#bj-cs").addClass('win_box_focus');
            $("#bj-cs").parent().parent().find(".zxbj-tip").html("亲,您房屋所在的城市还没有选择!");
            $(".showContent").animate({
                left: 0
            }, 400);
            return false;
        }
        $("#bj-cs").removeClass('win_box_focus');
        $("#bj-cs").parent().parent().find(".zxbj-tip").html("");

        if ($("#bj-qy").val() == 0) {
            $("#bj-qy").addClass('win_box_focus');
            $("#bj-qy").parent().find(".zxbj-tip").html("亲,您房屋所在的城市区县还没有选择!");
            $(".win_box_list").animate({
                left: 0
            }, 400);
            return false;
        }

        $("#bj-qy").removeClass('win_box_focus');
        $("#bj-qy").parent().parent().find(".zxbj-tip").html("");
        win_next();
        return false;
    });

    $(".step_next").click(function(event) {
        win_next();
        return false;
    });


    $(".btnBack").click(function(event) {
        win_prv();
        return false;
    });

    function close() {
        $.ajax({
            url: "/setwindowswitch/",
            type: 'POST',
            dataType : "json",
        });
        if(navigator.appName == "Microsoft Internet Explorer"){
            $(".zxfb").remove();
            $("#s-zxzb").show();
        }else{
            $(".zxbj_content").addClass('smaller');
            $(".zxfb").fadeOut(500,function(){
                $(".zxfb").remove();
            });
            $("#s-zxzb").show();
        }
        $(".win_box_list").animate({
            left: 0
        }, 400);
        return false;
    }
    //下一个窗口
    function win_next() {
        var w = $(".step1")[0].offsetWidth;
        $(".win_box_list").animate({
            left: "-=" + w
        }, 400);
        return false;
    }

    //上一个窗口
    function win_prv() {
        var w = $(".step1")[0].offsetWidth;
         $(".win_box_list").animate({
            left: "+=" + w
        }, 400);
        return false;
    }


    $("#btn_bj_sub").click(function(event) {
        $("#btn_bj_sub").text("提交中...");
        var tel = $("input[name=bj-tel]").val();
        if (tel == "" || tel.length == 0) {
            $("input[name=bj-tel]").addClass('win_box_focus');
            $("input[name=bj-tel]").focus();
            $(".step2_tips").html("亲,您还没有填写手机号码!");
            $("#btn_bj_sub").text("提交");
            return false;
        }
        $("input[name=bj-tel]").removeClass('win_box_focus');
        $(".step2_tips").html("");

        var reg = /^[0-9]{7}|[0-9]{8}|[0-9]{11}$/gi;
        if (!$("input[name=bj-tel]").val().match(reg)) {
            $(".step2_tips").html("请填写7位或11位纯数字的联系电话 ^_^!");
            $("input[name=bj-tel]").addClass('win_box_focus').focus();
            $("#btn_bj_sub").text("提交");
            return false;
        }

        $("input[name=bj-tel]").removeClass('win_box_focus');
        $(".step2_tips").html("");
        var data ={
                mianji:$("input[name=bj-mianji]").val(),
                lxs:$("input[name=bj-lxs]:checked").val(),
                cs:$("#bj-cs").val(),
                qx:$("#bj-qy").val(),
                fengge:$("select[name=bj-fengge]").val(),
                xiaoqu:$("input[name=bj-xiaoqu]").val(),
                name:$("input[name=bj-name]").val(),
                sex:$("input[name=bj-sex]:checked").val(),
                zxdc:$("input[name=bj-zxdc]:checked").val(),
                tel:tel,
                source:"30",
                chu:$("select[name=bj-chu]").val(),
                yt:$("select[name=bj-yt]").val(),
                tel:tel,
                save:1,
                safecode:$("input[name=bj-safecode]").val(),
                ssid:$("input[name=bj-ssid]").val(),
                safekey:$("input[name=bj-safekey]").val()
            };
        $.ajax({
            type : "POST",
            url : "/fb_order/",
            dataType : "json",
            data:data,
            success : function(data){
                if(data.status == 1){
                    //$(".step2_tips").html('发布成功!页面跳转~');

                    window.location.href = "http://{:C('QZ_YUMINGWWW')}/zxbj/{$cityInfo.bm}";
                }else{
                    $(".step2_tips").html(data.info);
                }
                $("input[name=bj-safecode]").val(data.data.safecode);
                $("input[name=bj-ssid]").val(data.data.ssid);
                $("input[name=bj-safekey]").val(data.data.safekey);
                $("#btn_bj_sub").text("提交");
            },
            error:function(xhr){
                $(".step2_tips").html("发布失败,请刷新页面后重试");
                $("#btn_bj_sub").text("提交");
            }
        });
        return false; //防止表单提交 给一个fasle
    });

    // $(".bj-verify").click(function(event) {
    //     var tel = $("input[name=bj-tel]").val();
    //     if (tel == "" || tel.length == 0) {
    //         $("input[name=bj-tel]").addClass('win_box_focus');
    //         $("input[name=bj-tel]").focus();
    //         $(".step2_tips").html("亲,您还没有填写手机号码!");
    //         return false;
    //     }
    //     $("input[name=bj-tel]").removeClass('win_box_focus');
    //     $(".step2_tips").html("");

    //     var reg = /^[0-9]{7}|[0-9]{8}|[0-9]{11}$/gi;
    //     if (!$("input[name=bj-tel]").val().match(reg)) {
    //         $(".win_box_err").html("请填写7位或11位纯数字的联系电话 ^_^!");
    //         $("input[name=bj-tel]").addClass('win_box_focus').focus();
    //         return false;
    //     }

    //     $("input[name=bj-tel]").removeClass('win_box_focus');
    //     $(".step2_tips").html("");
    //     $(".bj-verify").prop("disabled","disabled");
    //     var data ={
    //             mianji:$("input[name=bj-mianji]").val(),
    //             lxs:$("input[name=bj-lxs]:checked").val(),
    //             cs:$("#bj-cs").val(),
    //             qx:$("#bj-qy").val(),
    //             fengge:$("select[name=bj-fengge]").val(),
    //             xiaoqu:$("input[name=bj-xiaoqu]").val(),
    //             name:$("input[name=bj-name]").val(),
    //             sex:$("input[name=bj-sex]:checked").val(),
    //             zxdc:$("input[name=bj-zxdc]:checked").val(),
    //             tel:tel,
    //             source:"30",
    //             chu:$("select[name=bj-chu]").val(),
    //             yt:$("select[name=bj-yt]").val(),
    //             tel:tel,
    //             save:1,
    //             safecode:'{$safecode}',
    //             ssid:"{$ssid}",
    //             safekey:"{$safekey}"
    //         };
    //     $.ajax({
    //         type : "POST",
    //         url : "http://oauthtmp.qizuang.com/Sms/sendsms",
    //         dataType : "json",
    //         data:data,
    //         xhrFields: {
    //             withCredentials: true
    //         },
    //         crossDomain: true,
    //         success : function(data){
    //             if(data.status == 1){
    //                 $("input[name=bj-id]").val(data.data.orderid)
    //             }else{
    //                 $(".bj-verify").prop("disabled",false);
    //                 $(".step2_tips").html(data.info);
    //             }
    //         },
    //         error:function(xhr){
    //             $(".bj-verify").prop("disabled",false);
    //             $(".step2_tips").html("发布失败,请稍后重试");
    //         }
    //     });
    // });

    // $("#btn_bj_sub").click(function() {
    //     if ($("input[name=bj-verfiy]").val() == "" || $("input[name=bj-verfiy]").val().length == 0) {
    //         $("input[name=bj-verfiy]").addClass('win_box_focus');
    //         $("input[name=bj-verfiy]").focus();
    //         $(".step2_tips").html("亲,您别忘记填写验证码!");
    //         return false;
    //     }

    //     var reg = /^[0-9]{6}$/gi;
    //     if (!$("input[name=bj-verfiy]").val().match(reg)) {
    //         $(".step2_tips").html("亲,你填写的6位数字验证码^_^!");
    //         $("input[name=bj-verfiy]").addClass('win_box_focus').focus();
    //         return false;
    //     }

    //     $("input[name=verfiy]").removeClass('win_box_focus');
    //     $(".step2_tips").html("");
    //     var id = $("input[name=bj-id]").val();
    //     $.ajax({
    //         url: "http://oauthtmp.qizuang.com/sms/verifysmscode",
    //         type: 'POST',
    //         dataType : "JSON",
    //         xhrFields: {
    //             withCredentials: true
    //         },
    //         crossDomain: true,
    //         data: {
    //             code: $("input[name=bj-verfiy]").val(),
    //             tel:$("input[name=bj-tel]").val()
    //         },
    //         success: function(data) {
    //             if (data.status == 1) {
    //                 window.location.href = "http://{:C('QZ_YUMINGWWW')}/zxbj/";
    //             } else {
    //                 $("input[name=bj-verfiy]").addClass('alert-focus');
    //                 $("input[name=bj-verfiy]").focus();
    //                 $(".step2_tips").html(data.info);
    //             }
    //         },
    //         error: function(xhr) {
    //             $(".step2_tips").html("亲,发布信息失败,请稍后重试 ~>_<~+！");
    //         }
    //     });
    //     return false;
    // });

});
</script>