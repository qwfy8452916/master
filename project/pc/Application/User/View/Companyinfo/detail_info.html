<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="keywords" content="{$keys.keywords}">
  <meta name="description" content="{$keys.description}">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title>{$keys.title}-{$title}</title>
  <include file="Index:resource" />
  <include file="Home:resource" />
  <link rel="stylesheet" href="{$static_host}/assets/user/home/css/ht-info.css?v={:C('STATIC_VERSION')}" />
  <script type="text/javascript" src="{$static_host}/assets/common/js/laydate.js?v={:C('STATIC_VERSION')}"></script>
  <style type="text/css">
  .laydate-icon{width: 150px;}
  .ht-moreinfo li ul li{width: 150px;}
  </style>
</head>
<body>
  <include file="Home:header" />
  <div class="ht-wrap oflow ht-relative">
    <include file="Home:comnavleft" />
    <include file="Companyinfo:tab_header" />
    <div class="ht-main">
      <ul class="ht-moreinfo">
        <li>
          <span><i class="red">*</i>服务区域：</span>
          <ul class="pull-right">
            <volist name="quyu" id="vo">
              <li>
                <label>
                  <input name="quyu[]" class="all" type="checkbox" value="{$vo.qz_areaid}" <if condition="strpos($info['user']['quyu'],$vo['qz_areaid']) nheq false">checked="checked"</if> />{$vo.oldName}
                </label>
              </li>
            </volist>
          </ul>
        </li>
        <li>
          <span><i class="red">*</i>服务类型：</span>
          <ul class="pull-right">
            <volist name="fuwu" id="vo">
              <li>
                <label>
                  <input class="all" type="checkbox" value="{$vo.id}" name="fuwu[]" <if condition="strpos($info['user']['fuwu'],$vo['id']) nheq false">checked="checked"</if> />{$vo.name}
                </label>
              </li>
            </volist>
          </ul>
        </li>
        <li>
          <span><i class="red">*</i>擅长风格：</span>
          <ul class="pull-right">
            <li><label><input class="fengge_all" type="checkbox" id="check_all_fengge" />全选</label></li>
            <volist name="fengge" id="vo">
              <li>
                <label>
                  <input type="checkbox" class="icheck" value="{$vo.id}" name="fengge[]" <if condition="strpos($info['user']['fengge'],$vo['id']) nheq false">checked="checked"</if> />{$vo.name}
                </label>
              </li>
            </volist>
          </ul>
        </li>
        <li>
          <span>承接价位：</span>
          <input name="jiawei" style="width:50px;text-align:center;" type="text" value="{$info.user.jiawei}" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')" />万起
          <i class="red"> <i class="icon-info-sign mr10"></i>留空为不限 </i>
        </li>
        <li>
          <span>成立时间：</span>
          <input class="laydate-icon" name="chengli" id="ht-date" value="{$info.user.chengli|default='请填写日期'}" />

        </li>
        <li>
          <span>公司规模：</span>
          <select name="guimo" class="select">
            <volist name="guimo" id="vo">
            <option value="{$vo.id}" <if condition="$info['user']['guimo'] eq $vo['id']">selected="selected"</if> >{$vo.name}</option>
            </volist>
          </select>
        </li>
        <li> <span><i class="red">*</i>交通路线：</span> <input name="luxian" type="text" value="{$info.user.luxian}" style="width: 480px;" /> <i class="red err-tips"></i></li>
        <li> <span><i class="red">*</i>简介：</span> <textarea class="jianjiemain" name="text">    {$info.user.about_jianjie}</textarea> <i class="red err-tips"></i></li>
      </ul>
      <div class="ht-yes">
       <a href="javascript:;" id="edit_info_btn"><i class="icon-ok mr10"></i>保存资料</a><i class="red err-tips"></i>
      </div>
    </div>
  </div>
  <include file="Index:footer" />
 </body>
</html>
<script type="text/javascript">
$(function(){
  //日历控件的加载
  $("#ht-date").click(function(event) {
    laydate.skin('yahui');//日历的样式
    laydate({
        elem: '#ht-date',
        choose: function(datas){ //选择日期完毕的回调
         }
        });//绑定元素
  });
  //复选框的渲染实例化
  $(".all").iCheck({
    checkboxClass: 'icheckbox_minimal-red',
    radioClass: 'iradio_minimal-red',
    increaseArea: '' // optional
  });
  $('.icheck').iCheck({
    checkboxClass: 'icheckbox_minimal-red',
    radioClass: 'iradio_minimal-red',
    increaseArea: '' // optional
  });
  //装修风格的复选框实例化
  $(".fengge_all").iCheck({
    checkboxClass: 'icheckbox_minimal-red',
    radioClass: 'iradio_minimal-red',
    increaseArea: '' // optional
  }).on("ifChecked",function(event){
    var target = $(event.target);
    target.attr("checked","checked");
    $("input[name=fengge\\[\\]]").iCheck("check");
  }).on("ifUnchecked",function(event){
    var target = $(event.target);
    target.attr("checked",false);
    $("input[name=fengge\\[\\]]").iCheck("uncheck");
  });

  //提交修改资料
  $("#edit_info_btn").click(function(event) {
    var quyu="";
    var fuwu="";
    var fengge="";
    var _this=$(this);
    $("input[name='quyu\\[\\]']:checked").each(function() {
      quyu+=$(this).val()+",";
    });
    $("input[name='fuwu\\[\\]']:checked").each(function() {
      fuwu+=$(this).val()+",";
    });
    $("input[name='fengge\\[\\]']:checked").each(function() {
      fengge+=$(this).val()+",";
    });
    if(quyu==""){alert("请选择服务区域");return false;}
    if(fuwu==""){alert("请选择服务类型");return false;}
    if(fengge==""){alert("请选择擅长风格");return false;}
    var jiawei=$("input[name='jiawei']").val();
    var chengli=$("input[name='chengli']").val();
    var guimo=$("select[name='guimo']").val();
    var luxian=$("input[name='luxian']").val();
    var text=$("textarea[name='text']").val();
    var luxian_obj=$("input[name='luxian']");
    var text_obj=$("textarea[name='text']");
    if (!App.validate.run(luxian_obj.val()))
    {
      luxian_obj.focus();
      luxian_obj.parent().find(".err-tips").html("请填写交通路线");
      return false;
    };
    if (!App.validate.run(text_obj.val()))
    {
      text_obj.focus();
      text_obj.parent().find(".err-tips").html("请填写简介");
      return false;
    };
    $.post('/Companyinfo/edit_detail_info', {
      quyu:quyu,
      fuwu:fuwu,
      fengge:fengge,
      jiawei:jiawei,
      chengli:chengli,
      guimo:guimo,
      luxian:luxian,
      text:text
    }, function(res) {
      if (res.info!='Ok')
      {
        _this.parent().find(".err-tips").html(res.data);
      }else{
        window.location.href=window.location.href;
      }
    },'json');
  });
});
</script>