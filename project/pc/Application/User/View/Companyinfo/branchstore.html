<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="keywords" content="{$keys.keywords}">
  <meta name="description" content="{$keys.description}">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title>{$keys.title}-{$title}</title>
  <include file="Index:resource" />
  <include file="Home:resource" />
  <link rel="stylesheet" href="{$static_host}/assets/user/home/css/ht-info.css?v={:C('STATIC_VERSION')}" />
</head>
<body>
  <include file="Home:header" />
  <div class="ht-wrap oflow ht-relative">
    <include file="Home:comnavleft" />
    <include file="Companyinfo:tab_header" />
    <div class="ht-main">
      <volist name="list" id="vo">
        <form action="" id="">
          <h2>分店{$i}</h2>
          <ul class="moreshops">
            <li>
              <span>分店名称：</span>
              <input name="shortname" type="text" placeholder="分店名称"  value="{$vo.shortname}" />
              <i class="gray ml20">如：吴江分店，相城二部</i><i class="red err-tips"></i>
            </li>
            <li>
              <span>排序：</span>
              <input name="seq" type="text" placeholder="排序" value="{$vo.seq}" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" >
              <i class="red err-tips"></i>
            </li>
            <li>
              <span>分店全称：</span>
              <input name="subname" type="text" placeholder="分店全称" value="{$vo.subname}" >
              <i class="red err-tips"></i>
            </li>
            <li>
              <span>地址：</span>
              <input class="full" name="addr" type="text" placeholder="地址" value="{$vo.addr}" >
              <i class="red err-tips"></i>
            </li>
            <li>
              <span>联系电话：</span>
              <input name="tel" type="text" placeholder="联系电话" value="{$vo.tel}" >
              <i class="red err-tips"></i>
            </li>
            <li>
              <span>手机：</span>
              <input name="mobile" type="text" placeholder="手机" value="{$vo.mobile}" >
              <i class="red err-tips"></i>
            </li>
            <li>
              <span>客服QQ1：</span>
              <input class="mr20" name="nickname" type="text" placeholder="客服昵称1"  value="{$vo.nickname}" />
              <input  name="qq" type="text" placeholder="客服qq1" value="{$vo.qq}" >
              <i class="red err-tips"></i>
            </li>
            <li>
              <span>客服QQ2：</span>
              <input class="mr20" name="nickname1" type="text" placeholder="客服昵称2"  value="{$vo.nickname1}" />
              <input name="qq1" type="text" placeholder="客服qq2" value="{$vo.qq1}" >
              <i class="red err-tips"></i>
            </li>
            <li>
              <input type="hidden" name="id" value="{$vo.id}">
              <a class="del" href="javascript:;" storeid="{$vo.id}" style="padding: 7px 18px;"><i class="icon-trash mr10"></i>删除该分店</a>
              <div class="ht-yes" style="float:left;padding:0px;"><a href="javascript:;"><i class="icon-ok mr10"></i>保存资料</a></div>
            </li>
          </ul>
        </form>

      </volist>
      <form>
        <h2>分店{$i+1}</h2>
        <ul class="moreshops">
          <li>
            <span>分店名称：</span>
            <input name="shortname" type="text" placeholder="分店名称" />
            <i class="gray ml20">如：吴江分店，相城二部</i>
            <i class="red err-tips"></i>
          </li>
          <li>
            <span>排序：</span>
            <input name="seq" type="text" placeholder="排序" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />
            <i class="red err-tips"></i>
          </li>
          <li>
            <span>分店全称：</span>
            <input name="subname" type="text" placeholder="分店全称">
            <i class="red err-tips"></i>
          </li>
          <li>
            <span>地址：</span>
            <input class="full" name="addr" type="text" placeholder="地址">
            <i class="red err-tips"></i>
          </li>
          <li>
            <span>联系电话：</span>
            <input name="tel" type="text" placeholder="格式:XXXX-XXXXXXX">
            <i class="red err-tips"></i>
          </li>
          <li>
            <span>手机：</span>
            <input name="mobile" type="text" placeholder="手机">
            <i class="red err-tips"></i>
          </li>
          <li>
            <span>客服QQ1：</span>
            <input class="mr20" value="" name="nickname" type="text" placeholder="客服昵称1" />
            <input value="" name="qq" type="text" placeholder="客服qq1">
            <i class="red err-tips"></i>
          </li>
          <li>
            <span>客服QQ2：</span>
            <input class="mr20" value="" name="nickname1" type="text" placeholder="客服昵称2" />
            <input value="" name="qq1" type="text" placeholder="客服qq2">
            <i class="red err-tips"></i>
          </li>
          <li><div class="ht-yes"><a href="javascript:;"><i class="icon-ok mr10"></i>新增分店</a></div></li>
        </ul>
      </form>

      <!--分店最多五个-->
    </div>
  </div>
  <include file="Index:footer" />
  <script type="text/javascript">
  $(function(){
    //点击保存后触发的事件
    $(".ht-yes").click(function(event) {
      /* 点击保存的时候 */
      $(".err-tips").html("");//将所有提示恢复初始化
      var shortname_obj =$(this).parent().parent().find("input[name='shortname']");
      var seq_obj       =$(this).parent().parent().find("input[name='seq']");
      var subname_obj   =$(this).parent().parent().find("input[name='subname']");
      var addr_obj      =$(this).parent().parent().find("input[name='addr']");
      var tel_obj       =$(this).parent().parent().find("input[name='tel']");
      var mobile_obj    =$(this).parent().parent().find("input[name='mobile']");
      var qq_obj        =$(this).parent().parent().find("input[name='qq']");
      var qq1_obj       =$(this).parent().parent().find("input[name='qq1']");
      if (!App.validate.run(shortname_obj.val()))
      {
        shortname_obj.focus();
        shortname_obj.parent().find(".err-tips").html("请填写分店简称");
        return false;
      };
      if (!App.validate.run(seq_obj.val()))
      {
        seq_obj.focus();
        seq_obj.parent().find(".err-tips").html("请填写排序");
        return false;
      };
      if (!App.validate.run(subname_obj.val()))
      {
        subname_obj.focus();
        subname_obj.parent().find(".err-tips").html("请填写分店全称");
        return false;
      };
      if (!App.validate.run(addr_obj.val()))
      {
        addr_obj.focus();
        addr_obj.parent().find(".err-tips").html("请填写地址");
        return false;
      };
      if (!App.validate.run(tel_obj.val(),"tel"))
      {
        tel_obj.focus();
        tel_obj.parent().find(".err-tips").html("请填写正确的电话号码");
        return false;
      };
      if (!App.validate.run(mobile_obj.val(),"moblie"))
      {
        mobile_obj.focus();
        mobile_obj.parent().find(".err-tips").html("请填写正确的手机号码");
        return false;
      };
      if (!App.validate.run(qq_obj.val(),"num"))
      {
        qq_obj.focus();
        qq_obj.parent().find(".err-tips").html("请填写正确的QQ");
        return false;
      };
      if(qq1_obj.val()!="")
      {
        if (!App.validate.run(qq1_obj.val(),"num"))
        {
          qq1_obj.focus();
          qq1_obj.parent().find(".err-tips").html("请填写正确的QQ");
          return false;
        };
      }
      var json=$(this).parent().parent().parent().serializeArray();
      $.post('/info/save_store',json,function(res){
        if (res.info!="Ok")
        {
          alert(res.data);
        }else
        {
          window.location.href=window.location.href;
        }
      },'json');
    });

    //点击删除后触发的事件
    $(".del").click(function(event) {
      var id=$(this).attr("storeid");
      if(confirm("您确认要删除这个分店吗？"))
      {
        $.post("/info/del_store",{id:id},function(res){
          if (res.info!="Ok")
          {
            alert(res.data);
          }else{
            window.location.href=window.location.href;
          }
        },'json');
      }
    });
  });
  </script>
</body>
</html>