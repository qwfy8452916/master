<extend name="Common:basic"/>
<block name="link">
    <link href="/assets/mobile/huangli/css/zxhl.css?v={:C('STATIC_VERSION')}" rel="stylesheet" type="text/css" />
    <link href="/assets/mobile/common/css/qzCitySelect.css?v={:C('STATIC_VERSION')}" rel="stylesheet" type="text/css"/>
</block>
<block name="top">
    <div class="m-header-his">
        <i class="fa fa-angle-left"></i>
    </div>
    <a class="m-header-left" href="http://m.{:C('QZ_YUMING')}"></a>
    <div class="m-header-tit">装修黄历</div>
</block>
<block name="content">
    <div class="hl_body">
        <div class="hl_top">
            <div class="hl_content">
                <div class="sm_one">
                    <div class="sm_title">
                        开工<span>吉</span><span>日</span>拿不准？
                    </div>
                    <div class="sm-by">
                        <div class="clound pull-left"> </div>
                        <div class="pull-left by_nr"> 10秒测算最佳装修吉日 </div>
                        <div class="clound pull-right"></div>
                    </div>
                </div>

              <div class="sm_two">
                    <div class="step active">
                        <div class="step_radius">1</div>
                    </div>
                    <div class="step">
                        <div class="step_radius">2</div>
                    </div>
                    <div class="step">
                        <div class="step_radius">3</div>
                    </div>
                    <div class="step">
                        <div class="step_radius">4</div>
                    </div>
                </div>
                <div class="sm-three">
                    <ul id="question_list">
                        <li>
                            <div class="question_title">您家准备什么时候开始装修</div>
                            <div class="question_chose one">
                                <div class="question_item">
                                    <div class="fa fa-circle-o item_circle"></div>半个月内
                                </div>
                                <div class="question_item">
                                    <div class="fa fa-circle-o item_circle"></div>1个月内
                                </div>
                                <div class="question_item">
                                    <div class="fa fa-circle-o item_circle"></div>3个月内
                                </div>
                                <div class="question_item">
                                    <div class="fa fa-circle-o item_circle"></div>3个月以上
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="question_title">您家房屋的朝向</div>
                            <div class="question_chose two">
                                <div class="question_item">
                                    <img src="/assets/mobile/huangli/images/cx_1.png" alt="" class="one_img">
                                    <img src="/assets/mobile/huangli/images/cx_1_1.png" alt="" class="two_img">
                                    <p><div class="fa fa-circle-o item_circle"></div>朝南</p>
                                </div>
                              <div class="question_item">
                                  <img src="/assets/mobile/huangli/images/cx_2.png" alt="" class="one_img">
                                  <img src="/assets/mobile/huangli/images/cx_2_1.png" alt="" class="two_img">
                                  <p><div class="fa fa-circle-o item_circle"></div>朝北</p>
                              </div>
                              <div class="question_item">
                                  <img src="/assets/mobile/huangli/images/cx_3.png" alt="" class="one_img">
                                  <img src="/assets/mobile/huangli/images/cx_3_1.png" alt="" class="two_img">
                                  <p><div class="fa fa-circle-o item_circle"></div>朝东</p>
                              </div>
                              <div class="question_item">
                                  <img src="/assets/mobile/huangli/images/cx_4.png" alt="" class="one_img">
                                  <img src="/assets/mobile/huangli/images/cx_4_1.png" alt="" class="two_img">
                                  <p><div class="fa fa-circle-o item_circle"></div>朝西</p>
                              </div>
                              <div class="question_item">
                                  <img src="/assets/mobile/huangli/images/cx_5.png" alt="" class="one_img">
                                  <img src="/assets/mobile/huangli/images/cx_5_1.png" alt="" class="two_img">
                                  <p><div class="fa fa-circle-o item_circle"></div>不太清楚</p>
                              </div>
                          </div>
                        </li>
                        <li class="age">
                            <div class="question_title">您的姓氏和年龄</div>
                            <div class="question_chose three">
                                <div class="input_box family">
                                    <input type="text" name="family" placeholder="请输入您的姓氏">
                                </div>
                                <div class="question_item">
                                    <img src="/assets/mobile/huangli/images/old_1.png" alt="" class="one_img">
                                    <img src="/assets/mobile/huangli/images/old_1_1.png" alt="" class="two_img">
                                    <p><div class="fa fa-circle-o item_circle"></div>25岁以下</p>
                                </div>
                                <div class="question_item">
                                    <img src="/assets/mobile/huangli/images/old_2.png" alt="" class="one_img">
                                    <img src="/assets/mobile/huangli/images/old_2_1.png" alt="" class="two_img">
                                    <p><div class="fa fa-circle-o item_circle"></div>25~35岁</p>
                                </div>
                                <div class="question_item">
                                    <img src="/assets/mobile/huangli/images/old_3.png" alt="" class="one_img">
                                    <img src="/assets/mobile/huangli/images/old_3_1.png" alt="" class="two_img">
                                    <p><div class="fa fa-circle-o item_circle"></div>35~45岁</p>
                                </div>
                                <div class="question_item">
                                    <img src="/assets/mobile/huangli/images/old_4.png" alt="" class="one_img">
                                    <img src="/assets/mobile/huangli/images/old_4_1.png" alt="" class="two_img">
                                    <p><div class="fa fa-circle-o item_circle"></div>45岁以上</p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="question_title four">选择房屋所在的城市</div>
                            <div id="city_2" class="input_box">
                                <gt name="mapUseInfo.vipcount" value="0">
                                    <button id="showCityPicker2" class="c-zb-city-qixi" type="button">
                                        <i class="fa fa-map-marker"></i>
                                        <empty name="info.cityarea">
                                            请选择您所在的区域
                                        <else/>
                                            {$mapUseInfo.provincefull} {$mapUseInfo.name} {$info.cityarea.name}
                                        </empty>
                                    </button>
                                    <input type="hidden" name="province" data-id="{$mapUseInfo.pid}">
                                    <input type="hidden" name="city" data-id="{$mapUseInfo.id}">
                                    <input type="hidden" name="area" data-id="{$info.cityarea.id}">
                                <else/>
                                    <button id="showCityPicker2" class="c-zb-city" type="button">
                                        <i class="fa fa-map-marker"></i>
                                          请选择您所在的区域
                                    </button>
                                    <input type="hidden" name="province" data-id="">
                                    <input type="hidden" name="city" data-id="">
                                    <input type="hidden" name="area" data-id="">
                                </gt>
                            </div>
                            <div class="input_box">
                                <input type="telphone" maxlength="11" placeholder="输入手机号码，获取测算吉日" name="telphone_number" value="">
                                <input type="hidden" name="fb_type" value="huangli">
                            </div>
                            <div class="input_box" id="shenming" style="height: 0.34rem;">
                              <input type="checkbox" checked="checked" id="mianze">
                              <label for="mianze" id="check" class="fa fa-check"></label>
                              <span>我已阅读并同意齐装网的</span>
                              <a href="http://{:C('MOBILE_DONAMES')}/about/disclaimer"><span>《免责申明》</span></a>
                            </div>
                        </li>
                        <li>
                            <div id="resultSet"></div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="hl_bottom">
            <div id="prev" ><上一页</div>
            <div id="next" class="current_page">下一页></div>
            <div id="cesuan">立即测算</div>
            <div id="resuan">重新测算</div>
        </div>
    </div>
    <input type="hidden" name="hide_city_id" value="{$info.cityarea.id}">
</block>
<block name="script">
    <script type="text/javascript" src="/assets/mobile/sub/js/TouchSlide.1.1.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="//api.map.baidu.com/api?v=2.0&ak=12a80d1749e9de182e12c6201d5e191c"></script>
    <script type="text/javascript" src="/assets/mobile/common/js/geolocation.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="//{:C('QINIU_DOMAIN')}/{:OP('ALL_REAL_VIP_PCA_JSON')}"></script>
    <script type="text/javascript" src="/assets/mobile/js/jroll.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="/assets/mobile/common/js/qzCitySelect.js?v={:C('STATIC_VERSION')}"></script>
    <script type="text/javascript" src="/assets/common/js/tooltips/jquery.pure.tooltips.js?v={:C('STATIC_VERSION')}"></script>
    <script>
        $(document).ready(function () {
            var question_num=0;
            var question=$("#question_list li");
            var step=$(".sm_two .step");
            var answer=[{"value":""},{"value":""},{"family":"","value":""},{"addr":"","number":""}];
            // 城市选择插件
            selectQz.init({
                province: $("input[name=province]").attr("data-id"),
                city: $("input[name=city]").attr("data-id"),
                area: $("input[name=area]").attr("data-id")
            });
            function init_question(){
                $("#next").css("display","inline-block");
            }

            //初始化问题
            init_question();

            //下一页 以及当前题目验证
            $("#next").click(function(){
                if(answer[question_num].value==""&&answer[question_num].hasOwnProperty('value')){
                    alert("请选择本题选项！");
                    return false;
                }
                if(question_num==2){
                    answer[question_num].family=$("input[name='family']").val();
                    if(answer[question_num].family==""){
                        alert("请输入您的姓氏！");
                        return false;
                    }else{
                        var reg = new RegExp("^[\u4e00-\u9fa5a-zA-Z]+$");
                        if(!reg.test(answer[question_num].family)){
                            $("input[name=family]").focus();
                            alert("请输入正确的名称，只支持中文和英文");
                            return false;
                        }
                    }
                }
                $(this).addClass('current_page');
                $(this).siblings().removeClass("current_page");
                $("#prev").css("display","inline-block");
                if(question_num<3){
                    question_num++;
                    $(question[question_num]).css("display","block");
                    $(question[question_num]).siblings().css("display","none");
                    setStep(question_num);
                    if(question_num==3){
                        $(this).css("display","none");
                        $("#cesuan").css("display","inline-block").addClass('current_page');
                    }
                }
            });


            //上一页
            $("#prev").click(function(){
                $(this).addClass('current_page');
                $(this).siblings().removeClass("current_page");
                $("#prev").css("display","inline-block");
                $("#next").css("display","inline-block");
                $("#cesuan").css("display","none");
                if(question_num>0){
                    question_num--;
                    $(question[question_num]).css("display","block");
                    $(question[question_num]).siblings().css("display","none");
                    setStep(question_num);
                }
            });


            //立即测算,最后一题验证
            $("#cesuan").click(function(){
                //提交答案
                var _this = $(this);
                var tel = $("input[name='telphone_number']").val();
                var fb_type = $("input[name=fb_type]").val();
                var name = $("input[name='family']").val();
                var cs = $("input[name=city]").attr("data-id");
                var qx = $("input[name=area]").attr("data-id");
                var hltime = answer[0].value;

                if(cs == ""){
                    alert("请选择你所在的城市！");
                    return false;
                }
                if(tel == ""){
                    alert("请输入您的电话号码！");
                    return false;
                } else {
                    var reg = new RegExp("^(13|14|15|17|18)[0-9]{9}$");
                    if (!reg.test(tel)) {
                        $("input[name='telphone_number']").focus();
                        // $("input[name='telphone_number']").val('');
                        alert("请填写正确的手机号码 ^_^!");
                        return false;
                    }
                }
                var checked = $("#mianze").is(':checked');
                if(!checked){
                    alert('请勾选我已阅读并同意齐装网的《免责申明》！')
                    return false;
                }

                $("#resuan").css("display","inline-block");
                $("#resuan").addClass('current_page');
                $("#resuan").siblings().css("display","none");
                $(question[4]).css("display","block");
                $(question[4]).siblings().css("display","none");
                $(".sm_one,.sm_two").css("display","none");

                window.order({
                    extra:{
                        tel: tel,
                        fb_type: fb_type,
                        name: name,
                        cs: cs,
                        qx: qx,
                        hltime: hltime,
                        source: '313',
                        ssid:"{$ssid}",
                        module:'moblie',
                        step:99,
                        new_hl:1
                    },
                    error:function(){
                        $.pt({
                            target: _this,
                            content: '测算失败,请刷新页面！',
                            width: 'auto'
                        });
                    },
                    success:function(data, status, xhr){
                        if (data.status == 1) {
                            $("#resultSet").html(data.data.tmp);
                        } else {
                            $.pt({
                                target: _this,
                                content: data.info,
                                width: 'auto'
                            });
                        }
                        $($(".other-content")[1]).css("float","right");
                    },
                    validate:function(item, value, method, info){
                        return true;
                    }
                });
            });

            //重新测算
            $("#resuan").click(function(){
                location.href="/hl/";
            });

            //当前答题进度
            function setStep(num){
                step.removeClass("active");
                $(step[num]).addClass('active');
                /*for(var i=0;i<=num;i++){
                    $(step[i]).addClass('active');
                }*/
            }
            //选择题选择答案
            $(".question_item").click(function(){
                var index=$(this).parent().parent().index();
                var result=$(this).index()+1;
                $(this).addClass("hasChose");
                $(this).siblings().removeClass("hasChose");
                $(this).children("div").attr("class","fa fa-check-circle item_circle");
                $(this).siblings().children("div").attr("class","fa fa-circle-o item_circle");
                if(index!=3){
                    answer[index].value=result;
                }
            });
            //切换免责对勾
            $("#check").click(function(){
                $(this).toggleClass('fa-check');
            });
        });
    </script>
</block>