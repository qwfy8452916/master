(function(j){if(!("__jquery_xdomain__"in j)&&/msie/.test(navigator.userAgent.toLowerCase())&&"XDomainRequest"in window&&!(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest)&&document.location.href.indexOf("file:///")==-1){j.__jquery_xdomain__=j.support.cors=true;var z=/^(((([^:\/#\?]+:)?(?:\/\/((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?]+)(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,A=j.ajaxSettings.xhr,s="XDR_SESSION_COOKIE_NAME"in window?window.XDR_SESSION_COOKIE_NAME:
"jsessionid",t="XDR_COOKIE_HEADERS"in window?window.XDR_COOKIE_HEADERS:[],B="XDR_HEADERS"in window?window.XDR_HEADERS:["Content-Type"],m={UNSENT:0,OPENED:1,LOADING:3,DONE:4},k=window.XDR_DEBUG&&"console"in window,u,v,w=0,x=function(a,c){if(typeof a=="string")a=[a];var b,e;for(b=0;b<a.length;b++)(e=(e=(new RegExp("(?:^|; )"+a[b]+"=([^;]*)","i")).exec(document.cookie))&&e[1])&&c.call(null,a[b],e)},C=function(a){if(a.length>=5){var c=a.substring(a.length<=20?0:a.length-20),b=c.length-1,e,h,g;if(c.charAt(b)===
"~"){for(e=b--;b>=0&&c.charAt(b)!=="~";b--);h=parseInt(c.substring(b+1,e));if(!isNaN(h)&&h>=0&&b>=2&&c.charAt(b)==="~"){for(e=b--;b>=0&&c.charAt(b)!=="~";b--);g=parseInt(c.substring(b+1,e));if(!isNaN(g)&&b>=0&&c.charAt(b)==="~"){e=a.length-h-c.length+b;return[g,a.substring(0,e),a.substr(e,h)]}}}}return[200,a,""]},y=function(a){if(typeof a==="object")return a;return(a=z.exec(a))?{href:a[0]||"",hrefNoHash:a[1]||"",hrefNoSearch:a[2]||"",domain:a[3]||"",protocol:a[4]||"",authority:a[5]||"",username:a[7]||
"",password:a[8]||"",host:a[9]||"",hostname:a[10]||"",port:a[11]||"",pathname:a[12]||"",directory:a[13]||"",filename:a[14]||"",search:a[15]||"",hash:a[16]||""}:{}},D=function(a){if(a.length==0)return[];var c=[],b=0,e=0,h;do{h=a.indexOf(",",e);c[b]=(c[b]||"")+a.substring(e,h==-1?a.length:h);e=h+1;if(c[b].indexOf("Expires=")==-1||c[b].indexOf(",")!=-1)b++;else c[b]+=","}while(h>0);for(b=0;b<c.length;b++){a=c[b].indexOf("Domain=");if(a!=-1)c[b]=c[b].substring(0,a)+c[b].substring(c[b].indexOf(";",a)+
1)}return c};v=y(document.location.href).domain;u=function(){var a=this,c=new XDomainRequest,b,e=[],h,g,l=w++,q=function(f){a.readyState=f;typeof a.onreadystatechange==="function"&&a.onreadystatechange.call(a)},r=function(f,d){if(!a.responseText)a.responseText="";k&&console.log("[XDR-"+l+"] request end with state "+f+" and code "+d+" and data length "+a.responseText.length);a.status=d;if(!a.responseType){b=b||c.contentType;if(b.match(/\/json/)){a.responseType="json";a.response=a.responseText}else if(b.match(/\/xml/)){a.responseType=
"document";d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(a.responseText);a.responseXML=a.response=d;if(j(d).children("error").length!=0){d=j(d).find("error");a.status=parseInt(d.attr("response_code"))}}else{a.responseType="text";a.response=a.responseText}}q(f);g=e=c=null};c.onprogress=function(){q(m.LOADING)};c.ontimeout=function(){r(m.DONE,408)};c.onerror=function(){r(m.DONE,500)};c.onload=function(){var f,d,i=C(c.responseText||"");k&&console.log("[XDR-"+w+"] parsing cookies for header "+
i[2]);f=D(i[2]);a.responseText=i[1]||"";k&&console.log("[XDR-"+l+"] raw data:\n"+c.responseText+"\n parsed response: status="+i[0]+", header="+i[2]+", data=\n"+i[1]);for(d=0;d<f.length;d++){k&&console.log("[XDR-"+l+"] installing cookie "+f[d]);document.cookie=f[d]+";Domain="+document.domain}r(m.DONE,i[0])};this.readyState=m.UNSENT;this.status=0;this.responseType=this.statusText="";this.timeout=0;this.withCredentials=false;this.overrideMimeType=function(f){b=f};this.abort=function(){c.abort()};this.setRequestHeader=
function(f,d){j.inArray(f,B)>=0&&e.push({k:f,v:d})};this.open=function(f,d){g=d;h=f;q(m.OPENED)};this.send=function(f){c.timeout=this.timeout;if(s||t||e.length){var d,i=function(n,o){var p=g.indexOf("?");g+=(p==-1?"?":"&")+n+"="+encodeURIComponent(o);k&&console.log("[XDR-"+l+"] added parameter "+n+"="+o+" => "+g)};for(d=0;d<e.length;d++)i(e[d].k,e[d].v);x(s,function(n,o){var p=g.indexOf("?");if(p==-1)g+=";"+n+"="+o;else g=g.substring(0,p)+";"+n+"="+o+g.substring(p);k&&console.log("[XDR-"+l+"] added cookie "+
g)});x(t,i);i("_xdr",""+l)}k&&console.log("[XDR-"+l+"] opening "+g);c.open(h,g);k&&console.log("[XDR-"+l+"] send, timeout="+c.timeout);c.send(f)};this.getAllResponseHeaders=function(){return""};this.getResponseHeader=function(){return null}};j.ajaxSettings.xhr=function(){var a=y(this.url).domain;if(a===""||a===v)return A.call(j.ajaxSettings);else try{return new u}catch(c){}}}})(jQuery);
